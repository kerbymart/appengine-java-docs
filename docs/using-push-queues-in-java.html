<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-13T01:56:45.339166025"><title>Using Push Queues in Java | Google App Engine Java Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"using-push-queues","level":0,"title":"Using push queues","anchor":"#using-push-queues"},{"id":"push-task-execution","level":0,"title":"Push task execution","anchor":"#push-task-execution"},{"id":"deferred-tasks","level":0,"title":"Deferred tasks","anchor":"#deferred-tasks"},{"id":"url-endpoints","level":0,"title":"URL endpoints","anchor":"#url-endpoints"},{"id":"calling-google-cloud-endpoints","level":0,"title":"Calling Google Cloud Endpoints","anchor":"#calling-google-cloud-endpoints"},{"id":"push-queues-and-the-development-server","level":0,"title":"Push queues and the development server","anchor":"#push-queues-and-the-development-server"},{"id":"quotas-and-limits-for-push-queues","level":0,"title":"Quotas and limits for push queues","anchor":"#quotas-and-limits-for-push-queues"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Using Push Queues in Java | Google App Engine Java Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Google App Engine Java Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/using-push-queues-in-java.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Using Push Queues in Java | Google App Engine Java Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/using-push-queues-in-java.html#webpage",
    "url": "writerside-documentation/using-push-queues-in-java.html",
    "name": "Using Push Queues in Java | Google App Engine Java Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Google App Engine Java Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="Using-Push-Queues-in-Java" data-main-title="Using Push Queues in Java" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Guides.md|Guides///Scheduling-Work-Outside-of-User-Requests.md|Scheduling Work Outside of User Requests///Task-Queue-API.md|Task Queue API"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Google App Engine Java Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Using-Push-Queues-in-Java" id="Using-Push-Queues-in-Java.md">Using Push Queues in Java</h1><p id="z79cjn8_3">In App Engine push queues, a <span class="emphasis" id="z79cjn8_14">task</span> is a unit of work to be performed by the application. Each task is an object of the <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TaskOptions" id="z79cjn8_15" data-external="true" rel="noopener noreferrer" target="_blank">TaskOptions class</a>. Each Task object contains an application-specific URL with a request handler for the task, and an optional data payload that parameterizes the task.</p><p id="z79cjn8_4">For example, consider a calendaring application that needs to notify an invitee, via email, that an event has been updated. The data payload for this task consists of the email address and name of the invitee, along with a description of the event. The webhook might live at <code class="code" id="z79cjn8_16">/app_worker/send_email</code> and contain a function that adds the relevant strings to an email template and sends the email. The app can create a separate task for each email it needs to send.</p><p id="z79cjn8_5">You can use push queues only within the App Engine environment; if you need to access App Engine tasks from outside of App Engine, use <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/taskqueue/overview-pull" id="z79cjn8_17" data-external="true" rel="noopener noreferrer" target="_blank">pull queues</a>.</p><ol class="list _decimal" id="z79cjn8_6" type="1"><li class="list__item" id="z79cjn8_18"><p id="z79cjn8_25"><span id="z79cjn8_26">Using push queues</span></p></li><li class="list__item" id="z79cjn8_19"><p id="z79cjn8_27"><span id="z79cjn8_29">Push task execution</span></p><ol class="list _decimal" id="z79cjn8_28" type="1"><li class="list__item" id="z79cjn8_30"><p id="z79cjn8_35"><span id="z79cjn8_36">Task request headers</span></p></li><li class="list__item" id="z79cjn8_31"><p id="z79cjn8_37"><span id="z79cjn8_38">Task deadlines</span></p></li><li class="list__item" id="z79cjn8_32"><p id="z79cjn8_39"><span id="z79cjn8_40">Task retries</span></p></li><li class="list__item" id="z79cjn8_33"><p id="z79cjn8_41"><span id="z79cjn8_42">The rate of task execution</span></p></li><li class="list__item" id="z79cjn8_34"><p id="z79cjn8_43"><span id="z79cjn8_44">The order of task execution</span></p></li></ol></li><li class="list__item" id="z79cjn8_20"><p id="z79cjn8_45"><span id="z79cjn8_46">Deferred tasks</span></p></li><li class="list__item" id="z79cjn8_21"><p id="z79cjn8_47"><span id="z79cjn8_48">URL endpoints</span></p></li><li class="list__item" id="z79cjn8_22"><p id="z79cjn8_49"><span id="z79cjn8_50">Calling Google Cloud Endpoints</span></p></li><li class="list__item" id="z79cjn8_23"><p id="z79cjn8_51"><span id="z79cjn8_52">Push queues and the development server</span></p></li><li class="list__item" id="z79cjn8_24"><p id="z79cjn8_53"><span id="z79cjn8_54">Quotas and limits for push queues</span></p></li></ol><section class="chapter"><h2 id="using-push-queues" data-toc="using-push-queues">Using push queues</h2><p id="z79cjn8_55">A Java app sets up queues using a configuration file named <code class="code" id="z79cjn8_65">queue.xml</code>, in the <code class="code" id="z79cjn8_66">WEB-INF/</code> directory inside the WAR. See <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/config/queue" id="z79cjn8_67" data-external="true" rel="noopener noreferrer" target="_blank">Java Task Queue Configuration</a>. Every app has a push queue named <code class="code" id="z79cjn8_68">default</code> with some default settings.</p><p id="z79cjn8_56">To enqueue a task, you get a <code class="code" id="z79cjn8_69">Queue</code> using the <code class="code" id="z79cjn8_70">QueueFactory</code>, then call its <code class="code" id="z79cjn8_71">add()</code> method. You can get a named queue specified in the <code class="code" id="z79cjn8_72">queue.xml</code> file using the <code class="code" id="z79cjn8_73">getQueue()</code> method of the factory, or you can get the default queue using <code class="code" id="z79cjn8_74">getDefaultQueue()</code>. You can call the <code class="code" id="z79cjn8_75">Queue</code>'s <code class="code" id="z79cjn8_76">add()</code> method with a <code class="code" id="z79cjn8_77">TaskOptions</code> instance (produced by <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TaskOptions.Builder" id="z79cjn8_78" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="z79cjn8_79">TaskOptions.Builder</code></a>), or you can call it with no arguments to create a task with the default options for the queue.</p><p id="z79cjn8_57">The following code adds a task to a queue with options.</p><p id="z79cjn8_58">In <code class="code" id="z79cjn8_80">index.html</code>:</p><div class="code-block" data-lang="none">
&lt;!-- A basic index.html file served from the &quot;/&quot; URL. --&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;p&gt;Enqueue a value, to be processed by a worker.&lt;/p&gt;
    &lt;form action=&quot;/enqueue&quot; method=&quot;post&quot;&gt;
      &lt;input type=&quot;text&quot; name=&quot;key&quot;&gt;
      &lt;input type=&quot;submit&quot;&gt;
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;
</div><p id="z79cjn8_60">In <code class="code" id="z79cjn8_81">Enqueue.java</code>:</p><div class="code-block" data-lang="none">
// The Enqueue servlet should be mapped to the &quot;/enqueue&quot; URL.
import com.google.appengine.api.taskqueue.Queue;
import com.google.appengine.api.taskqueue.QueueFactory;
import com.google.appengine.api.taskqueue.TaskOptions;

public class Enqueue extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String key = request.getParameter(&quot;key&quot;);

        // Add the task to the default queue.
        Queue queue = QueueFactory.getDefaultQueue();
        queue.add(TaskOptions.Builder.withUrl(&quot;/worker&quot;).param(&quot;key&quot;, key));

        response.sendRedirect(&quot;/&quot;);
    }
}
</div><p id="z79cjn8_62">In <code class="code" id="z79cjn8_82">Worker.java</code>:</p><div class="code-block" data-lang="none">
// The Worker servlet should be mapped to the &quot;/worker&quot; URL.
public class Worker extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        String key = request.getParameter(&quot;key&quot;);
        // Do something with key.
    }
}
</div><p id="z79cjn8_64">Tasks added to this queue will execute by calling the request handler at the URL <code class="code" id="z79cjn8_83">/worker</code> with the parameter <code class="code" id="z79cjn8_84">key</code>. They will execute at the rate set in the <code class="code" id="z79cjn8_85">queue.xml</code> file, or the default rate of 5 tasks per second.</p></section><section class="chapter"><h2 id="push-task-execution" data-toc="push-task-execution">Push task execution</h2><p id="z79cjn8_86">App Engine executes push tasks by sending HTTP POST requests to your app. Specifying a programmatic asynchronous callback as an HTTP request is sometimes called a <a href="https://web.archive.org/web/20160424230340/https://en.wikipedia.org/wiki/Webhook" id="z79cjn8_101" data-external="true" rel="noopener noreferrer" target="_blank">web hook</a>. The web hook model enables efficient parallel processing.</p><p id="z79cjn8_87">The task's URL determines the <span class="emphasis" id="z79cjn8_102">handler</span> for the task and the <span class="emphasis" id="z79cjn8_103">module</span> that runs the handler.</p><p id="z79cjn8_88">The handler is determined by the path part of the URL (the forward-slash separated string following the hostname), which is specified by the <code class="code" id="z79cjn8_104">url</code> parameter in the <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TaskOptions" id="z79cjn8_105" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="z79cjn8_107">TaskOptions</code></a> that you include in your call to the <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/Queue#add(java.lang.Iterable)" id="z79cjn8_106" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="z79cjn8_108">Queue.add()</code></a> method. The url must be relative and local to your application's root directory. The module and version in which the handler runs is determined by:</p><ul class="list _bullet" id="z79cjn8_89"><li class="list__item" id="z79cjn8_109"><p id="z79cjn8_111">The &quot;Host&quot; <code class="code" id="z79cjn8_112">header</code> parameter in the <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TaskOptions" id="z79cjn8_113" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="z79cjn8_115">TaskOptions</code></a> that you include in your call to the <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/Queue#add(java.lang.Iterable)" id="z79cjn8_114" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="z79cjn8_116">Queue.add()</code></a> method.</p></li><li class="list__item" id="z79cjn8_110"><p id="z79cjn8_117">The <code class="code" id="z79cjn8_118">target</code> directive in the <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/config/queue" id="z79cjn8_119" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="z79cjn8_121">queue.xml</code></a> or <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/configyaml/queue" id="z79cjn8_120" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="z79cjn8_122">queue.yaml</code></a> file.</p></li></ul><p id="z79cjn8_90">The following code sample demonstrates how to create a push task addressed to instance <code class="code" id="z79cjn8_123">1</code> of a module named <code class="code" id="z79cjn8_124">backend1</code>, using the <code class="code" id="z79cjn8_125">target</code> directive:</p><div class="code-block" data-lang="none">
import com.google.appengine.api.taskqueue.Queue;
import com.google.appengine.api.taskqueue.QueueFactory;
import com.google.appengine.api.taskqueue.TaskOptions;
import com.google.appengine.api.modules.ModulesServiceFactory;


// ...
    queue.add(TaskOptions.Builder.withUrl(&quot;/path/to/my/worker&quot;).param(&quot;key&quot;, key).header(&quot;Host&quot;,
        ModulesServiceFactory.getModulesService().getInstanceHostname(&quot;module1&quot;, null, 1)));
</div><p id="z79cjn8_92">If you do not specify any of these parameters, the task will run in the same module/version in which it was enqueued, subject to these rules:</p><ul class="list _bullet" id="z79cjn8_93"><li class="list__item" id="z79cjn8_126"><p id="z79cjn8_128">If the default version of the app enqueues a task, the task will run on the default version. Note that if the app enqueues a task and the default version is changed before the task actually runs, the task will be executed in the new default version.</p></li><li class="list__item" id="z79cjn8_127"><p id="z79cjn8_129">If a non-default version enqueues a task, the task will always run on that same version.</p></li></ul><p id="z79cjn8_94"><span class="control" id="z79cjn8_130">Note:</span> If you are using modules along with a <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/modules/routing#dispatch_file" id="z79cjn8_131" data-external="true" rel="noopener noreferrer" target="_blank">dispatch file</a>, a task's URL may be intercepted and re-routed to another module.</p><p id="z79cjn8_95">The namespace in which a push task runs is determined when the task is added to the queue. By default, a task will run in the current namespace of the process that created the task. You can override this behavior by explicitly setting the namespace before adding a task to a queue, as described on the <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/multitenancy/multitenancy#Java_Using_namespaces_with_the_Task_Queue" id="z79cjn8_132" data-external="true" rel="noopener noreferrer" target="_blank">multitenancy</a> page.</p><section class="chapter"><h3 id="task-request-headers" data-toc="task-request-headers">Task request headers</h3><p id="z79cjn8_133">Requests from the Task Queue service contain the following HTTP headers:</p><ul class="list _bullet" id="z79cjn8_134"><li class="list__item" id="z79cjn8_138"><p id="z79cjn8_143"><code class="code" id="z79cjn8_144">X-AppEngine-QueueName</code>, the name of the queue (possibly <code class="code" id="z79cjn8_145">default</code>)</p></li><li class="list__item" id="z79cjn8_139"><p id="z79cjn8_146"><code class="code" id="z79cjn8_147">X-AppEngine-TaskName</code>, the name of the task, or a system-generated unique ID if no name was specified</p></li><li class="list__item" id="z79cjn8_140"><p id="z79cjn8_148"><code class="code" id="z79cjn8_149">X-AppEngine-TaskRetryCount</code>, the number of times this task has been retried; for the first attempt, this value is 0. This number includes attempts where the task failed due to a lack of available instances and never reached the execution phase.</p></li><li class="list__item" id="z79cjn8_141"><p id="z79cjn8_150"><code class="code" id="z79cjn8_151">X-AppEngine-TaskExecutionCount</code>, the number of times this task has previously failed during the execution phase. This number does not include failures due to a lack of available instances.</p></li><li class="list__item" id="z79cjn8_142"><p id="z79cjn8_152"><code class="code" id="z79cjn8_153">X-AppEngine-TaskETA</code>, the target execution time of the task, specified in seconds since January 1st 1970.</p></li></ul><p id="z79cjn8_135">These headers are set internally by Google App Engine. If your request handler finds any of these headers, it can trust that the request is a Task Queue request. If any of the above headers are present in an external user request to your app, they are stripped. The exception being requests from logged in administrators of the application, who are allowed to set the headers for testing purposes, and development servers, which do not strip headers.</p><p id="z79cjn8_136">Tasks may be created with the <code class="code" id="z79cjn8_154">X-AppEngine-FailFast</code> header, which specifies that a task running on a manual or basic scaled module fails immediately instead of waiting in a pending queue.</p><p id="z79cjn8_137">Google App Engine issues Task Queue requests from the IP address <code class="code" id="z79cjn8_155">0.1.0.2</code>.</p></section><section class="chapter"><h3 id="task-deadlines" data-toc="task-deadlines">Task deadlines</h3><p id="z79cjn8_156">A task must finish executing and send an HTTP response value between 200&ndash;299 within a time interval that depends on the <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/modules#Java_Instance_scaling_and_class" id="z79cjn8_159" data-external="true" rel="noopener noreferrer" target="_blank">scaling type</a> of the App Engine module that receives the request. This deadline is separate from user requests, which have a 60-second deadline.</p><p id="z79cjn8_157">Tasks targeted at an automatic scaled module must finish execution within 10 minutes. If you have tasks that require more time or computing resources, they can be <span id="z79cjn8_160">sent to manual or basic scaling modules</span>, where they can run up to 24 hours. If the task fails to respond within the deadline, or returns an invalid response value, the task will be retried as described in the next section.</p><p id="z79cjn8_158">When a task's execution time nears the deadline, App Engine raises a <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/apphosting/api/DeadlineExceededException" id="z79cjn8_161" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="z79cjn8_162">DeadlineExceededException</code></a> before the deadline is reached, so you can save your work or log whatever progress was made.</p></section><section class="chapter"><h3 id="task-retries" data-toc="task-retries">Task retries</h3><p id="z79cjn8_163">If a push task request handler returns an HTTP status code within the range 200&ndash;299, App Engine considers the task to have completed successfully. If the task returns a status code outside of this range, App Engine retries the task until it succeeds. The system backs off gradually to avoid flooding your application with too many requests, but schedules retry attempts for failed tasks to recur at a maximum of once per hour.</p><p id="z79cjn8_164">You can also configure your own scheme for task retries using the <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/config/queue#Configuring_Retry_Attempts_for_Failed_Tasks" id="z79cjn8_166" data-external="true" rel="noopener noreferrer" target="_blank">retry-parameters element</a> in <code class="code" id="z79cjn8_167">queue.xml</code>.</p><p id="z79cjn8_165">When implementing the code for tasks (as worker URLs within your app), it is important to consider whether the task is <a href="https://web.archive.org/web/20160424230340/https://en.wikipedia.org/wiki/idempotent" id="z79cjn8_168" data-external="true" rel="noopener noreferrer" target="_blank">idempotent</a>. App Engine's Task Queue API is designed to only invoke a given task once; however, it is possible in exceptional circumstances that a task may execute multiple times (such as in the unlikely case of major system failure). Thus, your code must ensure that there are no harmful side-effects of repeated execution.</p></section><section class="chapter"><h3 id="the-rate-of-task-execution" data-toc="the-rate-of-task-execution">The rate of task execution</h3><p id="z79cjn8_169">You set the maximum processing rate for the entire queue when you <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/config/queue" id="z79cjn8_171" data-external="true" rel="noopener noreferrer" target="_blank">configure the queue</a>. App Engine uses a <a href="https://web.archive.org/web/20160424230340/https://en.wikipedia.org/wiki/Token_bucket" id="z79cjn8_172" data-external="true" rel="noopener noreferrer" target="_blank">token bucket algorithm</a> to execute tasks once they've been delivered to the queue. Each queue has a token bucket, and each bucket holds a certain number of tokens. Your app consumes a token each time it executes a task. If the bucket runs out of tokens, the system pauses until the bucket has more tokens. The rate at which the bucket is refilled is the limiting factor that determines the rate of the queue. See <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/config/queue" id="z79cjn8_173" data-external="true" rel="noopener noreferrer" target="_blank">Defining Push Queues and Processing Rates</a> for more details. See also <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/RetryOptions" id="z79cjn8_174" data-external="true" rel="noopener noreferrer" target="_blank">RetryOptions</a>.</p><p id="z79cjn8_170">To ensure that the Task Queue system does not overwhelm your application, it may throttle the rate at which requests are sent. This throttled rate is known as the <span class="emphasis" id="z79cjn8_175">enforced rate</span>. The enforced rate may be decreased when your application returns a 503 HTTP response code, or if there are no instances able to execute a request for an extended period of time. You can view the enforced rate on the Cloud Platform Console <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/developers-console/#queues" id="z79cjn8_176" data-external="true" rel="noopener noreferrer" target="_blank">Task queues page</a>.</p></section><section class="chapter"><h3 id="the-order-of-task-execution" data-toc="the-order-of-task-execution">The order of task execution</h3><p id="z79cjn8_177">There are no guarantees or promises regarding the execution order of task queues. Even in the average case, execution order can be significantly different from FIFO order. The order in which tasks are executed depends on several factors:</p><ul class="list _bullet" id="z79cjn8_178"><li class="list__item" id="z79cjn8_179"><p id="z79cjn8_183"><span class="control" id="z79cjn8_184">The position of the task in the queue.</span> App Engine attempts to process tasks based on FIFO (first in, first out) order. In general, tasks are inserted into the end of a queue and executed from the head of the queue. However, the logic that executes tasks may prioritize performance over preserving order. Users should expect tasks to arrive out of order regularly, often significantly out of order.</p></li><li class="list__item" id="z79cjn8_180"><p id="z79cjn8_185"><span class="control" id="z79cjn8_186">The backlog of tasks in the queue.</span> The system attempts to deliver the lowest latency possible for any given task via specially optimized notifications to the scheduler. Thus, in the case that a queue has a large backlog of tasks, the system's scheduling may &quot;jump&quot; new tasks to the head of the queue.</p></li><li class="list__item" id="z79cjn8_181"><p id="z79cjn8_187"><span class="control" id="z79cjn8_188">The value of the task's <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TaskOptions#etaMillis(long)" id="z79cjn8_189" data-external="true" rel="noopener noreferrer" target="_blank">etaMillis</a> property</span>. This specifies the earliest time that a task can execute. App Engine always waits until after the specified ETA to process push tasks.</p></li><li class="list__item" id="z79cjn8_182"><p id="z79cjn8_190"><span class="control" id="z79cjn8_191">The value of the task's <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TaskOptions#countdownMillis(long)" id="z79cjn8_192" data-external="true" rel="noopener noreferrer" target="_blank">countdownMillis</a> property.</span> This specifies the minimum number of seconds to wait before executing a task. Countdown and eta are mutually exclusive; if you specify one, do not specify the other.</p></li></ul></section></section><section class="chapter"><h2 id="deferred-tasks" data-toc="deferred-tasks">Deferred tasks</h2><p id="z79cjn8_193">Setting up a handler for each distinct task (as described in the previous sections) can be cumbersome, as can serializing and deserializing complex arguments for the task &mdash; particularly if you have many diverse but small tasks that you want to run on the queue. The Java SDK includes an interface called <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/DeferredTask" id="z79cjn8_198" data-external="true" rel="noopener noreferrer" target="_blank">DeferredTask</a>. This interface lets you define a task as a single method. This interface uses Java serialization to package a unit of work into a Task Queue. A simple return from that method is considered success. Throwing any exception from that method is considered a failure.</p><p id="z79cjn8_194"><a href="https://web.archive.org/web/20160424230340/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/taskqueue/deferred/src/main/java/com/google/cloud/taskqueue/samples/DeferSampleServlet.java" id="z79cjn8_199" data-external="true" rel="noopener noreferrer" target="_blank">taskqueue/deferred/src/main/java/com/google/cloud/taskqueue/samples/DeferSampleServlet.java</a></p><p id="z79cjn8_195"><a href="https://web.archive.org/web/20160424230340/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/taskqueue/deferred/src/main/java/com/google/cloud/taskqueue/samples/DeferSampleServlet.java" id="z79cjn8_200" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="z79cjn8_196">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="z79cjn8_197"><span class="control" id="z79cjn8_201">Warning:</span> While the DeferredTask API is a convenient way to handle serialization, you have to carefully control the serialization compatibility of objects passed into <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TaskOptions#payload(byte%5B%5D,%20java.lang.String)" id="z79cjn8_202" data-external="true" rel="noopener noreferrer" target="_blank">payload</a> methods. Careful control is necessary because unprocessed objects remain in the task queue, even after the application code is updated. Tasks based on outdated application code will not deserialize properly when the task is decoded with new revisions of the application.</p></section><section class="chapter"><h2 id="url-endpoints" data-toc="url-endpoints">URL endpoints</h2><p id="z79cjn8_203">Push tasks reference their implementation via URL. For example, a task which fetches and parses an RSS feed might use a worker URL called <code class="code" id="z79cjn8_210">/app_worker/fetch_feed</code>. You can specify this worker URL or use the default. In general, you can use any URL as the worker for a task, so long as it is within your application; all task worker URLs must be specified as relative URLs:</p><div class="code-block" data-lang="none">
import com.google.appengine.api.taskqueue.Queue;
import com.google.appengine.api.taskqueue.QueueFactory;
import com.google.appengine.api.taskqueue.TaskOptions.Method;
import com.google.appengine.api.taskqueue.TaskOptions;

// ...
    Queue queue = QueueFactory.getDefaultQueue();
    queue.add(TaskOptions.Builder.withUrl(&quot;/path/to/my/worker&quot;));
    queue.add(TaskOptions.Builder.withUrl(&quot;/path?a=b&amp;c=d&quot;).method(Method.GET));
</div><p id="z79cjn8_205">If you do not specify a worker URL, the task uses a default worker URL named after the queue:</p><p id="z79cjn8_206"><code class="code" id="z79cjn8_211">/_ah/queue/queue_name</code></p><p id="z79cjn8_207">A queue's default URL is used if, and only if, a task does not have a worker URL of its own. If a task does have its own worker URL, then it is only invoked at the worker URL, never another. Once inserted into a queue, its url endpoint cannot be changed.</p><p id="z79cjn8_208"><span class="control" id="z79cjn8_212">Warning:</span> If a task does not have a worker URL, then the task is invoked against the queue's default URL, even if there is currently no handler defined for the queue's default URL. This results in a 404 which will be available, along with the exact URL that was tried, in your application's logs. Due to the failure state of this 404, the system saves the task and retries it until it is eventually successful. You can clear (or 'purge') tasks that can't complete successfully using the Cloud Platform Console.</p><section class="chapter"><h3 id="securing-urls-for-tasks" data-toc="securing-urls-for-tasks">Securing URLs for tasks</h3><p id="z79cjn8_213">If a task performs sensitive operations (such as modifying important data), you might want to secure its worker URL to prevent a malicious external user from calling it directly. You can prevent users from accessing URLs of tasks by restricting access to administrator accounts. Task queues can access admin-only URLs. You can read about restricting URLs at <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/config/webxml#Security_and_Authentication" id="z79cjn8_218" data-external="true" rel="noopener noreferrer" target="_blank">Security and Authentication</a>. An example you would use in <code class="code" id="z79cjn8_219">web.xml</code> to restrict everything starting with <code class="code" id="z79cjn8_220">/tasks/</code> to admin-only is:</p><div class="code-block" data-lang="none">
&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;tasks&lt;/web-resource-name&gt;
        &lt;url-pattern&gt;/tasks/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
        &lt;role-name&gt;admin&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
</div><p id="z79cjn8_215"><span class="control" id="z79cjn8_221">Note:</span> While task queues can use URL paths restricted with <code class="code" id="z79cjn8_222">&lt;role-name&gt;admin&lt;/role-name&gt;</code>, they <span class="emphasis" id="z79cjn8_223">cannot</span> use URL paths restricted with <code class="code" id="z79cjn8_224">&lt;role-name&gt;*&lt;/role-name&gt;</code>.</p><p id="z79cjn8_216">For more on the format of <code class="code" id="z79cjn8_225">web.xml</code>, see the documentation on <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/java/config/webxml" id="z79cjn8_226" data-external="true" rel="noopener noreferrer" target="_blank">the deployment descriptor</a>.</p><p id="z79cjn8_217">To test a task web hook, sign in as an administrator and visit the URL of the handler in your browser.</p></section></section><section class="chapter"><h2 id="calling-google-cloud-endpoints" data-toc="calling-google-cloud-endpoints">Calling Google Cloud Endpoints</h2><p id="z79cjn8_227">You cannot call a <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/features/#Endpoints" id="z79cjn8_228" data-external="true" rel="noopener noreferrer" target="_blank">Google Cloud Endpoint</a> from a push queue. Instead, you should issue a request to a target that is served by a handler that's specified in your app's configuration file or in a dispatch file. That handler then calls the appropriate endpoint class and method.</p></section><section class="chapter"><h2 id="push-queues-and-the-development-server" data-toc="push-queues-and-the-development-server">Push queues and the development server</h2><p id="z79cjn8_229">When your app is running in the development server, tasks are automatically executed at the appropriate time just as in production.</p><p id="z79cjn8_230">To disable automatic execution of tasks, set the following jvm flag:</p><div class="code-block" data-lang="none">
--jvm_flag=-Dtask_queue.disable_auto_task_execution=true
</div><p id="z79cjn8_232">You can examine and manipulate tasks from the Cloud Platform Console <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/developers-console/#queues" id="z79cjn8_236" data-external="true" rel="noopener noreferrer" target="_blank">Task queues page</a>.</p><p id="z79cjn8_233">To execute tasks, select the queue by clicking on its name, select the tasks to execute, and click <span class="control" id="z79cjn8_237">Run Now</span>. To clear a queue without executing any tasks, click <span class="control" id="z79cjn8_238">Purge Queue</span>.</p><p id="z79cjn8_234">The development server and the production server behave differently:</p><ul class="list _bullet" id="z79cjn8_235"><li class="list__item" id="z79cjn8_239"><p id="z79cjn8_242">The development server doesn't respect the <code class="code" id="z79cjn8_243">&lt;rate&gt;</code> and <code class="code" id="z79cjn8_244">&lt;bucket-size&gt;</code> attributes of your queues. As a result, tasks are executed as close to their ETA as possible. Setting a rate of 0 doesn't prevent tasks from being executed automatically.</p></li><li class="list__item" id="z79cjn8_240"><p id="z79cjn8_245">The development server doesn't retry tasks.</p></li><li class="list__item" id="z79cjn8_241"><p id="z79cjn8_246">The development server doesn't preserve queue state across server restarts.</p></li></ul></section><section class="chapter"><h2 id="quotas-and-limits-for-push-queues" data-toc="quotas-and-limits-for-push-queues">Quotas and limits for push queues</h2><p id="z79cjn8_247">Enqueuing a task in a push queue counts toward the following quotas:</p><ul class="list _bullet" id="z79cjn8_248"><li class="list__item" id="z79cjn8_258"><p id="z79cjn8_261">Task Queue Stored Task Count</p></li><li class="list__item" id="z79cjn8_259"><p id="z79cjn8_262">Task Queue Stored Task Bytes</p></li><li class="list__item" id="z79cjn8_260"><p id="z79cjn8_263">Task Queue API Calls</p></li></ul><p id="z79cjn8_249">The Task Queue Stored Task Bytes quota is configurable in queue.xml by setting <code class="code" id="z79cjn8_264">&lt;total-storage-limit&gt;</code>. This quota counts towards your Stored Data (billable) quota.</p><p id="z79cjn8_250">Execution of a task counts toward the following quotas:</p><ul class="list _bullet" id="z79cjn8_251"><li class="list__item" id="z79cjn8_265"><p id="z79cjn8_268">Requests</p></li><li class="list__item" id="z79cjn8_266"><p id="z79cjn8_269">Incoming Bandwidth</p></li><li class="list__item" id="z79cjn8_267"><p id="z79cjn8_270">Outgoing Bandwidth</p></li></ul><p id="z79cjn8_252">The act of executing a task consumes bandwidth-related quotas for the request and response data, just as if the request handler were called by a remote client. When the task queue processes a task, the response data is discarded.</p><p id="z79cjn8_253">Once a task has been executed or deleted, the storage used by that task is reclaimed. The reclaiming of storage quota for tasks happens at regular intervals, and this may not be reflected in the storage quota immediately after the task is deleted.</p><p id="z79cjn8_254">For more information on quotas, see <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/quotas" id="z79cjn8_271" data-external="true" rel="noopener noreferrer" target="_blank">Quotas</a>, and the Cloud Platform Console <a href="https://web.archive.org/web/20160424230340/https://cloud.google.com/appengine/docs/developers-console/#quotas" id="z79cjn8_272" data-external="true" rel="noopener noreferrer" target="_blank">Quota details page</a>).</p><p id="z79cjn8_255">The following limits apply to the use of push queues:</p><div class="table-wrapper"><table class="" id="z79cjn8_256"><thead><tr class="ijRowHead" id="z79cjn8_273"><th id="z79cjn8_279" colspan="2"><p>Push Queue Limits</p></th></tr></thead><tbody><tr id="z79cjn8_274"><td id="z79cjn8_280"><p>Maximum task size</p></td><td id="z79cjn8_281"><p>100KB</p></td></tr><tr id="z79cjn8_275"><td id="z79cjn8_282"><p>Queue execution rate</p></td><td id="z79cjn8_283"><p>500 task invocations per second per queue</p></td></tr><tr id="z79cjn8_276"><td id="z79cjn8_284"><p>Maximum countdown/ETA for a task</p></td><td id="z79cjn8_285"><p>30 days from the current date and time</p></td></tr><tr id="z79cjn8_277"><td id="z79cjn8_286"><p>Maximum number of tasks that can be added in a batch</p></td><td id="z79cjn8_287"><p>100 tasks</p></td></tr><tr id="z79cjn8_278"><td id="z79cjn8_288"><p>Maximum number of tasks that can be added in a transaction</p></td><td id="z79cjn8_289"><p>5 tasks</p></td></tr></tbody></table></div><div class="table-wrapper"><table class="" id="z79cjn8_257"><thead><tr class="ijRowHead" id="z79cjn8_290"><th id="z79cjn8_292" colspan="2"><p>Combined Limits (Push and Pull Queues)</p></th></tr></thead><tbody><tr id="z79cjn8_291"><td id="z79cjn8_293"><p>Maximum number of active queues (not including the default queue)</p></td><td id="z79cjn8_294"><p>Free apps: 10 queues, Billed apps: 100 queues</p></td></tr></tbody></table></div></section><div class="last-modified">10 April 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="task-queue-java-api-overview.html" class="navigation-links__prev">Task Queue Java API Overview</a><a href="using-pull-queues-in-java.html" class="navigation-links__next">Using Pull Queues in Java</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>