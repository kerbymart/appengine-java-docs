<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-13T01:56:45.644865762"><title>Using Endpoints in an Android Client | Google App Engine Java Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"making-authenticated-calls","level":0,"title":"Making authenticated calls","anchor":"#making-authenticated-calls"},{"id":"testing-an-android-client-against-a-local-development-server","level":0,"title":"Testing an Android client against a local development server","anchor":"#testing-an-android-client-against-a-local-development-server"},{"id":"sample-client-source-code","level":0,"title":"Sample client source code","anchor":"#sample-client-source-code"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Using Endpoints in an Android Client | Google App Engine Java Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Google App Engine Java Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/using-endpoints-in-an-android-client.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Using Endpoints in an Android Client | Google App Engine Java Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/using-endpoints-in-an-android-client.html#webpage",
    "url": "writerside-documentation/using-endpoints-in-an-android-client.html",
    "name": "Using Endpoints in an Android Client | Google App Engine Java Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Google App Engine Java Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="Using-Endpoints-in-an-Android-Client" data-main-title="Using Endpoints in an Android Client" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Guides.md|Guides///Mobile-Backends.md|Mobile Backends///Using-Endpoints-in-Clients.md|Using Endpoints in Clients"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Google App Engine Java Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Using-Endpoints-in-an-Android-Client" id="Using-Endpoints-in-an-Android-Client.md">Using Endpoints in an Android Client</h1><p id="jl085w_3"><span class="control" id="jl085w_10">Note:</span> These instructions assume familiarity with Android development and concepts including project setup, Activities and AsyncTasks classes, shared preferences, Android permissions, and Intents. If you would like to learn more about these concepts, refer to the <a href="https://web.archive.org/web/20160424225324/http://developer.android.com/" id="jl085w_11" data-external="true" rel="noopener noreferrer" target="_blank">Android documentation and examples</a>.</p><p id="jl085w_4">The recommended way to add a backend to a new or existing Android app is to use Android Studio's <a href="https://web.archive.org/web/20160424225324/https://cloud.google.com/mobile/endpoints/add_module" id="jl085w_12" data-external="true" rel="noopener noreferrer" target="_blank">backend templates for endpoints</a> feature. In addition to supporting the addition of an Endpoints backend, Android Studio also provides code validation of your backend, lets you debug the backend along with the Android app, and deploys your backend to production App Engine.</p><p id="jl085w_5">You can find the following complete instructions for using this feature to add a backend to your Android project in the README at this GitHub repo:</p><ul class="list _bullet" id="jl085w_6"><li class="list__item" id="jl085w_13"><p id="jl085w_14"><a href="https://web.archive.org/web/20160424225324/https://github.com/GoogleCloudPlatform/gradle-appengine-templates/tree/master/HelloEndpoints" id="jl085w_15" data-external="true" rel="noopener noreferrer" target="_blank">Simple Hello Endpoints</a>: shows the basics of adding a backend and connecting it to your Android app.</p></li></ul><section class="chapter"><h2 id="making-authenticated-calls" data-toc="making-authenticated-calls">Making authenticated calls</h2><p id="jl085w_16"><span class="control" id="jl085w_22">Important:</span> For information on authentication from the perspective of keeping the backend secure, see the blog post <a href="https://web.archive.org/web/20160424225324/https://android-developers.blogspot.com/2013/01/verifying-back-end-calls-from-android.html" id="jl085w_23" data-external="true" rel="noopener noreferrer" target="_blank">Verifying Back-End Calls from Android Apps</a>.</p><p id="jl085w_17">These instructions cover only the client coding you need to add. They assume that you have already added the Endpoints support for auth as described in <a href="https://web.archive.org/web/20160424225324/https://cloud.google.com/appengine/docs/java/endpoints/auth" id="jl085w_24" data-external="true" rel="noopener noreferrer" target="_blank">Adding Authentication to Endpoints</a>.</p><p id="jl085w_18">If your Android client is making calls to an Endpoint that requires authentication, you must:</p><ul class="list _bullet" id="jl085w_19"><li class="list__item" id="jl085w_25"><p id="jl085w_27"><span id="jl085w_28">Configure your Android Client</span> to provide credentials to the <span id="jl085w_29">service object</span>.</p></li><li class="list__item" id="jl085w_26"><p id="jl085w_30">Use the <span id="jl085w_31">account picker</span> to support user choice of login accounts.</p></li></ul><section class="chapter"><h3 id="configuring-your-android-client-to-provide-credentials" data-toc="configuring-your-android-client-to-provide-credentials">Configuring Your Android client to provide credentials</h3><p id="jl085w_32">To support requests to an Endpoint that requires authentication, your Android client needs to get user credentials and pass them to the <span id="jl085w_39">service object</span>.</p><p id="jl085w_33">Getting the user credentials and using the <span id="jl085w_40">account picker</span> requires you to have the following Android permissions:</p><div class="code-block" data-lang="none">
&lt;uses-permission android:name=&quot;android.permission.GET_ACCOUNTS&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.USE_CREDENTIALS&quot; /&gt;
</div><p id="jl085w_35">To get the user credentials, you call <code class="code" id="jl085w_41">GoogleAccountCredential.usingAudience</code> as follows:</p><div class="code-block" data-lang="none">
// Inside your Activity class onCreate method
settings = getSharedPreferences(
    &quot;TicTacToeSample&quot;, 0);
credential = GoogleAccountCredential.usingAudience(this,
    &quot;server:client_id:1-web-app.apps.googleusercontent.com&quot;);
</div><p id="jl085w_37">where the second parameter to the call is the prefix <code class="code" id="jl085w_42">server:client_id</code> prepended to the web client ID of the backend API.</p><section class="chapter"><h4 id="sample-code-getting-credentials-for-the-service-object" data-toc="sample-code-getting-credentials-for-the-service-object">Sample code: getting credentials for the service object</h4><p id="jl085w_43">The following code shows how to get credentials and pass it to the service object:</p><div class="code-block" data-lang="none">
// Inside your Activity class onCreate method
settings = getSharedPreferences(&quot;TicTacToeSample&quot;, 0);
credential = GoogleAccountCredential.usingAudience(this,
    &quot;server:client_id:1-web-app.apps.googleusercontent.com&quot;);
setSelectedAccountName(settings.getString(PREF_ACCOUNT_NAME, null));

Tictactoe.Builder builder = new Tictactoe.Builder(
    AndroidHttp.newCompatibleTransport(), new GsonFactory(),
    credential);
service = builder.build();

if (credential.getSelectedAccountName() != null) {
  // Already signed in, begin app!
} else {
  // Not signed in, show login window or request an account.
}

// setSelectedAccountName definition
private void setSelectedAccountName(String accountName) {
  SharedPreferences.Editor editor = settings.edit();
  editor.putString(PREF_ACCOUNT_NAME, accountName);
  editor.commit();
  credential.setSelectedAccountName(accountName);
  this.accountName = accountName;
}
</div><p id="jl085w_45">The above sample code looks up any shared preferences stored by the Android app and attempts to find the name of the account the user would like to use to authenticate to your application. If successful, the code creates a credentials object and passes it into your service object. These credentials allow your Android application to pass the appropriate token to your backend.</p><p id="jl085w_46">Notice that the code sample checks to see whether or not the Android app already knows which account to use. If it does, the logical flow can continue on and run the Android app. If the app doesn't know which account to use, the app should display a login screen or prompt the user to <span id="jl085w_48">pick an account</span>.</p><p id="jl085w_47">Finally, the sample creates a credentials object and passes it into the service object. These credentials allow your Android application to pass the appropriate token to your App Engine web app.</p></section></section><section class="chapter"><h3 id="using-the-account-picker" data-toc="using-the-account-picker">Using the account picker</h3><p id="jl085w_49">Android provides an intent to select a user account. You can invoke this as follows:</p><div class="code-block" data-lang="none">
static final int REQUEST_ACCOUNT_PICKER = 2;

void chooseAccount() {
  startActivityForResult(credential.newChooseAccountIntent(),
      REQUEST_ACCOUNT_PICKER);
}
</div><p id="jl085w_51">A handler for interpreting the result of this intent is shown here:</p><div class="code-block" data-lang="none">
@Override
protected void onActivityResult(int requestCode, int resultCode,
   Intent data) {
 super.onActivityResult(requestCode, resultCode, data);
 switch (requestCode) {
   case REQUEST_ACCOUNT_PICKER:
     if (data != null &amp;&amp; data.getExtras() != null) {
       String accountName =
           data.getExtras().getString(
               AccountManager.KEY_ACCOUNT_NAME);
       if (accountName != null) {
         setSelectedAccountName(accountName);
         SharedPreferences.Editor editor = settings.edit();
         editor.putString(PREF_ACCOUNT_NAME, accountName);
         editor.commit();
         // User is authorized.
       }
     }
     break;
  }
}
</div></section></section><section class="chapter"><h2 id="testing-an-android-client-against-a-local-development-server" data-toc="testing-an-android-client-against-a-local-development-server">Testing an Android client against a local development server</h2><p id="jl085w_53">You can test your client against a backend API running in production App Engine at any time without making any changes. However, if you want to test your client against a backend API running on the local development server, you'll need to change one line of code in the client to point to the IP address of the machine running the local development server.</p><p id="jl085w_54"><span class="control" id="jl085w_58">Note:</span> You can use either an Android AVD emulator, or a physical device. However, physical devices must use the same Wi Fi as the system running the local development server.</p><p id="jl085w_55">To make the required changes and test using the local dev server:</p><ol class="list _decimal" id="jl085w_56" type="1"><li class="list__item" id="jl085w_59"><p id="jl085w_66">Note the IP address of the machine that is running the local dev server: you need it when you add code to the Android client.</p></li><li class="list__item" id="jl085w_60"><p id="jl085w_67">Start the local development server, as described in <a href="https://web.archive.org/web/20160424225324/https://cloud.google.com/appengine/docs/java/endpoints/test_deploy#running_and_testing_api_backends_locally" id="jl085w_68" data-external="true" rel="noopener noreferrer" target="_blank">Running and testing API backends locally</a>. You may need to specify the address <code class="code" id="jl085w_69">0.0.0.0</code> as described at that link.</p></li><li class="list__item" id="jl085w_61"><p id="jl085w_70">In your Android Studio client project, locate the code that gets the handle to the backend API service; typically, this code will use a <code class="code" id="jl085w_71">Builder</code> to set up the API request.</p></li><li class="list__item" id="jl085w_62"><p id="jl085w_72">Override the root URL on the Builder object (this is the URL the Android client connects to in the backend API call) by adding the line:</p><div class="code-block" data-lang="none">
yourBuilderObject.setRootUrl(&quot;http://&lt;your-machine-IP-address&gt;:8080/_ah/api&quot;);
</div><p id="jl085w_74">For example:</p><div class="code-block" data-lang="none">
public static Helloworld getApiServiceHandle(@Nullable GoogleAccountCredential credential) {
  // Use a builder to help formulate the API request.
  Helloworld.Builder helloWorld = new Helloworld.Builder(AppConstants.HTTP_TRANSPORT,
      AppConstants.JSON_FACTORY,credential);

  helloWorld.setRootUrl(&quot;http://&lt;your-machine-IP-address&gt;:8080/_ah/api&quot;);
  return helloWorld.build();
}
</div><p id="jl085w_76">Be sure to replace <code class="code" id="jl085w_77">&lt;your-machine-IP-address&gt;</code> with your system's actual IP value.</p></li><li class="list__item" id="jl085w_63"><p id="jl085w_78">Rebuild your Android client project.</p></li><li class="list__item" id="jl085w_64"><p id="jl085w_79">If you want to run your client app on an AVD emulator:</p><ol class="list _decimal" id="jl085w_80" type="1"><li class="list__item" id="jl085w_81"><p id="jl085w_85">In Android Studio, select <span class="control" id="jl085w_86">Tools</span> &gt; <span class="control" id="jl085w_87">Android</span> &gt; <span class="control" id="jl085w_88">AVD Manager</span> and start an existing AVD if you have one, otherwise create one first and start it.</p></li><li class="list__item" id="jl085w_82"><p id="jl085w_89">Select <span class="control" id="jl085w_90">Run</span> &gt; <span class="control" id="jl085w_91">Debug <code class="code" id="jl085w_92">&lt;your-project-name&gt;</code></span>.</p></li><li class="list__item" id="jl085w_83"><p id="jl085w_93">Select your AVD when prompted to choose a device.</p></li><li class="list__item" id="jl085w_84"><p id="jl085w_94">Test your client as desired.</p></li></ol></li><li class="list__item" id="jl085w_65"><p id="jl085w_95">If you want to run your client app on a physical Android device,</p><ol class="list _decimal" id="jl085w_96" type="1"><li class="list__item" id="jl085w_97"><p id="jl085w_101">Make sure your Android device is <a href="https://web.archive.org/web/20160424225324/http://developer.android.com/tools/device.html#setting-up" id="jl085w_102" data-external="true" rel="noopener noreferrer" target="_blank">enabled for debugging</a>.</p></li><li class="list__item" id="jl085w_98"><p id="jl085w_103">In Android Studio, select <span class="control" id="jl085w_104">Run</span> &gt; <span class="control" id="jl085w_105">Debug <code class="code" id="jl085w_106">&lt;your-project-name&gt;</code></span>.</p></li><li class="list__item" id="jl085w_99"><p id="jl085w_107">Select your physical Android device when prompted to choose a device.</p></li><li class="list__item" id="jl085w_100"><p id="jl085w_108">Test your client as desired.</p></li></ol></li></ol><p id="jl085w_57"><span class="control" id="jl085w_109">Important:</span> If the backend API is Auth-protected, your client must provide support as described above under Adding Authentication Support with OAuth 2.0. However, when running against the local dev server, no credentials page is displayed in response to a user's attempt to sign in. Instead, the sign-on simply occurs, granting the user access to the protected API, <span class="emphasis" id="jl085w_110">and the user returned is always <code class="code" id="jl085w_111">example@example.com</code></span>.</p></section><section class="chapter"><h2 id="sample-client-source-code" data-toc="sample-client-source-code">Sample client source code</h2><p id="jl085w_112">For a complete sample client that illustrates the concepts described above, see the <a href="https://web.archive.org/web/20160424225324/https://cloud.google.com/appengine/docs/java/endpoints/getstarted/clients/android/" id="jl085w_113" data-external="true" rel="noopener noreferrer" target="_blank">Android client tutorial</a>.</p></section><div class="last-modified">10 April 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="using-endpoints-in-a-javascript-client.html" class="navigation-links__prev">Using Endpoints in a JavaScript Client</a><a href="using-endpoints-in-an-ios-client.html" class="navigation-links__next">Using Endpoints in an iOS Client</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>