<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-13T01:56:44.309338003"><title>Storing Data in Datastore | Google App Engine Java Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"setting-up-objectify","level":0,"title":"Setting up Objectify","anchor":"#setting-up-objectify"},{"id":"creating-the-data-model-classes","level":0,"title":"Creating the data model classes","anchor":"#creating-the-data-model-classes"},{"id":"adding-the-greetings-and-the-form-to-the-jsp-template","level":0,"title":"Adding the greetings and the form to the JSP template","anchor":"#adding-the-greetings-and-the-form-to-the-jsp-template"},{"id":"creating-the-form-handling-servlet","level":0,"title":"Creating the form handling servlet","anchor":"#creating-the-form-handling-servlet"},{"id":"testing-the-app","level":0,"title":"Testing the app","anchor":"#testing-the-app"},{"id":"creating-required-indexes","level":0,"title":"Creating required indexes","anchor":"#creating-required-indexes"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Storing Data in Datastore | Google App Engine Java Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Google App Engine Java Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/storing-data-in-datastore.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Storing Data in Datastore | Google App Engine Java Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/storing-data-in-datastore.html#webpage",
    "url": "writerside-documentation/storing-data-in-datastore.html",
    "name": "Storing Data in Datastore | Google App Engine Java Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Google App Engine Java Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="Storing-Data-in-Datastore" data-main-title="Storing Data in Datastore" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Quickstarts.md|Quickstarts///Creating-a-Guestbook.md|Creating a Guestbook"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Google App Engine Java Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Storing-Data-in-Datastore" id="Storing-Data-in-Datastore.md">Storing Data in Datastore</h1><ol class="list _decimal" id="-75ibra_3" type="1"><li class="list__item" id="-75ibra_18"><p id="-75ibra_24"><span id="-75ibra_25">Setting up Objectify</span></p></li><li class="list__item" id="-75ibra_19"><p id="-75ibra_26"><span id="-75ibra_27">Creating the data model classes</span></p></li><li class="list__item" id="-75ibra_20"><p id="-75ibra_28"><span id="-75ibra_29">Adding the greetings and the form to the JSP template</span></p></li><li class="list__item" id="-75ibra_21"><p id="-75ibra_30"><span id="-75ibra_31">Creating the form handling servlet</span></p></li><li class="list__item" id="-75ibra_22"><p id="-75ibra_32"><span id="-75ibra_33">Testing the app</span></p></li><li class="list__item" id="-75ibra_23"><p id="-75ibra_34"><span id="-75ibra_35">Creating required indexes</span></p></li></ol><p id="-75ibra_4">In this section, you'll extend the simple application created earlier by adding the ability to post greetings and display previously posted greetings. You'll add a new servlet that handles the form submission and save the data.</p><p id="-75ibra_5">The database we are using is <a href="https://web.archive.org/web/20160424225648/https://cloud.google.com/appengine/docs/java/datastore" id="-75ibra_36" data-external="true" rel="noopener noreferrer" target="_blank">Google Cloud Datastore</a>, a scalable, highly reliable data storage service that's easy to use from App Engine. Unlike a relational database, the Datastore is a schemaless object store, with an index-based query engine and transactional capabilities.</p><p id="-75ibra_6">This tutorial uses the <a href="https://web.archive.org/web/20160424225648/https://github.com/objectify/objectify" id="-75ibra_37" data-external="true" rel="noopener noreferrer" target="_blank">Objectify</a> library, a Java data modeling library for the Datastore. There are several alternative APIs you can use: a simple <a href="https://web.archive.org/web/20160424225648/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/datastore/package-summary" id="-75ibra_38" data-external="true" rel="noopener noreferrer" target="_blank">low-level API</a>, implementations of the <a href="https://web.archive.org/web/20160424225648/http://db.apache.org/jdo/index" id="-75ibra_39" data-external="true" rel="noopener noreferrer" target="_blank">Java Data Objects (JDO)</a> and <a href="https://web.archive.org/web/20160424225648/http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html" id="-75ibra_40" data-external="true" rel="noopener noreferrer" target="_blank">Java Persistence API (JPA)</a> interfaces, or the <a href="https://web.archive.org/web/20160424225648/http://sites.google.com/site/slim3appengine/" id="-75ibra_41" data-external="true" rel="noopener noreferrer" target="_blank">Slim3</a> library.</p><p id="-75ibra_7">This is what the app will look like after you add the message submission form:</p><figure id="-75ibra_8"><img alt="Hello_UI" src="https://web.archive.org/web/20160424225648im_/https://cloud.google.com/appengine/docs/java/gettingstarted/images/hello-2.png" title="Hello_UI"></figure><p id="-75ibra_9">You'll make these changes to your existing application:</p><ul class="list _bullet" id="-75ibra_10"><li class="list__item" id="-75ibra_42"><p id="-75ibra_46">Set up Objectify, and create data model classes for the guestbook.</p></li><li class="list__item" id="-75ibra_43"><p id="-75ibra_47">Edit the JSP page to allow users to post greetings to the datastore, and to display all the greetings currently stored.</p></li><li class="list__item" id="-75ibra_44"><p id="-75ibra_48">Create a new servlet named <code class="code" id="-75ibra_49">SignGuestbookServlet</code> that handles the form submission.</p></li><li class="list__item" id="-75ibra_45"><p id="-75ibra_50">Add entries in <code class="code" id="-75ibra_51">web.xml</code> so requests can be routed to the new servlet.</p></li></ul><p id="-75ibra_11"><span class="control" id="-75ibra_52">Note:</span> If you're following along using <a href="https://web.archive.org/web/20160424225648/https://github.com/GoogleCloudPlatform/appengine-java-guestbook-multiphase" id="-75ibra_53" data-external="true" rel="noopener noreferrer" target="_blank">the Github repo for this tutorial</a>, the code in this section is in the <span class="control" id="-75ibra_54">final</span> subdirectory.</p><section class="chapter"><h2 id="setting-up-objectify" data-toc="setting-up-objectify">Setting up Objectify</h2><p id="-75ibra_55">To use the Objectify library, you must declare the dependency in the <code class="code" id="-75ibra_63">pom.xml</code> file, so Maven can install it. In the application root directory (<code class="code" id="-75ibra_64">guestbook/</code>), edit <code class="code" id="-75ibra_65">pom.xml</code>, locate the <code class="code" id="-75ibra_66">&lt;dependencies&gt;</code> section, then add the following:</p><div class="code-block" data-lang="none">
&lt;dependency&gt;
    &lt;groupId&gt;com.googlecode.objectify&lt;/groupId&gt;
    &lt;artifactId&gt;objectify&lt;/artifactId&gt;
    &lt;version&gt;4.0.1&lt;/version&gt;
&lt;/dependency&gt;
</div><p id="-75ibra_57">Maven will install the library the next time you run a target that needs it (such as the development server).</p><p id="-75ibra_58">In order to use Objectify in a JSP, we need a helper class that registers the model classes in the JSP servlet context. In <code class="code" id="-75ibra_67">guestbook/src/main/java/com/example/guestbook/</code>, create a file named <code class="code" id="-75ibra_68">OfyHelper.java</code> with the following contents:</p><p id="-75ibra_59">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="-75ibra_60">This file refers to the <code class="code" id="-75ibra_69">Greeting</code> and <code class="code" id="-75ibra_70">Guestbook</code> model classes that you'll create in the next section.</p><p id="-75ibra_61">Finally, in <code class="code" id="-75ibra_71">guestbook/src/main/webapp/WEB-INF/</code>, edit <code class="code" id="-75ibra_72">web.xml</code>, and add the following lines inside <code class="code" id="-75ibra_73">&lt;web-app&gt;</code> to set up the JSP helper:</p><p id="-75ibra_62">\[This section requires a browser that supports JavaScript and iframes.\]</p></section><section class="chapter"><h2 id="creating-the-data-model-classes" data-toc="creating-the-data-model-classes">Creating the data model classes</h2><p id="-75ibra_74">With Objectify, you create classes whose instances will represent <span class="emphasis" id="-75ibra_80">datastore entities</span> in your code. Objectify does the work of translating these Java objects to datastore entities.</p><p id="-75ibra_75">Create a <code class="code" id="-75ibra_81">Greeting</code> class to represent a message posted by a user. In <code class="code" id="-75ibra_82">guestbook/src/main/java/com/example/guestbook/</code>, create a file named <code class="code" id="-75ibra_83">Greeting.java</code> with the following contents:</p><p id="-75ibra_76">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="-75ibra_77">We also need a <code class="code" id="-75ibra_84">Guestbook</code> class to represent an entire guestbook. While this example doesn't explicitly create a <code class="code" id="-75ibra_85">Guestbook</code> object in the datastore, it uses this class as part of the <span class="emphasis" id="-75ibra_86">datastore key</span> for the <code class="code" id="-75ibra_87">Greeting</code> objects. This demonstrates how you might define keys so that all of the greetings in a guestbook could be updated in a single <span class="emphasis" id="-75ibra_88">datastore transaction</span>.</p><p id="-75ibra_78">Create a file named <code class="code" id="-75ibra_89">Guestbook.java</code> with the following contents:</p><p id="-75ibra_79">\[This section requires a browser that supports JavaScript and iframes.\]</p></section><section class="chapter"><h2 id="adding-the-greetings-and-the-form-to-the-jsp-template" data-toc="adding-the-greetings-and-the-form-to-the-jsp-template">Adding the greetings and the form to the JSP template</h2><p id="-75ibra_90">In <code class="code" id="-75ibra_96">guestbook/src/main/webapp</code>, edit <code class="code" id="-75ibra_97">guestbook.jsp</code>. Add the following lines to the imports at the top:</p><p id="-75ibra_91">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="-75ibra_92">Just above the line <code class="code" id="-75ibra_98">&lt;form action=&quot;/guestbook.jsp&quot; method=&quot;get&quot;&gt;</code>, add the following code:</p><p id="-75ibra_93">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="-75ibra_94">When the user loads the page, the template performs a <span class="emphasis" id="-75ibra_99">datastore query</span> for all <code class="code" id="-75ibra_100">Greeting</code> entities that use the same <code class="code" id="-75ibra_101">Guestbook</code> in their key. The query is sorted by date in reverse chronological order (<code class="code" id="-75ibra_102">&quot;-date&quot;</code>), and results are limited to the five most recent greetings. The rest of the template displays the results as HTML, and also renders the form that the user can use to post a new greeting.</p><p id="-75ibra_95">See <a href="https://web.archive.org/web/20160424225648/https://cloud.google.com/appengine/docs/java/datastore/queries" id="-75ibra_103" data-external="true" rel="noopener noreferrer" target="_blank">Datastore Queries</a> to learn more about queries.</p></section><section class="chapter"><h2 id="creating-the-form-handling-servlet" data-toc="creating-the-form-handling-servlet">Creating the form handling servlet</h2><p id="-75ibra_104">The web form sends an HTTP POST request to the <code class="code" id="-75ibra_111">/sign</code> URL. Let's create a servlet to handle these requests.</p><p id="-75ibra_105">In <code class="code" id="-75ibra_112">guestbook/src/main/java/com/example/guestbook</code>, create a file named <code class="code" id="-75ibra_113">SignGuestbookServlet.java</code>, and give it the following contents:</p><p id="-75ibra_106">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="-75ibra_107"><span class="control" id="-75ibra_114">Note:</span> <code class="code" id="-75ibra_115">SignGuestbookServlet.java</code> replaces the functionality provided by <code class="code" id="-75ibra_116">GuestbookServlet.java</code>, which is now no longer needed.</p><p id="-75ibra_108">This servlet is the POST handler for the greetings posted by users. It takes the the greeting (<code class="code" id="-75ibra_117">content</code>) from the incoming request and stores it in Datastore as a <code class="code" id="-75ibra_118">Greeting</code> entity. Its properties include the content of the post, the date the post was created, and, if the user is signed in, the author's ID and email address. For more information about entities in App Engine, see <a href="https://web.archive.org/web/20160424225648/https://cloud.google.com/appengine/docs/java/datastore/entities" id="-75ibra_119" data-external="true" rel="noopener noreferrer" target="_blank">Entities, Properties, and Keys</a>.</p><p id="-75ibra_109">Finally, in <code class="code" id="-75ibra_120">guestbook/src/main/webapp/WEB-INF/</code>, edit <code class="code" id="-75ibra_121">web.xml</code> and ensure the new servlets have URLs mapped. The final version should look like this:</p><p id="-75ibra_110">\[This section requires a browser that supports JavaScript and iframes.\]</p></section><section class="chapter"><h2 id="testing-the-app" data-toc="testing-the-app">Testing the app</h2><p id="-75ibra_122">Restart the development server to build and run the app:</p><div class="code-block" data-lang="none">
mvn appengine:devserver
</div><p id="-75ibra_124">Visit the app in a browser:</p><p id="-75ibra_125"><a href="https://web.archive.org/web/20160424225648/https://cloud.google.com/appengine/docs/java/gettingstarted/localhost:8080" id="-75ibra_127" data-external="true" rel="noopener noreferrer" target="_blank">localhost:8080</a></p><p id="-75ibra_126">Try posting a greeting. Also try posting a greeting while signed in, and while not signed in.</p></section><section class="chapter"><h2 id="creating-required-indexes" data-toc="creating-required-indexes">Creating required indexes</h2><p id="-75ibra_128">If your app uses the Datastore, when you run your app on the development server, the development server automatically creates any Datastore indexes required to run in production App Engine. These indexes are generated in <code class="code" id="-75ibra_135">guestbook/target/guestbook-1.0-SNAPSHOT/WEB-INF/appengine-generated/datastore-indexes-auto.xml</code>. You'll also notice the file <code class="code" id="-75ibra_136">local_db.bin</code> at that same location: this is local storage for the development server to persist your app data between development server sessions. The file <code class="code" id="-75ibra_137">datastore-indexes-auto.xml</code> is automatically uploaded along with your app. <code class="code" id="-75ibra_138">local_db.bin</code> is not uploaded.</p><p id="-75ibra_129"><span class="control" id="-75ibra_139">Important:</span> Be aware that running <code class="code" id="-75ibra_140">mvn clean install</code> clears the <code class="code" id="-75ibra_141">datastore-indexes-auto.xml</code> file; if you run it on your app prior to <a href="https://web.archive.org/web/20160424225648/https://cloud.google.com/appengine/docs/java/gettingstarted/uploading" id="-75ibra_142" data-external="true" rel="noopener noreferrer" target="_blank">uploading to production App Engine</a>, you won't get required indexes and you'll experience a runtime error. You only need to include indexes that are new since the last successful upload. Omitted indexes are not automatically removed.</p><p id="-75ibra_130">For complete information about indexes, see <a href="https://web.archive.org/web/20160424225648/https://cloud.google.com/appengine/docs/java/datastore/indexes" id="-75ibra_143" data-external="true" rel="noopener noreferrer" target="_blank">Datastore Indexes</a>.</p><p id="-75ibra_132">We now have a working guest book application that authenticates users using Google accounts, lets them submit messages, and displays messages other users have left.</p><p id="-75ibra_133">The only thing left to do is upload our application...</p><p id="-75ibra_134"><a href="https://web.archive.org/web/20160424225648/https://cloud.google.com/appengine/docs/java/gettingstarted/uploading" id="-75ibra_144" data-external="true" rel="noopener noreferrer" target="_blank">Uploading Your Application &gt;&gt;</a></p></section><div class="last-modified">10 April 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="adding-application-code-and-ui.html" class="navigation-links__prev">Adding Application Code and UI</a><a href="uploading-your-application.html" class="navigation-links__next">Uploading Your Application</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>