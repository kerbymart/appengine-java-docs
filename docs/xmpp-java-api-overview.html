<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-13T01:56:44.862137818"><title>XMPP Java API Overview | Google App Engine Java Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"sending-chat-messages","level":0,"title":"Sending chat messages","anchor":"#sending-chat-messages"},{"id":"handling-incoming-calls","level":0,"title":"Handling incoming calls","anchor":"#handling-incoming-calls"},{"id":"xmpp-addresses","level":0,"title":"XMPP addresses","anchor":"#xmpp-addresses"},{"id":"jids-and-resources","level":0,"title":"JIDs and resources","anchor":"#jids-and-resources"},{"id":"sending-invitations","level":0,"title":"Sending invitations","anchor":"#sending-invitations"},{"id":"sending-the-application-s-chat-status","level":0,"title":"Sending the application\u0027s chat status","anchor":"#sending-the-application-s-chat-status"},{"id":"quotas-and-limits","level":0,"title":"Quotas and limits","anchor":"#quotas-and-limits"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="XMPP Java API Overview | Google App Engine Java Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Google App Engine Java Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/xmpp-java-api-overview.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="XMPP Java API Overview | Google App Engine Java Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/xmpp-java-api-overview.html#webpage",
    "url": "writerside-documentation/xmpp-java-api-overview.html",
    "name": "XMPP Java API Overview | Google App Engine Java Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Google App Engine Java Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="XMPP-Java-API-Overview" data-main-title="XMPP Java API Overview" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Guides.md|Guides///Sending-and-Receiving-Chat-and-SMS-Messages.md|Sending and Receiving Chat and SMS Messages"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Google App Engine Java Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="XMPP-Java-API-Overview" id="XMPP-Java-API-Overview.md">XMPP Java API Overview</h1><p id="-ujpbv6_3"><a href="https://web.archive.org/web/20160424225731/https://cloud.google.com/appengine/docs/python/xmpp/" id="-ujpbv6_19" data-tooltip="View this page in the Python runtime" data-external="true" rel="noopener noreferrer" target="_blank">Python</a> |Java |PHP |<a href="https://web.archive.org/web/20160424225731/https://cloud.google.com/appengine/docs/go/xmpp/" id="-ujpbv6_20" data-tooltip="View this page in the Go runtime" data-external="true" rel="noopener noreferrer" target="_blank">Go</a></p><p id="-ujpbv6_4"><a href="https://web.archive.org/web/20160424225731/http://stackoverflow.com/questions/tagged/google-app-engine+xmpp" id="-ujpbv6_21" data-external="true" rel="noopener noreferrer" target="_blank"><figure id="-ujpbv6_22"><img alt="Stack overflow questions" src="https://web.archive.org/web/20160424225731im_/https://cloud.google.com/cloud/images/stack_overflow_questions.png" title="Stack Overflow Questions" width="240" height="53"></figure></a></p><p id="-ujpbv6_5"><a href="https://web.archive.org/web/20160424225731/http://stackoverflow.com/feeds/tag?sort=votes&amp;tagnames=google-app-engine%2Bxmpp" id="-ujpbv6_23" data-external="true" rel="noopener noreferrer" target="_blank">https://web.archive.org/web/20160424225731/http://stackoverflow.com/feeds/tag?sort=votes&amp;tagnames=google-app-engine%2Bxmpp</a></p><p id="-ujpbv6_6"></p><p id="-ujpbv6_7"><a href="https://web.archive.org/web/20160424225731/http://stackoverflow.com/questions/tagged/google-app-engine+xmpp?sort=votes" id="-ujpbv6_24" data-external="true" rel="noopener noreferrer" target="_blank">See more...</a></p><p id="-ujpbv6_8">An App Engine application can send and receive chat messages to and from any XMPP-compatible chat messaging service. An app can send and receive chat messages, send chat invites, request a user's chat presence and status, and provide a chat status. Incoming XMPP messages are handled by request handlers, similar to web requests.</p><p id="-ujpbv6_9">Some possible uses of chat messages include automated chat participants (&quot;chat bots&quot;), chat notifications, and chat interfaces to services. A rich client with a connection to an XMPP server can use XMPP to interact with an App Engine application in real time, including receiving messages initiated by the app.</p><p id="-ujpbv6_10">Currently, an app cannot participate in group chats. An app can only receive messages of types &quot;chat&quot; and &quot;normal&quot;. An app can send messages of any type defined in <a href="https://web.archive.org/web/20160424225731/http://www.ietf.org/rfc/rfc3921.txt" id="-ujpbv6_25" data-external="true" rel="noopener noreferrer" target="_blank">RFC 3921</a>.</p><ol class="list _decimal" id="-ujpbv6_11" type="1"><li class="list__item" id="-ujpbv6_26"><p id="-ujpbv6_33"><span id="-ujpbv6_34">Sending chat messages</span></p></li><li class="list__item" id="-ujpbv6_27"><p id="-ujpbv6_35"><span id="-ujpbv6_36">Handling incoming calls</span></p></li><li class="list__item" id="-ujpbv6_28"><p id="-ujpbv6_37"><span id="-ujpbv6_38">XMPP addresses</span></p></li><li class="list__item" id="-ujpbv6_29"><p id="-ujpbv6_39"><span id="-ujpbv6_40">JIDs and resources</span></p></li><li class="list__item" id="-ujpbv6_30"><p id="-ujpbv6_41"><span id="-ujpbv6_42">Sending invitations</span></p></li><li class="list__item" id="-ujpbv6_31"><p id="-ujpbv6_43"><span id="-ujpbv6_44">Sending the application's chat status</span></p></li><li class="list__item" id="-ujpbv6_32"><p id="-ujpbv6_45"><span id="-ujpbv6_46">Quotas and limits</span></p></li></ol><section class="chapter"><h2 id="sending-chat-messages" data-toc="sending-chat-messages">Sending chat messages</h2><p id="-ujpbv6_47">An app can send chat messages to any XMPP address by calling the XMPP service API. A chat message can be of any of the five types defined in <a href="https://web.archive.org/web/20160424225731/http://www.ietf.org/rfc/rfc3921.txt" id="-ujpbv6_53" data-external="true" rel="noopener noreferrer" target="_blank">RFC 3921</a>. Note that an app can only receive two types of messages:</p><ol class="list _decimal" id="-ujpbv6_48" type="1"><li class="list__item" id="-ujpbv6_54"><p id="-ujpbv6_56">chat messages via <code class="code" id="-ujpbv6_57">/_ah/xmpp/message/chat/</code></p></li><li class="list__item" id="-ujpbv6_55"><p id="-ujpbv6_58">normal messages via <code class="code" id="-ujpbv6_59">/_ah/xmpp/message/chat/</code></p></li></ol><p id="-ujpbv6_49">For the body of the message, an app can provide plain text that is displayed to the user, or it can provide an XML stanza that is included in the XMPP XML data. You can use XML message data to communicate structured data to a custom client.</p><p id="-ujpbv6_50">The following example tests for a user's availability, then sends a chat message.</p><div class="code-block" data-lang="none">
import com.google.appengine.api.xmpp.JID;
import com.google.appengine.api.xmpp.Message;
import com.google.appengine.api.xmpp.MessageBuilder;
import com.google.appengine.api.xmpp.SendResponse;
import com.google.appengine.api.xmpp.XMPPService;
import com.google.appengine.api.xmpp.XMPPServiceFactory;

// ...
        JID jid = new JID(&quot;example@gmail.com&quot;);
        String msgBody = &quot;Someone has sent you a gift on Example.com. To view: http://example.com/gifts/&quot;;
        Message msg = new MessageBuilder()
            .withRecipientJids(jid)
            .withBody(msgBody)
            .build();

        boolean messageSent = false;
        XMPPService xmpp = XMPPServiceFactory.getXMPPService();
        SendResponse status = xmpp.sendMessage(msg);
        messageSent = (status.getStatusMap().get(jid) == SendResponse.Status.SUCCESS);

        if (!messageSent) {
            // Send an email message instead...
        }
</div><p id="-ujpbv6_52">When an app running in the development server sends an XMPP message, the fields of the message are printed to the console, and no message is sent. The development server cannot send XMPP messages on behalf of the app.</p></section><section class="chapter"><h2 id="handling-incoming-calls" data-toc="handling-incoming-calls">Handling incoming calls</h2><p id="-ujpbv6_60">App Engine provides three inbound services to manage messages, subscriptions, and presence:</p><ul class="list _bullet" id="-ujpbv6_61"><li class="list__item" id="-ujpbv6_70"><p id="-ujpbv6_74"><code class="code" id="-ujpbv6_75">xmpp_message</code> allows your application to receive chat messages from XMPP-compliant chat services.</p></li><li class="list__item" id="-ujpbv6_71"><p id="-ujpbv6_76"><code class="code" id="-ujpbv6_77">xmpp_subscribe</code> allows subscriptions between users and your application for the purpose of exchanging data, such as chat messages, presence information, and status messages.</p></li><li class="list__item" id="-ujpbv6_72"><p id="-ujpbv6_78"><code class="code" id="-ujpbv6_79">xmpp_presence</code> allows your application to determine a user's chat presence (available or unavailable).</p></li><li class="list__item" id="-ujpbv6_73"><p id="-ujpbv6_80"><code class="code" id="-ujpbv6_81">xmpp_error</code> allows your application to receive error stanzas.</p></li></ul><p id="-ujpbv6_62">You can <a href="https://web.archive.org/web/20160424225731/https://cloud.google.com/appengine/docs/java/config/appconfig#Java_appengine_web_xml_Inbound_services" id="-ujpbv6_82" data-external="true" rel="noopener noreferrer" target="_blank">enable these inbound services</a> in <code class="code" id="-ujpbv6_83">appengine-web.xml</code>:</p><div class="code-block" data-lang="none">
&lt;inbound-services&gt;
  &lt;service&gt;xmpp_message&lt;/service&gt;
  &lt;service&gt;xmpp_presence&lt;/service&gt;
  &lt;service&gt;xmpp_subscribe&lt;/service&gt;
  &lt;service&gt;xmpp_error&lt;/service&gt;
&lt;/inbound-services&gt;
</div><p id="-ujpbv6_64">The following sections show you how to handle these inbound services in your application:</p><ul class="list _bullet" id="-ujpbv6_65"><li class="list__item" id="-ujpbv6_84"><p id="-ujpbv6_88"><span id="-ujpbv6_89">Chat messages</span></p></li><li class="list__item" id="-ujpbv6_85"><p id="-ujpbv6_90"><span id="-ujpbv6_91">User subscriptions</span></p></li><li class="list__item" id="-ujpbv6_86"><p id="-ujpbv6_92"><span id="-ujpbv6_93">User presence</span></p></li><li class="list__item" id="-ujpbv6_87"><p id="-ujpbv6_94"><span id="-ujpbv6_95">XMPP errors</span></p></li></ul><section class="chapter"><h3 id="receiving-chat-messages" data-toc="receiving-chat-messages">Receiving chat messages</h3><p id="-ujpbv6_96">Users of XMPP-compliant chat services can send chat messages to App Engine applications. For an app to receive chat messages, the XMPP message service must be enabled in the app's configuration.</p><p id="-ujpbv6_97">To enable the XMPP service for a Java app, edit the <code class="code" id="-ujpbv6_110">appengine-web.xml</code> file and include the following lines:</p><div class="code-block" data-lang="none">
&lt;inbound-services&gt;
  &lt;service&gt;xmpp_message&lt;/service&gt;
&lt;/inbound-services&gt;
</div><p id="-ujpbv6_99">With the XMPP service enabled, App Engine makes an HTTP POST request to the following URL path when your app receives a chat message:</p><p id="-ujpbv6_100"><code class="code" id="-ujpbv6_111">/_ah/xmpp/message/chat/</code></p><p id="-ujpbv6_101">To handle incoming messages, you simply create a request handler that accepts POST requests at this URL path.</p><p id="-ujpbv6_102">This URL path is restricted to app administrators automatically. The XMPP service connects to the app with &quot;administrator&quot; status for the purposes of accessing this URL path. You can configure the path to have this restriction explicitly if you like, but this is not necessary. Only the XMPP service and clients authenticated as administrators using Google Accounts can access this URL path.</p><p id="-ujpbv6_103">The POST request data represents the message as a MIME multipart message (<a href="https://web.archive.org/web/20160424225731/http://www.ietf.org/rfc/rfc2388.txt" id="-ujpbv6_112" data-external="true" rel="noopener noreferrer" target="_blank">RFC 2388</a>). Each part is a named POST parameter:</p><ul class="list _bullet" id="-ujpbv6_104"><li class="list__item" id="-ujpbv6_113"><p id="-ujpbv6_117"><code class="code" id="-ujpbv6_118">from</code>, the address of the sender of the message</p></li><li class="list__item" id="-ujpbv6_114"><p id="-ujpbv6_119"><code class="code" id="-ujpbv6_120">to</code>, the address of the recipient as described by the sender (see below)</p></li><li class="list__item" id="-ujpbv6_115"><p id="-ujpbv6_121"><code class="code" id="-ujpbv6_122">body</code>, the body of the message</p></li><li class="list__item" id="-ujpbv6_116"><p id="-ujpbv6_123"><code class="code" id="-ujpbv6_124">stanza</code>, the full XMPP message in its original XML form</p></li></ul><p id="-ujpbv6_105">An app can receive messages of two XMPP types: &quot;chat&quot; and &quot;normal.&quot; If App Engine receives an XMPP message of an unsupported type, the message is ignored and the request handler is not called.</p><p id="-ujpbv6_106">The Java Servlet API does not provide a way to parse MIME multipart POST data directly. The XMPP API includes a helper method for parsing this data from the HttpServletRequest object. The following example illustrates how to use this helper class to parse incoming XMPP messages.</p><div class="code-block" data-lang="none">
import java.io.IOException;
import javax.servlet.http.*;
import com.google.appengine.api.xmpp.JID;
import com.google.appengine.api.xmpp.Message;
import com.google.appengine.api.xmpp.XMPPService;
import com.google.appengine.api.xmpp.XMPPServiceFactory;

@SuppressWarnings(&quot;serial&quot;)
public class XMPPReceiverServlet extends HttpServlet {
    @Override
    public void doPost(HttpServletRequest req, HttpServletResponse res)
          throws IOException {
        XMPPService xmpp = XMPPServiceFactory.getXMPPService();
        Message message = xmpp.parseMessage(req);

        JID fromJid = message.getFromJid();
        String body = message.getBody();
        // ...
    }
}
</div><p id="-ujpbv6_108">To map this servlet to the XMPP URL path, put the following section in your <code class="code" id="-ujpbv6_125">web.xml</code> file, inside the <code class="code" id="-ujpbv6_126">&lt;web-app&gt;</code> element:</p><div class="code-block" data-lang="none">
&lt;servlet&gt;
  &lt;servlet-name&gt;xmppreceiver&lt;/servlet-name&gt;
  &lt;servlet-class&gt;XMPPReceiverServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
  &lt;servlet-name&gt;xmppreceiver&lt;/servlet-name&gt;
  &lt;url-pattern&gt;/_ah/xmpp/message/chat/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</div></section><section class="chapter"><h3 id="handling-subscriptions" data-toc="handling-subscriptions">Handling subscriptions</h3><p id="-ujpbv6_127">Enabling the <code class="code" id="-ujpbv6_132">xmpp_subscribe</code> inbound service allows your application to receive updates to a user's subscription information via POSTs to the following URL paths:</p><ul class="list _bullet" id="-ujpbv6_128"><li class="list__item" id="-ujpbv6_133"><p id="-ujpbv6_137">POSTs to <code class="code" id="-ujpbv6_138">/_ah/xmpp/subscription/subscribe/</code> signal that the user wishes to subscribe to the application's presence.</p></li><li class="list__item" id="-ujpbv6_134"><p id="-ujpbv6_139">POSTs to <code class="code" id="-ujpbv6_140">/_ah/xmpp/subscription/subscribed/</code> signal that the user has allowed the application to receive its presence.</p></li><li class="list__item" id="-ujpbv6_135"><p id="-ujpbv6_141">POSTs to <code class="code" id="-ujpbv6_142">/_ah/xmpp/subscription/unsubscribe/</code> signal that the user is unsubscribing from the application's presence.</p></li><li class="list__item" id="-ujpbv6_136"><p id="-ujpbv6_143">POSTs to <code class="code" id="-ujpbv6_144">/_ah/xmpp/subscription/unsubscribed/</code> signal that the user has denied the application's subscription request, or cancelled a previously granted subscription.</p></li></ul><p id="-ujpbv6_129">These URLs correspond to the stanzas used for managing subscriptions described in the <a href="https://web.archive.org/web/20160424225731/http://xmpp.org/rfcs/rfc3921.html#sub" id="-ujpbv6_145" data-external="true" rel="noopener noreferrer" target="_blank">XMPP Instant Messages and Presence Protocol</a>.</p><p id="-ujpbv6_130">The following code sample demonstrates how to track subscriptions using webhooks to the above handlers. The following code sample uses POSTs to the above handlers to maintain a roster of subscribed users in the datastore:</p><div class="code-block" data-lang="none">
// In the handler for _ah/xmpp/presence/subscribe
XMPPService xmppService = XMPPServiceFactory.getXMPPService();
Subscription sub = xmppService.parseSubscription(req);

// Split the bare XMPP address (e.g., user@gmail.com)
// from the resource (e.g., gmail.CD6EBC4A)
String from = sub.getFromJid().getId().split(&quot;/&quot;)[0];

// Add an object tracking the roster to the contact

this.roster.addContact(sub.getFromJid());
</div></section><section class="chapter"><h3 id="handling-user-presence" data-toc="handling-user-presence">Handling user presence</h3><p id="-ujpbv6_146">Enabling the <code class="code" id="-ujpbv6_151">xmpp_presence</code> inbound service allows your application to detect changes to a user's chat presence. When you enable <code class="code" id="-ujpbv6_152">xmpp_presence</code>, your application receives POSTs to the following URL paths:</p><ul class="list _bullet" id="-ujpbv6_147"><li class="list__item" id="-ujpbv6_153"><p id="-ujpbv6_156">POSTs to <code class="code" id="-ujpbv6_157">/_ah/xmpp/presence/available/</code> signal that the user is available and provide the user's chat status.</p></li><li class="list__item" id="-ujpbv6_154"><p id="-ujpbv6_158">POSTs to <code class="code" id="-ujpbv6_159">/_ah/xmpp/presence/unavailable/</code> signal that the user is unavailable.</p></li><li class="list__item" id="-ujpbv6_155"><p id="-ujpbv6_160">POSTs to <code class="code" id="-ujpbv6_161">/_ah/xmpp/presence/probe/</code> request a user's current presence.</p></li></ul><p id="-ujpbv6_148">Your application can register handlers to these paths in order to receive notifications. You can use these notifications to track which users are currently online. If you wish to check the most current status, you can use the <a href="https://web.archive.org/web/20160424225731/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/xmpp/XMPPService#sendPresence" id="-ujpbv6_162" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-ujpbv6_165">sendPresence</code></a> method with the <code class="code" id="-ujpbv6_163">type</code> parameter set to <code class="code" id="-ujpbv6_164">PresenceType.PROBE</code>. This will result in POSTs to the above paths reflecting the user's current status.</p><p id="-ujpbv6_149">If a Google talk user has subscribed to an app (has accepted an invitation or has invited the app to chat), the app can discover the user's availability by looking for a POST to <code class="code" id="-ujpbv6_166">/_ah/xmpp/presence/available</code>. If the user is subscribed and available, you can send them your application's presence and status:</p><div class="code-block" data-lang="none">
// In the handler for _ah/xmpp/presence/available
XMPPService xmppService = XMPPServiceFactory.getXMPPService();
Presence presence = xmppService.parsePresence(req);

// Split the XMPP address (e.g., user@gmail.com)
// from the resource (e.g., gmail.CD6EBC4A)
String from = presence.getFromJid().getId().split(&quot;/&quot;)[0];

// Mirror the contact's presence back to them
xmppService.sendPresence(from, PresenceType.AVAILABLE, presence.getPresenceShow(), presence.getStatus());
</div></section><section class="chapter"><h3 id="handling-error-stanzas" data-toc="handling-error-stanzas">Handling error stanzas</h3><p id="-ujpbv6_167">Enabling the <code class="code" id="-ujpbv6_172">xmpp_error</code> inbound service allows your application to receive XMPP error stanzas. Error stanzas are most commonly sent as a result of sending a message to a user who's offline.</p><p id="-ujpbv6_168">With the error service enabled, App Engine makes an HTTP POST request to the following path when your app receives an error stanza:</p><p id="-ujpbv6_169"><code class="code" id="-ujpbv6_173">/_ah/xmpp/error/</code></p><p id="-ujpbv6_170">You can register a handler at this address to be notified of XMPP errors. This handler may be responsible for eg. diagnostics or logging.</p><div class="code-block" data-lang="none">
// In the handler for _ah/xmpp/error

// Parse the POST data, which is sent as a MIME stream containing the stanza.
ByteArrayOutputStream baos = new ByteArrayOutputStream();
ServletInputStream inputStream = req.getInputStream();
ByteStreams.copy(inputStream, baos);

// Log the error
log.warning(&quot;Error stanza received: &quot; + baos.toString());
</div></section></section><section class="chapter"><h2 id="xmpp-addresses" data-toc="xmpp-addresses">XMPP addresses</h2><p id="-ujpbv6_174">An application can send and receive messages using several kinds of addresses, or &quot;JIDs.&quot; One kind of address uses the application ID and the <code class="code" id="-ujpbv6_183">appspot.com</code> domain, as follows:</p><p id="-ujpbv6_175"><code class="code" id="-ujpbv6_184">your_app_id@appspot.com</code></p><p id="-ujpbv6_176">An app can also use a custom address in the following format, where <code class="code" id="-ujpbv6_185">anything</code> is any string containing letters, numbers and hyphens:</p><p id="-ujpbv6_177"><code class="code" id="-ujpbv6_186">anything@your_app_id.appspotchat.com</code></p><p id="-ujpbv6_178"><span class="control" id="-ujpbv6_187">Note:</span> <code class="code" id="-ujpbv6_188">anything</code> must not include certain characters that would otherwise be allowed by the XMPP standard (even if they're escaped), such as: <code class="code" id="-ujpbv6_189">, ; @ ( ) [ ]</code>.</p><p id="-ujpbv6_179"><span class="control" id="-ujpbv6_190">Note:</span> Also note the different domain name for custom addresses: <code class="code" id="-ujpbv6_191">appspotchat.com</code></p><p id="-ujpbv6_180">The use of Google Apps domains in XMPP addresses is not yet supported for apps.</p><p id="-ujpbv6_181">The app can choose which address is used as the sender address when sending a message. All messages sent to any address in the supported formats are routed to the application.</p><section class="chapter"><h3 id="addresses-and-app-versions" data-toc="addresses-and-app-versions">Addresses and app versions</h3><p id="-ujpbv6_192"><span class="control" id="-ujpbv6_198">Note:</span> XMPP is not supported in non-default modules.</p><p id="-ujpbv6_193">The <code class="code" id="-ujpbv6_199">@appspot.com</code> address and the <code class="code" id="-ujpbv6_200">@your_app_id.appspotchat.com</code> addresses all refer to the default version of the app. Messages sent to these addresses are routed to the default version. When the default version of an app sends a message, the requested address is used as the sender of the message. Replies to the app's messages are routed to the default version, even if the default version has changed since the original message was sent.</p><p id="-ujpbv6_194">Each version of an app has its own set of XMPP addresses in the following format:</p><p id="-ujpbv6_195"><code class="code" id="-ujpbv6_201">anything@version.latest.your_app_id.appspotchat.com</code></p><p id="-ujpbv6_196">If App Engine receives a message for an address in this format, it is routed to the corresponding version of the app (if that version still exists).</p><p id="-ujpbv6_197">If a version of an app sends a message and that version is not the default, the sender address of the message is changed to an address in this format. If the sender is <code class="code" id="-ujpbv6_202">your_app_id@appspot.com</code>, the sender address becomes <code class="code" id="-ujpbv6_203">your_app_id@version.latest.your_app_id.appspotchat.com</code>. This ensures that replies to a message sent by a specific non-default version of the app are routed back to that version.</p></section></section><section class="chapter"><h2 id="jids-and-resources" data-toc="jids-and-resources">JIDs and resources</h2><p id="-ujpbv6_204">An XMPP address, also known as a &quot;JID,&quot; has several components: a node (such as the name of a user of a chat service), a domain (the domain name of the service), and an optional resource. These components are separated by punctuation: <code class="code" id="-ujpbv6_208">node@domain/resource</code>.</p><p id="-ujpbv6_205">When establishing a chat conversation with a human user of a chat service, you typically use just the node and domain parts of the JID. Each chat client the user has connected to the service may have its own resource, and sending a message to the JID without the resource sends it to all of the user's clients.</p><p id="-ujpbv6_206">A JID without a resource is known as a &quot;bare JID&quot;. A JID with a resource is a &quot;full JID&quot;. App Engine's XMPP service supports both bare and full JIDs for recipient and sender addresses of messages.</p><p id="-ujpbv6_207">When sending a message, if you use a bare JID as the sender address, the XMPP service automatically uses the resource <code class="code" id="-ujpbv6_209">/bot</code>. If another XMPP user sends a message to the app using a full JID with a custom resource, the app can see which resource was used by inspecting the <code class="code" id="-ujpbv6_210">to</code> field of the incoming message.</p></section><section class="chapter"><h2 id="sending-invitations" data-toc="sending-invitations">Sending invitations</h2><p id="-ujpbv6_211">Chat servers only accept messages for users that are &quot;subscribed&quot; to the sender, either because the user invited the sender to chat or because the user accepted an invitation to chat sent by the sender. An App Engine app can send chat invitations using <a href="https://web.archive.org/web/20160424225731/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/xmpp/XMPPService#sendInvitation(com.google.appengine.api.xmpp.JID)" id="-ujpbv6_214" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-ujpbv6_215">sendInvitation()</code></a>.</p><p id="-ujpbv6_212">As with sending email, a best practice is to send a chat invitation only when the user asks, such as by clicking a button on a web page. Alternatively, the app can ask the user to send an invitation to the app's XMPP address to enable receiving of messages.</p><p id="-ujpbv6_213">App Engine accepts all chat invitations and automatically registers subscriptions as described in the <span id="-ujpbv6_216">Handling Subscriptions</span> section. App Engine routes all chat messages to the application, regardless of whether the sender previously sent an invitation to the app.</p></section><section class="chapter"><h2 id="sending-the-application-s-chat-status" data-toc="sending-the-application-s-chat-status">Sending the application's chat status</h2><p id="-ujpbv6_217">The <a href="https://web.archive.org/web/20160424225731/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/xmpp/XMPPService#sendPresence(com.google.appengine.api.xmpp.JID,%20com.google.appengine.api.xmpp.PresenceType,%20com.google.appengine.api.xmpp.PresenceShow,%20java.lang.String)" id="-ujpbv6_219" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-ujpbv6_220">sendPresence()</code></a> API allows the application to send the application's presence, along with an optional status message, to a given JID. By default, the application appears available with no status message. You can set the status message as follows:</p><div class="code-block" data-lang="none">
xmppService.sendPresence(toJid, PresenceType.AVAILABLE, PresenceShow.NONE, &quot;My app's status&quot;)
</div></section><section class="chapter"><h2 id="quotas-and-limits" data-toc="quotas-and-limits">Quotas and limits</h2><p id="-ujpbv6_221">Each XMPP service request counts toward the <span class="control" id="-ujpbv6_234">XMPP API Calls</span> quota.</p><p id="-ujpbv6_222">Each outgoing XMPP chat message counts toward the following quotas:</p><ul class="list _bullet" id="-ujpbv6_223"><li class="list__item" id="-ujpbv6_235"><p id="-ujpbv6_238"><span class="control" id="-ujpbv6_239">XMPP Data Sent</span></p></li><li class="list__item" id="-ujpbv6_236"><p id="-ujpbv6_240"><span class="control" id="-ujpbv6_241">XMPP Recipients Messaged</span></p></li><li class="list__item" id="-ujpbv6_237"><p id="-ujpbv6_242"><span class="control" id="-ujpbv6_243">Outgoing Bandwidth (billable)</span></p></li></ul><p id="-ujpbv6_224">Each outgoing XMPP chat invitation counts toward the following quotas:</p><ul class="list _bullet" id="-ujpbv6_225"><li class="list__item" id="-ujpbv6_244"><p id="-ujpbv6_247"><span class="control" id="-ujpbv6_248">XMPP Data Sent</span></p></li><li class="list__item" id="-ujpbv6_245"><p id="-ujpbv6_249"><span class="control" id="-ujpbv6_250">XMPP Invitations Sent</span></p></li><li class="list__item" id="-ujpbv6_246"><p id="-ujpbv6_251"><span class="control" id="-ujpbv6_252">Outgoing Bandwidth (billable)</span></p></li></ul><p id="-ujpbv6_226">Each incoming XMPP message counts toward the following quotas:</p><ul class="list _bullet" id="-ujpbv6_227"><li class="list__item" id="-ujpbv6_253"><p id="-ujpbv6_255"><span class="control" id="-ujpbv6_256">Requests</span></p></li><li class="list__item" id="-ujpbv6_254"><p id="-ujpbv6_257"><span class="control" id="-ujpbv6_258">Incoming Bandwidth (billable)</span></p></li></ul><p id="-ujpbv6_228">Each incoming presence and subscription message counts as a normal HTTP request.</p><p id="-ujpbv6_229">Computation performed in a request handler for incoming XMPP messages applies toward the same quotas as with web requests and tasks.</p><p id="-ujpbv6_230">For more information, see <a href="https://web.archive.org/web/20160424225731/https://cloud.google.com/appengine/docs/quotas" id="-ujpbv6_259" data-external="true" rel="noopener noreferrer" target="_blank">Quotas</a> and <a href="https://web.archive.org/web/20160424225731/https://cloud.google.com/appengine/docs/developers-console/#quotas" id="-ujpbv6_260" data-external="true" rel="noopener noreferrer" target="_blank">Quota details</a>. You can see the current quota usage of your app by visiting the Google Cloud Platform Console <a href="https://web.archive.org/web/20160424225731/https://console.cloud.google.com//project/_/appengine/quotadetails" id="-ujpbv6_261" data-external="true" rel="noopener noreferrer" target="_blank">quota details</a> page for your project.</p><p id="-ujpbv6_231">In addition to quotas, the following limits apply to the use of the XMPP service:</p><div class="table-wrapper"><table class="wide" id="-ujpbv6_232"><thead><tr class="ijRowHead" id="-ujpbv6_262"><th id="-ujpbv6_266"><p>Limit</p></th><th id="-ujpbv6_267"><p>Amount</p></th></tr></thead><tbody><tr id="-ujpbv6_263"><td id="-ujpbv6_268"><p>incoming message size</p></td><td id="-ujpbv6_269"><p>100 kilobytes</p></td></tr><tr id="-ujpbv6_264"><td id="-ujpbv6_270"><p>outgoing message size</p></td><td id="-ujpbv6_271"><p>100 kilobytes</p></td></tr><tr id="-ujpbv6_265"><td id="-ujpbv6_272"><p>invitations sent</p></td><td id="-ujpbv6_273"><p>100,000/day</p></td></tr></tbody></table></div><p id="-ujpbv6_233">There is no explicit limit to the number of recipients for a message. However, each message is sent and metered separately for each recipient. A message with 30 recipients consumes 30 times as much of the affected quotas as a message with 1 recipient. Also, the total size of the API call is limited to 1 megabyte, including the total size of the recipient list and the message body.</p></section><div class="last-modified">10 April 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="sending-and-receiving-chat-and-sms-messages.html" class="navigation-links__prev">Sending and Receiving Chat and SMS Messages</a><a href="sms-and-voice-services-via-twilio.html" class="navigation-links__next">SMS and Voice Services via Twilio</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>