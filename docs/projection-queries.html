<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-13T01:56:46.256273004"><title>Projection Queries | Google App Engine Java Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"contents","level":0,"title":"Contents","anchor":"#contents"},{"id":"using-projection-queries-in-java","level":0,"title":"Using projection queries in Java","anchor":"#using-projection-queries-in-java"},{"id":"grouping-experimental","level":0,"title":"Grouping (experimental)","anchor":"#grouping-experimental"},{"id":"limitations-on-projections","level":0,"title":"Limitations on projections","anchor":"#limitations-on-projections"},{"id":"projections-and-multiple-valued-properties","level":0,"title":"Projections and multiple-valued properties","anchor":"#projections-and-multiple-valued-properties"},{"id":"indexes-for-projections","level":0,"title":"Indexes for projections","anchor":"#indexes-for-projections"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Projection Queries | Google App Engine Java Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Google App Engine Java Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/projection-queries.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Projection Queries | Google App Engine Java Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/projection-queries.html#webpage",
    "url": "writerside-documentation/projection-queries.html",
    "name": "Projection Queries | Google App Engine Java Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Google App Engine Java Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="Projection-Queries" data-main-title="Projection Queries" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Guides.md|Guides///Storing-Data.md|Storing Data///Google-Cloud-Datastore.md|Google Cloud Datastore"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Google App Engine Java Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Projection-Queries" id="Projection-Queries.md">Projection Queries</h1><p id="-gun9yz_3">Most Datastore <a href="https://web.archive.org/web/20160424225927/https://cloud.google.com/appengine/docs/java/datastore/queries" id="-gun9yz_13" data-external="true" rel="noopener noreferrer" target="_blank">queries</a> return whole <a href="https://web.archive.org/web/20160424225927/https://cloud.google.com/appengine/docs/java/datastore/entities" id="-gun9yz_14" data-external="true" rel="noopener noreferrer" target="_blank">entities</a> as their results, but often an application is actually interested in only a few of the entity's properties. <span class="emphasis" id="-gun9yz_15">Projection queries</span> allow you to query the Datastore for just those specific properties of an entity that you actually need, at lower latency and cost than retrieving the entire entity.</p><p id="-gun9yz_4">Projection queries are similar to SQL queries of the form</p><div class="code-block" data-lang="none">
SELECT name, email, phone FROM CUSTOMER
</div><p id="-gun9yz_6">You can use all of the filtering and sorting features available for standard entity queries, subject to the <span id="-gun9yz_16">limitations</span> described below. The query returns abridged results with only the specified properties (<code class="code" id="-gun9yz_17">name</code>, <code class="code" id="-gun9yz_18">email</code>, and <code class="code" id="-gun9yz_19">phone</code> in the example) populated with values; all other properties have no data.</p><section class="chapter"><h2 id="contents" data-toc="contents">Contents</h2><ol class="list _decimal" id="-gun9yz_20" type="1"><li class="list__item" id="-gun9yz_21"><p id="-gun9yz_26"><span id="-gun9yz_27">Using projection queries in Java</span></p></li><li class="list__item" id="-gun9yz_22"><p id="-gun9yz_28"><span id="-gun9yz_29">Grouping</span></p></li><li class="list__item" id="-gun9yz_23"><p id="-gun9yz_30"><span id="-gun9yz_31">Limitations on projections</span></p></li><li class="list__item" id="-gun9yz_24"><p id="-gun9yz_32"><span id="-gun9yz_33">Projections and multiple-valued properties</span></p></li><li class="list__item" id="-gun9yz_25"><p id="-gun9yz_34"><span id="-gun9yz_35">Indexes for projections</span></p></li></ol></section><section class="chapter"><h2 id="using-projection-queries-in-java" data-toc="using-projection-queries-in-java">Using projection queries in Java</h2><p id="-gun9yz_36">Projection queries require the following imports:</p><div class="code-block" data-lang="none">
import com.google.appengine.api.datastore.PropertyProjection;
import com.google.appengine.api.datastore.RawValue;
</div><p id="-gun9yz_38">To build a projection query, you create a <a href="https://web.archive.org/web/20160424225927/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/datastore/Query" id="-gun9yz_43" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-gun9yz_45">Query</code></a> object and add properties to it using the <a href="https://web.archive.org/web/20160424225927/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/datastore/Query#addProjection(com.google.appengine.api.datastore.Projection)" id="-gun9yz_44" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-gun9yz_46">addProjection()</code></a> method:</p><div class="code-block" data-lang="none">
Key guestbookKey = KeyFactory.createKey(&quot;Guestbook&quot;, guestbookName);

Query proj = new Query(&quot;Greeting&quot;, guestbookKey);
proj.addProjection(new PropertyProjection(&quot;user&quot;, User.class));
proj.addProjection(new PropertyProjection(&quot;date&quot;, Date.class));
</div><p id="-gun9yz_40">The type you specify for each property must match the type you used when you first defined the property with <a href="https://web.archive.org/web/20160424225927/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/datastore/Entity#setProperty(java.lang.String,%20java.lang.Object)" id="-gun9yz_47" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-gun9yz_48">Entity.setProperty()</code></a>. The following example shows how to process the query's results by iterating through the list of entities returned and casting each property value to the expected type:</p><div class="code-block" data-lang="none">
DatastoreService datastore = DatastoreServiceFactory.getDatastoreService();
List&lt;Entity&gt; projTests = datastore.prepare(proj)
                                  .asList(FetchOptions.Builder.withLimit(5));

for (Entity projtest : projTests) {
  User person = (User) projtest.getProperty(&quot;user&quot;);
  System.out.println(person.toString());

  Date stamp = (Date) projtest.getProperty(&quot;date&quot;);
  System.out.println(stamp.toString());
}
</div><p id="-gun9yz_42"><span class="control" id="-gun9yz_49">Note:</span> Instead of specifying a property's type explicitly to the <code class="code" id="-gun9yz_50">Query.addProjection()</code> method, you can simply pass <code class="code" id="-gun9yz_51">null</code> for the type. The property's value will then be returned as a <a href="https://web.archive.org/web/20160424225927/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/datastore/RawValue" id="-gun9yz_52" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-gun9yz_54">RawValue</code></a> object, which you can test to determine its type. (In the processing example above, you would cast the property to <code class="code" id="-gun9yz_53">RawValue</code> instead of a specific type.)</p></section><section class="chapter"><h2 id="grouping-experimental" data-toc="grouping-experimental">Grouping <sup class="superscript" id="-gun9yz_58">(experimental)</sup></h2><p id="-gun9yz_56">Projection queries can use the <code class="code" id="-gun9yz_59">setDistinct()</code> method to ensure that only completely unique results will be returned in a result set. This will only return the first result for entities which have the same values for the properties that are being projected.</p><div class="code-block" data-lang="none">
Query q = new Query();
q.addProjection(new PropertyProjection(&quot;A&quot;, String.class));
q.addProjection(new PropertyProjection(&quot;B&quot;, String.class));
q.setDistinct(true);
q.setFilter(Query.FilterOperator.LESS_THAN.of(&quot;B&quot;, 1));
q.addSort(&quot;B&quot;, Query.SortDirection.DESCENDING);
q.addSort(&quot;A&quot;);
</div></section><section class="chapter"><h2 id="limitations-on-projections" data-toc="limitations-on-projections">Limitations on projections</h2><p id="-gun9yz_60">Projection queries are subject to the following limitations:</p><ul class="list _bullet" id="-gun9yz_61"><li class="list__item" id="-gun9yz_62"><p id="-gun9yz_66"><span class="control" id="-gun9yz_68">Only indexed properties can be projected.</span></p><p id="-gun9yz_67">Projection is not supported for properties that are not indexed, whether explicitly or implicitly. (Long text strings (<a href="https://web.archive.org/web/20160424225927/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/datastore/Text" id="-gun9yz_69" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-gun9yz_71">Text</code></a>) and long byte strings (<a href="https://web.archive.org/web/20160424225927/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/datastore/Blob" id="-gun9yz_70" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-gun9yz_72">Blob</code></a>) are not indexed).</p></li><li class="list__item" id="-gun9yz_63"><p id="-gun9yz_73"><span class="control" id="-gun9yz_74">The same property cannot be projected more than once.</span></p></li><li class="list__item" id="-gun9yz_64"><p id="-gun9yz_75"><span class="control" id="-gun9yz_83">Properties referenced in an equality (<code class="code" id="-gun9yz_84">EQUAL</code>) or membership (<code class="code" id="-gun9yz_85">IN</code>) filter cannot be projected.</span></p><p id="-gun9yz_76">For example,</p><div class="code-block" data-lang="none">
SELECT A FROM kind WHERE B = 1
</div><p id="-gun9yz_78">is valid (projected property not used in the equality filter), as is</p><div class="code-block" data-lang="none">
SELECT A FROM kind WHERE A &gt; 1
</div><p id="-gun9yz_80">(not an equality filter), but</p><div class="code-block" data-lang="none">
SELECT A FROM kind WHERE A = 1
</div><p id="-gun9yz_82">(projected property used in equality filter) is not.</p></li><li class="list__item" id="-gun9yz_65"><p id="-gun9yz_86"><span class="control" id="-gun9yz_88">Results returned by a projection query should not be saved back to the Datastore.</span></p><p id="-gun9yz_87">Because the query returns results that are only partially populated, you should not write them back to the Datastore.</p></li></ul></section><section class="chapter"><h2 id="projections-and-multiple-valued-properties" data-toc="projections-and-multiple-valued-properties">Projections and multiple-valued properties</h2><p id="-gun9yz_89">Projecting a property with multiple values will not populate all values for that property. Instead, a separate entity will be returned for each unique combination of projected values matching the query. For example, suppose you have an entity of kind <code class="code" id="-gun9yz_96">Foo</code> with two multiple-valued properties, <code class="code" id="-gun9yz_97">A</code> and <code class="code" id="-gun9yz_98">B</code>:</p><div class="code-block" data-lang="none">
entity = Foo(A=[1, 1, 2, 3], B=['x', 'y', 'x'])
</div><p id="-gun9yz_91">Then the projection query</p><div class="code-block" data-lang="none">
SELECT A, B FROM Foo WHERE A &lt; 3
</div><p id="-gun9yz_93">will return four entities with the following combinations of values:</p><p id="-gun9yz_94"><code class="code" id="-gun9yz_99">A</code> = <code class="code" id="-gun9yz_100">1</code>, <code class="code" id="-gun9yz_101">B</code> = <code class="code" id="-gun9yz_102">'x'</code><br><code class="code" id="-gun9yz_104">A</code> = <code class="code" id="-gun9yz_105">1</code>, <code class="code" id="-gun9yz_106">B</code> = <code class="code" id="-gun9yz_107">'y'</code><br><code class="code" id="-gun9yz_109">A</code> = <code class="code" id="-gun9yz_110">2</code>, <code class="code" id="-gun9yz_111">B</code> = <code class="code" id="-gun9yz_112">'x'</code><br><code class="code" id="-gun9yz_114">A</code> = <code class="code" id="-gun9yz_115">2</code>, <code class="code" id="-gun9yz_116">B</code> = <code class="code" id="-gun9yz_117">'y'</code></p><p id="-gun9yz_95"><span class="control" id="-gun9yz_118">Warning:</span> Including more than one multiple-valued property in a projection will result in an <a href="https://web.archive.org/web/20160424225927/https://cloud.google.com/appengine/docs/java/datastore/indexes#Java_Index_limits" id="-gun9yz_119" data-external="true" rel="noopener noreferrer" target="_blank">exploding index</a>.</p></section><section class="chapter"><h2 id="indexes-for-projections" data-toc="indexes-for-projections">Indexes for projections</h2><p id="-gun9yz_120">Projection queries require all properties specified in the projection to be included in a Datastore <a href="https://web.archive.org/web/20160424225927/https://cloud.google.com/appengine/docs/java/datastore/indexes" id="-gun9yz_133" data-external="true" rel="noopener noreferrer" target="_blank">index</a>. The App Engine development server automatically generates the needed indexes for you in the index configuration file, <code class="code" id="-gun9yz_134">datastore-indexes-auto.xml</code>, which is uploaded with your application.</p><p id="-gun9yz_121">One way to minimize the number of indexes required is to project the same properties consistently, even when not all of them are always needed. For example, these queries require two separate indexes:</p><div class="code-block" data-lang="none">
SELECT A, B FROM Kind
SELECT A, B, C FROM Kind
</div><p id="-gun9yz_123">However, if you always project properties <code class="code" id="-gun9yz_135">A</code>, <code class="code" id="-gun9yz_136">B</code>, and <code class="code" id="-gun9yz_137">C</code>, even when <code class="code" id="-gun9yz_138">C</code> is not required, only one index will be needed.</p><p id="-gun9yz_124">Converting an existing query into a projection query may require building a new index if the properties in the projection are not already included in another part of the query. For example, suppose you had an existing query like</p><div class="code-block" data-lang="none">
SELECT * FROM Kind WHERE A &gt; 1 ORDER BY A, B
</div><p id="-gun9yz_126">which requires the index</p><div class="code-block" data-lang="none">
Index(Kind, A, B)
</div><p id="-gun9yz_128">Converting this to either of the projection queries</p><div class="code-block" data-lang="none">
SELECT C FROM Kind WHERE A &gt; 1 ORDER BY A, B
SELECT A, B, C FROM Kind WHERE A &gt; 1 ORDER BY A, B
</div><p id="-gun9yz_130">introduces a new property (<code class="code" id="-gun9yz_139">C</code>) and thus will require building a new index <code class="code" id="-gun9yz_140">Index(Kind,</code> <code class="code" id="-gun9yz_141">A,</code> <code class="code" id="-gun9yz_142">B,</code> <code class="code" id="-gun9yz_143">C)</code>. Note that the projection query</p><div class="code-block" data-lang="none">
SELECT A, B FROM Kind WHERE A &gt; 1 ORDER BY A, B
</div><p id="-gun9yz_132">would <span class="emphasis" id="-gun9yz_144">not</span> change the required index, since the projected properties <code class="code" id="-gun9yz_145">A</code> and <code class="code" id="-gun9yz_146">B</code> were already included in the existing query.</p></section><div class="last-modified">10 April 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="geospatial-queries.html" class="navigation-links__prev">Geospatial Queries</a><a href="datastore-indexes.html" class="navigation-links__next">Datastore Indexes</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>