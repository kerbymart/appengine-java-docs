<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-13T01:56:45.514666335"><title>Using Pull Queues in Java | Google App Engine Java Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"pull-queue-overview","level":0,"title":"Pull queue overview","anchor":"#pull-queue-overview"},{"id":"pulling-tasks-within-app-engine","level":0,"title":"Pulling tasks within App Engine","anchor":"#pulling-tasks-within-app-engine"},{"id":"pulling-tasks-to-a-module","level":0,"title":"Pulling tasks to a module","anchor":"#pulling-tasks-to-a-module"},{"id":"pulling-tasks-from-outside-app-engine","level":0,"title":"Pulling tasks from outside App Engine","anchor":"#pulling-tasks-from-outside-app-engine"},{"id":"quotas-and-limits-for-pull-queues","level":0,"title":"Quotas and limits for pull queues","anchor":"#quotas-and-limits-for-pull-queues"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Using Pull Queues in Java | Google App Engine Java Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Google App Engine Java Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/using-pull-queues-in-java.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Using Pull Queues in Java | Google App Engine Java Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/using-pull-queues-in-java.html#webpage",
    "url": "writerside-documentation/using-pull-queues-in-java.html",
    "name": "Using Pull Queues in Java | Google App Engine Java Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Google App Engine Java Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="Using-Pull-Queues-in-Java" data-main-title="Using Pull Queues in Java" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Guides.md|Guides///Scheduling-Work-Outside-of-User-Requests.md|Scheduling Work Outside of User Requests///Task-Queue-API.md|Task Queue API"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Google App Engine Java Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Using-Pull-Queues-in-Java" id="Using-Pull-Queues-in-Java.md">Using Pull Queues in Java</h1><p id="-19xnhd_3">Pull queues allow you to design your own system to consume App Engine tasks. The task consumer can be part of your App Engine app (such as a <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/modules/" id="-19xnhd_14" data-external="true" rel="noopener noreferrer" target="_blank">module</a>) or a system outside of App Engine (using the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/taskqueue/rest" id="-19xnhd_15" data-external="true" rel="noopener noreferrer" target="_blank">Task Queue REST API</a>). The task consumer leases a specific number of tasks for a specific duration, then processes and deletes them before the lease ends.</p><p id="-19xnhd_4">Using pull queues requires your application to handle some functions that are automated in push queues:</p><ul class="list _bullet" id="-19xnhd_5"><li class="list__item" id="-19xnhd_16"><p id="-19xnhd_18">Your application needs to scale the number of workers based on processing volume. If your application does not handle scaling, you risk wasting computing resources if there are no tasks to process; you also risk latency if you have too many tasks to process.</p></li><li class="list__item" id="-19xnhd_17"><p id="-19xnhd_19">Your application also needs to explicitly delete tasks after processing. In push queues, App Engine deletes the tasks for you. If your application does not delete pull queue tasks after processing, another worker might re-process the task. This wastes computing resources and risks errors if tasks are not <a href="https://web.archive.org/web/20160424231004/https://en.wikipedia.org/wiki/idempotent" id="-19xnhd_20" data-external="true" rel="noopener noreferrer" target="_blank">idempotent</a>.</p></li></ul><p id="-19xnhd_6">Pull queues require a specific configuration in <code class="code" id="-19xnhd_21">queue.xml</code>. For more information, please see <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/config/queue#Java_Defining_pull_queues" id="-19xnhd_22" data-external="true" rel="noopener noreferrer" target="_blank">Defining Pull Queues</a> on the Task Queue configuration page.</p><p id="-19xnhd_7">The following sections describe the process of enqueuing, leasing, and deleting tasks using pull queues.</p><ol class="list _decimal" id="-19xnhd_8" type="1"><li class="list__item" id="-19xnhd_23"><p id="-19xnhd_28"><span id="-19xnhd_29">Pull queue overview</span></p></li><li class="list__item" id="-19xnhd_24"><p id="-19xnhd_30"><span id="-19xnhd_32">Pulling tasks within App Engine</span></p><ul class="list _bullet" id="-19xnhd_31"><li class="list__item" id="-19xnhd_33"><p id="-19xnhd_36"><span id="-19xnhd_37">Adding tasks to a pull queue</span></p></li><li class="list__item" id="-19xnhd_34"><p id="-19xnhd_38"><span id="-19xnhd_39">Leasing tasks</span></p></li><li class="list__item" id="-19xnhd_35"><p id="-19xnhd_40"><span id="-19xnhd_41">Deleting tasks</span></p></li></ul></li><li class="list__item" id="-19xnhd_25"><p id="-19xnhd_42"><span id="-19xnhd_43">Pulling tasks to a module</span></p></li><li class="list__item" id="-19xnhd_26"><p id="-19xnhd_44"><span id="-19xnhd_46">Pulling tasks from outside App Engine</span></p><ul class="list _bullet" id="-19xnhd_45"><li class="list__item" id="-19xnhd_47"><p id="-19xnhd_49"><span id="-19xnhd_50">Prerequisites</span></p></li><li class="list__item" id="-19xnhd_48"><p id="-19xnhd_51"><span id="-19xnhd_52">Using the task queue REST API with the Java Google API library</span></p></li></ul></li><li class="list__item" id="-19xnhd_27"><p id="-19xnhd_53"><span id="-19xnhd_54">Quotas and limits for pull queues</span></p></li></ol><section class="chapter"><h2 id="pull-queue-overview" data-toc="pull-queue-overview">Pull queue overview</h2><p id="-19xnhd_55">Pull queues allow a task consumer to process tasks outside of App Engine's default task processing system. If the task consumer is a part of your App Engine app, you can manipulate tasks using simple API calls from the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/package-summary" id="-19xnhd_58" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_60">com.google.appengine.api.taskqueue</code></a> package. Task consumers outside of App Engine can pull tasks using the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/taskqueue/rest" id="-19xnhd_59" data-external="true" rel="noopener noreferrer" target="_blank">Task Queue REST API</a>.</p><p id="-19xnhd_56">The process works like this:</p><ol class="list _decimal" id="-19xnhd_57" type="1"><li class="list__item" id="-19xnhd_61"><p id="-19xnhd_66">The task consumer leases tasks, either via the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/package-summary.html" id="-19xnhd_67" data-external="true" rel="noopener noreferrer" target="_blank">Task Queue API</a> (if the consumer is internal to App Engine) or the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/taskqueue/rest" id="-19xnhd_68" data-external="true" rel="noopener noreferrer" target="_blank">Task Queue REST API</a> (if the consumer is external to App Engine).</p></li><li class="list__item" id="-19xnhd_62"><p id="-19xnhd_69">App Engine sends task data to the consumer.</p></li><li class="list__item" id="-19xnhd_63"><p id="-19xnhd_70">The consumer processes the tasks. If the task fails to execute before the lease expires, the consumer can lease it again. This counts as a retry attempt, and you can <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/config/queue#Java_Configuring_retry_attempts_for_failed_tasks" id="-19xnhd_71" data-external="true" rel="noopener noreferrer" target="_blank">configure the maximum number of retry attempts</a> before the system deletes the task.</p></li><li class="list__item" id="-19xnhd_64"><p id="-19xnhd_72">Once a task executes successfully, the task consumer must delete it.</p></li><li class="list__item" id="-19xnhd_65"><p id="-19xnhd_73">The task consumer is responsible for scaling instances based on processing volume.</p></li></ol></section><section class="chapter"><h2 id="pulling-tasks-within-app-engine" data-toc="pulling-tasks-within-app-engine">Pulling tasks within App Engine</h2><p id="-19xnhd_74">You can use pull queues within the App Engine environment using simple API calls to add tasks to a pull queue, lease them, and delete them after processing.</p><p id="-19xnhd_75">Before you begin, make sure to <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/config/queue#Java_Defining_pull_queues" id="-19xnhd_79" data-external="true" rel="noopener noreferrer" target="_blank">configure the pull queue</a> in <code class="code" id="-19xnhd_80">queue.xml</code>.</p><section class="chapter"><h3 id="adding-tasks-to-a-pull-queue" data-toc="adding-tasks-to-a-pull-queue">Adding tasks to a pull queue</h3><p id="-19xnhd_81">To add tasks to a pull queue, simply get the queue using the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/config/queue.html#name" id="-19xnhd_83" data-external="true" rel="noopener noreferrer" target="_blank">queue name</a> defined in <code class="code" id="-19xnhd_84">queue.xml</code>, and use <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TaskOptions.Method#PULL" id="-19xnhd_85" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_87">TaskOptions.Method.PULL</code></a>. The following example enqueues tasks in a pull queue named <code class="code" id="-19xnhd_86">pull-queue</code>:</p><div class="code-block" data-lang="none">
Queue q = QueueFactory.getQueue(&quot;pull-queue&quot;);
q.add(TaskOptions.Builder.withMethod(TaskOptions.Method.PULL)
                                     .payload(&quot;hello world&quot;));
</div></section><section class="chapter"><h3 id="leasing-tasks" data-toc="leasing-tasks">Leasing tasks</h3><p id="-19xnhd_88"><span class="control" id="-19xnhd_99">Important:</span> Your polling loops should detect whether they are attempting to lease tasks faster than the queue can supply them. If this failure occurs, the following exceptions from <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/Queue#leaseTasks(long,%20java.util.concurrent.TimeUnit,%20long)" id="-19xnhd_100" data-external="true" rel="noopener noreferrer" target="_blank">leaseTasks()</a> can be generated: <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TransientFailureException" id="-19xnhd_101" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_103">TransientFailureException</code></a> and <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/apphosting/api/ApiProxy.ApiDeadlineExceededException" id="-19xnhd_102" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_104">ApiDeadlineExceededException</code></a>.</p><p id="-19xnhd_89">Your code must catch these exceptions, backoff from calling <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/Queue#leaseTasks(long,%20java.util.concurrent.TimeUnit,%20long)" id="-19xnhd_105" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_107">leaseTasks()</code></a>, and then try again later. To avoid this problem, consider setting a higher RPC deadline when calling <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/Queue#leaseTasks(long,%20java.util.concurrent.TimeUnit,%20long)" id="-19xnhd_106" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_108">leaseTasks()</code></a>. You should also backoff when a lease request returns an empty list of tasks.</p><p id="-19xnhd_90">If you generate more than 10 LeaseTasks requests per queue per second, only the first 10 requests will return results. The others will return no results.</p><p id="-19xnhd_91">Once you have added tasks to a pull queue, you can lease one or more tasks using <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/Queue#leaseTasks(long,%20java.util.concurrent.TimeUnit,%20long)" id="-19xnhd_109" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_113">leaseTasks()</code></a>. There may be a short delay before tasks recently added using <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/Queue#add()" id="-19xnhd_110" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_114">add()</code></a> become available via <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/Queue#leaseTasks(long,%20java.util.concurrent.TimeUnit,%20long)" id="-19xnhd_111" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_115">leaseTasks()</code></a>. When you request a lease, you specify the number of tasks to lease (up to a maximum of 1,000 tasks) and the duration of the lease in seconds (up to a maximum of one week). The lease duration needs to be long enough to ensure that the slowest task will have time to finish before the lease period expires. You can extend a task lease using <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/Queue#modifyTaskLease(com.google.appengine.api.taskqueue.TaskHandle,%20long,%20java.util.concurrent.TimeUnit)" id="-19xnhd_112" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_116">modifyTaskLease()</code></a>.</p><p id="-19xnhd_92">Leasing a task makes it unavailable for processing by another worker, and it remains unavailable until the lease expires. If you lease an individual task, the API selects the task from the front of the queue. If no such task is available, an empty list is returned.</p><p id="-19xnhd_93"><span class="control" id="-19xnhd_117">Note:</span> <code class="code" id="-19xnhd_118">leaseTasks()</code> operates only on pull queues. If you attempt to lease tasks added in a push queue, App Engine throws an exception. You can change a push queue to a pull queue by changing its definition in <code class="code" id="-19xnhd_119">queue.xml</code>. Please see <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/config/queue#Java_Defining_pull_queues" id="-19xnhd_120" data-external="true" rel="noopener noreferrer" target="_blank">Defining Pull Queues</a> for more information. The following code sample leases 100 tasks from the queue <code class="code" id="-19xnhd_121">pull-queue</code> for one hour:</p><div class="code-block" data-lang="none">
Queue q = QueueFactory.getQueue(&quot;pull-queue&quot;);

List&lt;TaskHandle&gt; tasks = q.leaseTasks(3600, TimeUnit.SECONDS, 100);
</div><p id="-19xnhd_95"><span class="control" id="-19xnhd_122">Beta</span></p><p id="-19xnhd_96">This is a Beta release of Task Tagging. This feature is not covered by any SLA or deprecation policy and may be subject to backward-incompatible changes.</p><p id="-19xnhd_97">Not all tasks are alike; your code can &quot;tag&quot; tasks and then choose tasks to lease by tag. The tag acts as a filter.</p><div class="code-block" data-lang="none">
Queue q = QueueFactory.getQueue(&quot;pull-queue&quot;);

q.add(TaskOptions.Builder.withMethod(TaskOptions.Method.PULL)
                                     .payload(&quot;parse1&quot;)
                                     .tag(&quot;parse&quot;.getBytes()));
q.add(TaskOptions.Builder.withMethod(TaskOptions.Method.PULL)
                                     .payload(&quot;parse2&quot;)
                                     .tag(&quot;parse&quot;.getBytes()));
q.add(TaskOptions.Builder.withMethod(TaskOptions.Method.PULL)
                                     .payload(&quot;render1&quot;)
                                     .tag(&quot;render&quot;.getBytes()));
q.add(TaskOptions.Builder.withMethod(TaskOptions.Method.PULL)
                                     .payload(&quot;render2&quot;)
                                     .tag(&quot;render&quot;.getBytes()));

// Lease render tasks, but not parse
q.leaseTasksByTag(3600, TimeUnit.SECONDS, 100, &quot;render&quot;);

// You can also specify a tag to lease via LeaseOptions passed to leaseTasks.
</div></section><section class="chapter"><h3 id="deleting-tasks" data-toc="deleting-tasks">Deleting tasks</h3><p id="-19xnhd_123">In general, once a worker completes a task, it needs to delete the task from the queue. If you see tasks remaining in a queue after a worker finishes processing them, it is likely that the worker failed; in this case, the tasks need to be processed by another worker.</p><p id="-19xnhd_124">You can delete an individual task or a list of tasks using <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/Queue#deleteTask(java.lang.String)" id="-19xnhd_127" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_130">deleteTask()</code></a>. You must know the name of a task in order to delete it. If you are deleting tasks from a pull queue, you can find task names in the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TaskOptions" id="-19xnhd_128" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_131">Task object</code></a> returned by <code class="code" id="-19xnhd_129">leaseTasks()</code>. If you are deleting tasks from a push queue, you need to know the task name through some other means (for example, if you created the task explicitly).</p><p id="-19xnhd_125">The following code sample demonstrates how to deletes a task named <code class="code" id="-19xnhd_132">foo</code> from the queue named <code class="code" id="-19xnhd_133">pull-queue</code>:</p><div class="code-block" data-lang="none">
Queue q = QueueFactory.getQueue(&quot;pull-queue&quot;);
q.deleteTask(&quot;foo&quot;);
</div></section></section><section class="chapter"><h2 id="pulling-tasks-to-a-module" data-toc="pulling-tasks-to-a-module">Pulling tasks to a module</h2><p id="-19xnhd_134">You can use <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/modules" id="-19xnhd_136" data-external="true" rel="noopener noreferrer" target="_blank">App Engine Modules</a> as workers to lease and process pull queue tasks. Modules allow you to process more work without having to worry about request deadlines and other restrictions normally imposed by App Engine. Using modules with pull queues gives you processing efficiencies by allowing you to batch task processing using leases.</p><p id="-19xnhd_135">For more information about using modules, check out the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/modules" id="-19xnhd_137" data-external="true" rel="noopener noreferrer" target="_blank">Modules documentation</a>.</p></section><section class="chapter"><h2 id="pulling-tasks-from-outside-app-engine" data-toc="pulling-tasks-from-outside-app-engine">Pulling tasks from outside App Engine</h2><p id="-19xnhd_138">If you need to use pull queues from outside App Engine, you must use the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/taskqueue/rest" id="-19xnhd_147" data-external="true" rel="noopener noreferrer" target="_blank">Task Queue REST API</a>. The REST API is a Google web service accessible at a globally-unique URI of the form:</p><div class="code-block" data-lang="none">
https://www.googleapis.com/taskqueue/v1beta2/projects/taskqueues
</div><p id="-19xnhd_140">Google provides the following client libraries that you can use to call the Task Queue methods remotely:</p><p id="-19xnhd_141">In the tables below, the first column shows each library's stage of development (note that some are in early stages), and links to documentation for the library. The second column links to available samples for each library.</p><div class="table-wrapper"><table class="wide" id="-19xnhd_142"><thead><tr class="ijRowHead" id="-19xnhd_148"><th id="-19xnhd_155"><p>Documentation</p></th><th id="-19xnhd_156"><p>Samples</p></th></tr></thead><tbody><tr id="-19xnhd_149"><td id="-19xnhd_157"><p><a href="https://web.archive.org/web/20160424231004/https://developers.google.com/api-client-library/java/" id="-19xnhd_159" data-external="true" rel="noopener noreferrer" target="_blank">Google API Client Library for Java</a></p></td><td id="-19xnhd_158"><p><a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/api-client-library/java/apis" id="-19xnhd_160" data-external="true" rel="noopener noreferrer" target="_blank">Java samples</a></p></td></tr><tr id="-19xnhd_150"><td id="-19xnhd_161"><p><a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/api-client-library/javascript/start/start-js" id="-19xnhd_163" data-external="true" rel="noopener noreferrer" target="_blank">Google API Client Library for JavaScript (beta)</a></p></td><td id="-19xnhd_162"><p><a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/api-client-library/javascript/samples/samples" id="-19xnhd_164" data-external="true" rel="noopener noreferrer" target="_blank">JavaScript samples</a></p></td></tr><tr id="-19xnhd_151"><td id="-19xnhd_165"><p><a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/api-client-library/dotnet/get_started" id="-19xnhd_167" data-external="true" rel="noopener noreferrer" target="_blank">Google API Client Library for .NET</a></p></td><td id="-19xnhd_166"><p><a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/api-client-library/dotnet/apis" id="-19xnhd_168" data-external="true" rel="noopener noreferrer" target="_blank">.NET samples</a></p></td></tr><tr id="-19xnhd_152"><td id="-19xnhd_169"><p><a href="https://web.archive.org/web/20160424231004/http://code.google.com/p/google-api-objectivec-client/" id="-19xnhd_171" data-external="true" rel="noopener noreferrer" target="_blank">Google API Client Library for Objective-C</a></p></td><td id="-19xnhd_170"><p><a href="https://web.archive.org/web/20160424231004/http://code.google.com/p/google-api-objectivec-client/wiki/Samples" id="-19xnhd_172" data-external="true" rel="noopener noreferrer" target="_blank">Objective-C samples</a></p></td></tr><tr id="-19xnhd_153"><td id="-19xnhd_173"><p><a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/api-client-library/php/" id="-19xnhd_175" data-external="true" rel="noopener noreferrer" target="_blank">Google API Client Library for PHP (beta)</a></p></td><td id="-19xnhd_174"><p><a href="https://web.archive.org/web/20160424231004/https://github.com/google/google-api-php-client/tree/master/examples" id="-19xnhd_176" data-external="true" rel="noopener noreferrer" target="_blank">PHP samples</a></p></td></tr><tr id="-19xnhd_154"><td id="-19xnhd_177"><p><a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/api-client-library/python/" id="-19xnhd_179" data-external="true" rel="noopener noreferrer" target="_blank">Google API Client Library for Python</a></p></td><td id="-19xnhd_178"><p><a href="https://web.archive.org/web/20160424231004/https://github.com/google/google-api-python-client/tree/master/samples" id="-19xnhd_180" data-external="true" rel="noopener noreferrer" target="_blank">Python samples</a></p></td></tr></tbody></table></div><p id="-19xnhd_143">These early-stage libraries are also available:</p><div class="table-wrapper"><table class="wide" id="-19xnhd_144"><thead><tr class="ijRowHead" id="-19xnhd_181"><th id="-19xnhd_186"><p>Documentation</p></th><th id="-19xnhd_187"><p>Samples</p></th></tr></thead><tbody><tr id="-19xnhd_182"><td id="-19xnhd_188"><p><a href="https://web.archive.org/web/20160424231004/https://www.dartlang.org/googleapis/" id="-19xnhd_190" data-external="true" rel="noopener noreferrer" target="_blank">Google APIs Client Libraries for Dart (beta)</a></p></td><td id="-19xnhd_189"><p><a href="https://web.archive.org/web/20160424231004/https://github.com/dart-lang/googleapis_examples" id="-19xnhd_191" data-external="true" rel="noopener noreferrer" target="_blank">Dart samples</a></p></td></tr><tr id="-19xnhd_183"><td id="-19xnhd_192"><p><a href="https://web.archive.org/web/20160424231004/https://github.com/google/google-api-go-client" id="-19xnhd_194" data-external="true" rel="noopener noreferrer" target="_blank">Google API Client Library for Go (alpha)</a></p></td><td id="-19xnhd_193"><p><a href="https://web.archive.org/web/20160424231004/https://github.com/google/google-api-go-client/tree/master/examples" id="-19xnhd_195" data-external="true" rel="noopener noreferrer" target="_blank">Go samples</a></p></td></tr><tr id="-19xnhd_184"><td id="-19xnhd_196"><p><a href="https://web.archive.org/web/20160424231004/https://github.com/google/google-api-nodejs-client/" id="-19xnhd_198" data-external="true" rel="noopener noreferrer" target="_blank">Google API Client Library for Node.js (alpha)</a></p></td><td id="-19xnhd_197"><p><a href="https://web.archive.org/web/20160424231004/https://github.com/google/google-api-nodejs-client/tree/master/examples" id="-19xnhd_199" data-external="true" rel="noopener noreferrer" target="_blank">Node.js samples</a></p></td></tr><tr id="-19xnhd_185"><td id="-19xnhd_200"><p><a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/api-client-library/ruby/start/get_started" id="-19xnhd_202" data-external="true" rel="noopener noreferrer" target="_blank">Google API Client Library for Ruby (alpha)</a></p></td><td id="-19xnhd_201"><p><a href="https://web.archive.org/web/20160424231004/https://github.com/google/google-api-ruby-client-samples" id="-19xnhd_203" data-external="true" rel="noopener noreferrer" target="_blank">Ruby samples</a></p></td></tr></tbody></table></div><section class="chapter"><h3 id="prerequisites" data-toc="prerequisites">Prerequisites</h3><p id="-19xnhd_204">The REST API uses OAuth as the authorization mechanism. When you configure your pull queue, make sure that your <code class="code" id="-19xnhd_205">queue.xml</code> file supplies the email addresses of the users that can access the queue using the REST API. The OAuth scope for all methods is <code class="code" id="-19xnhd_206">https://www.googleapis.com/auth/taskqueue</code>.</p></section><section class="chapter"><h3 id="using-the-task-queue-rest-api-with-the-java-google-api-library" data-toc="using-the-task-queue-rest-api-with-the-java-google-api-library">Using the task queue REST API with the Java Google API library</h3><p id="-19xnhd_207">This section demonstrates the use of the REST API in an application. The sample allows you to interact with the REST API via the command line and also provides an example of how to lease and delete tasks. The sections below show the basics of using the Client Library with relevant code snippets.</p><section class="chapter"><h4 id="importing-the-client-library-for-java" data-toc="importing-the-client-library-for-java">Importing the Client Library for Java</h4><p id="-19xnhd_211">Most of the functionality of the Client Library is encapsulated in an <code class="code" id="-19xnhd_216">HttpTransport</code> object. This object stores your authentication header and the default headers to be used with every request. Once the authentication is complete (see <code class="code" id="-19xnhd_217">Auth.java</code> in the sample code for how OAuth is handled), we set up an <code class="code" id="-19xnhd_218">HttpTransport</code> instance that will be used for all requests. From <code class="code" id="-19xnhd_219">Util.java</code>:</p><div class="code-block" data-lang="none">
import com.google.api.client.googleapis.GoogleHeaders;
import com.google.api.client.googleapis.GoogleUtils;
import com.google.api.client.http.HttpTransport;
import com.google.api.client.http.javanet.NetHttpTransport;
...
public static final HttpTransport TRANSPORT = newTransport();
...
static HttpTransport newTransport() {
    HttpTransport result = new NetHttpTransport();
    GoogleUtils.useMethodOverride(result);
    GoogleHeaders headers = new GoogleHeaders();
    headers.setApplicationName(&quot;Google-TaskQueueSample/1.0&quot;);
    result.defaultHeaders = headers;
    return result;
}
...
</div><p id="-19xnhd_213">The <code class="code" id="-19xnhd_220">HttpTransport</code> instance can now be used to make requests to the REST API. For example, here is the code from <code class="code" id="-19xnhd_221">TaskQueue.java</code> that calls <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/taskqueue/rest#method_taskqueue_taskqueues_get" id="-19xnhd_222" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_223">TaskQueue.Get</code></a> and displays information about the queue:</p><div class="code-block" data-lang="none">
public void get(String projectName, String taskQueueName, boolean getStats) throws IOException {
  HttpRequest request = Util.TRANSPORT.buildGetRequest();
  request.url = TaskQueueUrl.forTaskQueueServiceQueues(projectName,
                                                       taskQueueName,
                                                       getStats);
  return request.execute().parseAs(TaskQueue.class);
}
</div><p id="-19xnhd_215">The following sections describe the two most common functions used with the Task Queue API, allowing you to lease and delete tasks.</p></section><section class="chapter"><h4 id="leasing-tasks" data-toc="leasing-tasks">Leasing Tasks</h4><p id="-19xnhd_224">The Java library provides methods that invoke the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/taskqueue/rest/tasks/lease" id="-19xnhd_235" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_236">Tasks.lease</code></a> method in the REST API. When you create a lease, you need to specify the number of tasks to lease (up to a maximum of 1,000 tasks); the API returns the specified number of tasks in order of the oldest task ETA.</p><p id="-19xnhd_225">You also need to specify the duration of the lease in seconds (up to a maximum of one week). The lease must be long enough so you can finish all the leased tasks, yet short enough so that tasks can be made available for leasing if your consumer crashes. Similarly, if you lease too many tasks at once and your client crashes, a large number of tasks will become unavailable until the lease expires.</p><p id="-19xnhd_226">The following code shows how to lease tasks:</p><div class="code-block" data-lang="none">
private static void leaseAndDeleteTask() throws IOException {
  Task task = new Task();
  List&lt;Task&gt; leasedTasks = task.lease(projectName, taskQueueName, leaseSecs,
      numTasks);
  if (leasedTasks.size() == 0) {
    System.out.println(&quot;No tasks to lease and hence exiting&quot;);
  }
  for (Task leasedTask : leasedTasks) {
    leasedTask.executeTask();
    leasedTask.delete();
  }
}
</div><p id="-19xnhd_228">This code enables the command-line tool to lease a specified number of tasks for a set duration:</p><div class="code-block" data-lang="none">
mvn -q exec:java -Dexec.args=&quot;appengtaskpuller 30 100&quot;
</div><p id="-19xnhd_230">When run, this command-line tool constructs the following URI call to the REST API:</p><div class="code-block" data-lang="none">
POST
https://www.googleapis.com/taskqueue/v1beta2/projects/taskqueues/appengtaskpuller/tasks/lease?alt=json&amp;lease_secs=30&amp;numTasks=100
</div><p id="-19xnhd_232">This request returns an array of 100 tasks with the following JSON structure:</p><div class="code-block" data-lang="none">
{
  &quot;kind&quot;: &quot;taskqueues#tasks&quot;,
  &quot;items&quot;: [
    {
      &quot;kind&quot;: &quot;taskqueues#task&quot;,
      &quot;id&quot;: string,
      &quot;queueName&quot;: string,
      &quot;payloadBase64&quot;: string,
      &quot;enqueueTimestamp&quot;: number,
      &quot;leaseTimestamp&quot;: number
    }
    ...
  ]
}
</div><p id="-19xnhd_234">After processing each task, you need to delete it, as described in the following section.</p></section><section class="chapter"><h4 id="deleting-tasks" data-toc="deleting-tasks">Deleting Tasks</h4><p id="-19xnhd_237">In general, once a worker completes a task, it needs to delete the task from the queue. If you see tasks remaining in a queue after a worker finishes processing, it is likely that the worker failed; in this case, the tasks need to be processed by another worker.</p><p id="-19xnhd_238">You can delete an individual task or a list of tasks using the REST method <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/taskqueue/rest/tasks/delete" id="-19xnhd_246" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_249">Task.delete</code></a>. You must know the name of a task in order to delete it. You can get the task name from the id field of the <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/TaskOptions" id="-19xnhd_247" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_250">Task object</code></a> returned by <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/taskqueue/rest/tasks/lease" id="-19xnhd_248" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_251">Task.lease</code></a>.</p><p id="-19xnhd_239">Call delete if you have finished a task, even if you have exceeded the lease time. Tasks should be <a href="https://web.archive.org/web/20160424231004/https://en.wikipedia.org/wiki/Idempotence" id="-19xnhd_252" data-external="true" rel="noopener noreferrer" target="_blank">idempotent</a>, so even if a task lease expires and another client leases the task, performing the same task twice should not cause an error.</p><p id="-19xnhd_240"><span class="control" id="-19xnhd_253">Note:</span> When you delete a task, it immediately becomes invisible to queries, but its name remains in the system for up to seven days. During this time, attempting to create another task with the same name will result in an &quot;item exists&quot; error. The system offers no method to determine if deleted task names are still in the system. To avoid these issues, we recommend that you let App Engine generate the task name automatically.</p><p id="-19xnhd_241">The following code snippet deletes tasks from a queue:</p><div class="code-block" data-lang="none">
private static void leaseAndDeleteTask() throws IOException {
  Task task = new Task();
  List&lt;Task&gt; leasedTasks = task.lease(projectName, taskQueueName, leaseSecs,
      numTasks);
  if (leasedTasks.size() == 0) {
    System.out.println(&quot;No tasks to lease and hence exiting&quot;);
  }
  for (Task leasedTask : leasedTasks) {
    leasedTask.executeTask();
    leasedTask.delete();
  }
}
</div><p id="-19xnhd_243">The delete method implementation can be seen here:</p><div class="code-block" data-lang="none">
public void delete() throws HttpResponseException, IOException {
  HttpRequest request = Util.TRANSPORT.buildDeleteRequest();
  String projectName = getProjectFromQueueName();
  String queueName = getQueueFromQueueName();
  if (projectName.isEmpty() || queueName.isEmpty()) {
    System.out.println(&quot;Error parsing full queue name:&quot; + this.queueName +
        &quot; Hence unable to delete task&quot; + this.id);
    return;
  }
  request.url = TaskQueueUrl.forTaskQueueServiceTasks(projectName, queueName);
  request.url.pathParts.add(this.id);
  try {
    request.execute();
  } catch (HttpResponseException hre) {
    System.out.println(&quot;Error deleting task: &quot; + this.id);
    throw hre;
  }
}
</div><p id="-19xnhd_245">If the delete command is successful, the REST API returns an HTTP 200 response. If deletion fails, the API returns an HTTP failure code.</p></section></section></section><section class="chapter"><h2 id="quotas-and-limits-for-pull-queues" data-toc="quotas-and-limits-for-pull-queues">Quotas and limits for pull queues</h2><p id="-19xnhd_254">Enqueuing a task counts counts toward the following quotas:</p><ul class="list _bullet" id="-19xnhd_255"><li class="list__item" id="-19xnhd_262"><p id="-19xnhd_265">Task Queue Stored Task Count</p></li><li class="list__item" id="-19xnhd_263"><p id="-19xnhd_266">Task Queue API Calls</p></li><li class="list__item" id="-19xnhd_264"><p id="-19xnhd_267">Task Queue Stored Task Bytes</p></li></ul><p id="-19xnhd_256">Leasing a task counts toward the following quotas:</p><ul class="list _bullet" id="-19xnhd_257"><li class="list__item" id="-19xnhd_268"><p id="-19xnhd_270">Task Queue API Calls</p></li><li class="list__item" id="-19xnhd_269"><p id="-19xnhd_271">Outgoing Bandwidth (if using the REST API)</p></li></ul><p id="-19xnhd_258">The Task Queue Stored Task Bytes quota is configurable in <code class="code" id="-19xnhd_272">queue.xml</code> by setting <a href="https://web.archive.org/web/20160424231004/https://cloud.google.com/appengine/docs/java/config/queue#Setting_the_Storage_Limit_for_All_Queues" id="-19xnhd_273" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-19xnhd_274">&lt;total-storage-limit&gt;</code></a>. This quota counts towards your Stored Data (billable) quota.</p><p id="-19xnhd_259">The following limits apply to the use of pull queues:</p><div class="table-wrapper"><table class="" id="-19xnhd_260"><thead><tr class="ijRowHead" id="-19xnhd_275"><th id="-19xnhd_282" colspan="2"><p>Pull Queue Limits</p></th></tr></thead><tbody><tr id="-19xnhd_276"><td id="-19xnhd_283"><p>Maximum task size</p></td><td id="-19xnhd_284"><p>1MB</p></td></tr><tr id="-19xnhd_277"><td id="-19xnhd_285"><p>Maximum countdown/ETA for a task</p></td><td id="-19xnhd_286"><p>30 days from the current date and time</p></td></tr><tr id="-19xnhd_278"><td id="-19xnhd_287"><p>Maximum number of tasks that can be added in a batch</p></td><td id="-19xnhd_288"><p>100 tasks</p></td></tr><tr id="-19xnhd_279"><td id="-19xnhd_289"><p>Maximum number of tasks that can be added in a transaction</p></td><td id="-19xnhd_290"><p>5 tasks</p></td></tr><tr id="-19xnhd_280"><td id="-19xnhd_291"><p>Maximum number of tasks that you can lease in a single operation</p></td><td id="-19xnhd_292"><p>1000 tasks</p></td></tr><tr id="-19xnhd_281"><td id="-19xnhd_293"><p>Maximum payload size when leasing a batch of tasks</p></td><td id="-19xnhd_294"><p>32MB (1MB when using the REST API)</p></td></tr></tbody></table></div><div class="table-wrapper"><table class="" id="-19xnhd_261"><thead><tr class="ijRowHead" id="-19xnhd_295"><th id="-19xnhd_297" colspan="2"><p>Combined Limits (Push and Pull Queues)</p></th></tr></thead><tbody><tr id="-19xnhd_296"><td id="-19xnhd_298"><p>Maximum number of active queues (not including the default queue)</p></td><td id="-19xnhd_299"><p>Free apps: 10 queues, Billed apps: 100 queues</p></td></tr></tbody></table></div></section><div class="last-modified">10 April 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="using-push-queues-in-java.html" class="navigation-links__prev">Using Push Queues in Java</a><a href="task-queue-rest-apialpha.html" class="navigation-links__next">Task Queue REST APIAlpha</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>