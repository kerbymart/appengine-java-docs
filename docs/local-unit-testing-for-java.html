<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-13T01:56:45.088386743"><title>Local Unit Testing for Java | Google App Engine Java Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"setting-up-a-testing-framework","level":0,"title":"Setting up a testing framework","anchor":"#setting-up-a-testing-framework"},{"id":"introducing-the-java-testing-utilities","level":0,"title":"Introducing the Java testing utilities","anchor":"#introducing-the-java-testing-utilities"},{"id":"writing-datastore-and-memcache-tests","level":0,"title":"Writing Datastore and memcache tests","anchor":"#writing-datastore-and-memcache-tests"},{"id":"writing-high-replication-datastore-tests","level":0,"title":"Writing High Replication Datastore tests","anchor":"#writing-high-replication-datastore-tests"},{"id":"writing-task-queue-tests","level":0,"title":"Writing task queue tests","anchor":"#writing-task-queue-tests"},{"id":"writing-deferred-task-tests","level":0,"title":"Writing deferred task tests","anchor":"#writing-deferred-task-tests"},{"id":"writing-local-service-capabilities-tests","level":0,"title":"Writing local service capabilities tests","anchor":"#writing-local-service-capabilities-tests"},{"id":"writing-tests-for-other-services","level":0,"title":"Writing tests for other services","anchor":"#writing-tests-for-other-services"},{"id":"writing-tests-with-authentication-expectations","level":0,"title":"Writing tests with authentication expectations","anchor":"#writing-tests-with-authentication-expectations"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Local Unit Testing for Java | Google App Engine Java Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Google App Engine Java Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/local-unit-testing-for-java.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Local Unit Testing for Java | Google App Engine Java Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/local-unit-testing-for-java.html#webpage",
    "url": "writerside-documentation/local-unit-testing-for-java.html",
    "name": "Local Unit Testing for Java | Google App Engine Java Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Google App Engine Java Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="Local-Unit-Testing-for-Java" data-main-title="Local Unit Testing for Java" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Guides.md|Guides///Developing-Java-Apps-on-App-Engine.md|Developing Java Apps on App Engine///Testing-and-Debugging.md|Testing and Debugging///Local-Unit-Testing.md|Local Unit Testing"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Google App Engine Java Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Local-Unit-Testing-for-Java" id="Local-Unit-Testing-for-Java.md">Local Unit Testing for Java</h1><p id="wk0qkz_3"><a href="https://web.archive.org/web/20160424225837/https://en.wikipedia.org/wiki/Unit_testing" id="wk0qkz_17" data-external="true" rel="noopener noreferrer" target="_blank">Unit testing</a> allows you to check the quality of your code after you've written it, but you can also use unit testing to improve your development process as you go along. Instead of writing tests after you finish developing your application, consider writing the tests as you go. This helps you design small, maintainable, reusable units of code. It also makes it easier for you to test your code thoroughly and quickly.</p><p id="wk0qkz_4">When you do local unit testing, you run tests that stay inside your own development environment without involving remote components. App Engine provides testing utilities that use local implementations of datastore and other <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/apis" id="wk0qkz_18" data-external="true" rel="noopener noreferrer" target="_blank">App Engine services</a>. This means you can exercise your code's use of these services locally, without deploying your code to App Engine, by using service stubs.</p><p id="wk0qkz_5">A service stub is a method that simulates the behavior of the service. For example, the datastore service stub shown in <span id="wk0qkz_19">Writing Datastore and Memcache Tests</span> allows you to test your datastore code without making any requests to the real datastore. Any entity stored during a datastore unit test is held in memory, not in the datastore, and is deleted after the test run. You can run small, fast tests without any dependency on datastore itself.</p><p id="wk0qkz_6">This document provides some information about setting up a testing framework, then describes how to write unit tests against several local App Engine services.</p><ol class="list _decimal" id="wk0qkz_7" type="1"><li class="list__item" id="wk0qkz_20"><p id="wk0qkz_29"><span id="wk0qkz_30">Setting up a testing framework</span></p></li><li class="list__item" id="wk0qkz_21"><p id="wk0qkz_31"><span id="wk0qkz_32">Introducing the Java testing utilities</span></p></li><li class="list__item" id="wk0qkz_22"><p id="wk0qkz_33"><span id="wk0qkz_34">Writing Datastore and memcache tests</span></p></li><li class="list__item" id="wk0qkz_23"><p id="wk0qkz_35"><span id="wk0qkz_36">Writing High Replication Datastore tests</span></p></li><li class="list__item" id="wk0qkz_24"><p id="wk0qkz_37"><span id="wk0qkz_38">Writing task queue tests</span></p></li><li class="list__item" id="wk0qkz_25"><p id="wk0qkz_39"><span id="wk0qkz_40">Writing deferred task tests</span></p></li><li class="list__item" id="wk0qkz_26"><p id="wk0qkz_41"><span id="wk0qkz_42">Writing local service capabilities tests</span></p></li><li class="list__item" id="wk0qkz_27"><p id="wk0qkz_43"><span id="wk0qkz_44">Writing tests for other services</span></p></li><li class="list__item" id="wk0qkz_28"><p id="wk0qkz_45"><span id="wk0qkz_46">Writing tests with authentication expectations</span></p></li></ol><section class="chapter"><h2 id="setting-up-a-testing-framework" data-toc="setting-up-a-testing-framework">Setting up a testing framework</h2><p id="wk0qkz_47">Even though the SDK's testing utilities are not tied to any specific framework, we'll use <a href="https://web.archive.org/web/20160424225837/http://www.junit.org/" id="wk0qkz_54" data-external="true" rel="noopener noreferrer" target="_blank">JUnit</a> for our examples so you have something concrete and complete to work from. Before you begin writing tests you'll need to add the appropriate <a href="https://web.archive.org/web/20160424225837/https://github.com/junit-team/junit/wiki/Download-and-Install" id="wk0qkz_55" data-external="true" rel="noopener noreferrer" target="_blank">JUnit 4 JAR</a> to your testing classpath. Once that's done you're ready to write a very simple JUnit test.</p><p id="wk0qkz_48"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/MyFirstTest.java" id="wk0qkz_56" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/MyFirstTest.java</a></p><p id="wk0qkz_49"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/MyFirstTest.java" id="wk0qkz_57" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_50">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_51">If you're running Eclipse 3.5, select the source file of the test to run. Select the <span class="control" id="wk0qkz_58">Run</span> menu &gt; <span class="control" id="wk0qkz_59">Run As</span> &gt; <span class="control" id="wk0qkz_60">JUnit Test</span>. The results of the test appear in the Console window.</p><p id="wk0qkz_52">For information on running your tests with Apache Ant, please read the <a href="https://web.archive.org/web/20160424225837/http://ant.apache.org/manual/Tasks/junit.html" id="wk0qkz_61" data-external="true" rel="noopener noreferrer" target="_blank">Ant JUnit Task</a> documentation.</p><p id="wk0qkz_53"><span class="control" id="wk0qkz_62">Note:</span> It is good practice to store your unit tests in a different location than your application code. Also avoid deploying JUnit and other testing packages with your application.</p></section><section class="chapter"><h2 id="introducing-the-java-testing-utilities" data-toc="introducing-the-java-testing-utilities">Introducing the Java testing utilities</h2><p id="wk0qkz_63"><code class="code" id="wk0qkz_71">MyFirstTest</code> demonstrates the simplest possible test setup, and for tests that have no dependency on App Engine APIs or local service implementations, you may not need anything more. However, if your tests or code under test have these dependencies, add the following JAR files to your testing classpath:</p><ul class="list _bullet" id="wk0qkz_64"><li class="list__item" id="wk0qkz_72"><p id="wk0qkz_76"><code class="code" id="wk0qkz_77">${SDK_ROOT}/lib/impl/appengine-api.jar</code></p></li><li class="list__item" id="wk0qkz_73"><p id="wk0qkz_78"><code class="code" id="wk0qkz_79">${SDK_ROOT}/lib/impl/appengine-api-labs.jar</code></p></li><li class="list__item" id="wk0qkz_74"><p id="wk0qkz_80"><code class="code" id="wk0qkz_81">${SDK_ROOT}/lib/impl/appengine-api-stubs.jar</code></p></li><li class="list__item" id="wk0qkz_75"><p id="wk0qkz_82"><code class="code" id="wk0qkz_83">${SDK_ROOT}/lib/impl/appengine-tools-sdk.jar</code></p></li></ul><p id="wk0qkz_65">These JARs make the runtime APIs and the local implementations of those APIs available to your tests.</p><p id="wk0qkz_66">App Engine services expect a number of things from their execution environment, and setting these things up involves a fair amount of boilerplate code. Rather than set it up yourself, you can use the utilities in the <code class="code" id="wk0qkz_84">com.google.appengine.tools.development.testing</code> package. To use this package, add the following JAR file to your testing classpath:</p><ul class="list _bullet" id="wk0qkz_67"><li class="list__item" id="wk0qkz_85"><p id="wk0qkz_86"><code class="code" id="wk0qkz_87">${SDK_ROOT}/lib/testing/appengine-testing.jar</code></p></li></ul><p id="wk0qkz_68">Take a minute to browse the <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/tools/localunittesting/javadoc" id="wk0qkz_88" data-external="true" rel="noopener noreferrer" target="_blank">javadoc</a> for the <code class="code" id="wk0qkz_89">com.google.appengine.tools.development.testing</code> package. The most important class in this package is <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/tools/localunittesting/javadoc/com/google/appengine/tools/development/testing/LocalServiceTestHelper" id="wk0qkz_90" data-external="true" rel="noopener noreferrer" target="_blank">LocalServiceTestHelper</a>, which handles all of the necessary environment setup and gives you a top-level point of configuration for all the local services you might want to access in your tests.</p><p id="wk0qkz_69">To write a test that accesses a specific local service:</p><ul class="list _bullet" id="wk0qkz_70"><li class="list__item" id="wk0qkz_91"><p id="wk0qkz_93">Create an instance of <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/tools/localunittesting/javadoc/com/google/appengine/tools/development/testing/LocalServiceTestHelper" id="wk0qkz_94" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="wk0qkz_96">LocalServiceTestHelper</code></a> with a <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/tools/localunittesting/javadoc/com/google/appengine/tools/development/testing/LocalServiceTestConfig" id="wk0qkz_95" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="wk0qkz_97">LocalServiceTestConfig</code></a> implementation for that specific local service.</p></li><li class="list__item" id="wk0qkz_92"><p id="wk0qkz_98">Call <code class="code" id="wk0qkz_99">setUp()</code> on your <code class="code" id="wk0qkz_100">LocalServiceTestHelper</code> instance before each test and <code class="code" id="wk0qkz_101">tearDown()</code> after each test.</p></li></ul></section><section class="chapter"><h2 id="writing-datastore-and-memcache-tests" data-toc="writing-datastore-and-memcache-tests">Writing Datastore and memcache tests</h2><p id="wk0qkz_102">The following example tests the use of the <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/datastore/index" id="wk0qkz_108" data-external="true" rel="noopener noreferrer" target="_blank">datastore</a> service.</p><p id="wk0qkz_103"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalDatastoreTest.java" id="wk0qkz_109" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/LocalDatastoreTest.java</a></p><p id="wk0qkz_104"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalDatastoreTest.java" id="wk0qkz_110" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_105">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_106">In this example, <code class="code" id="wk0qkz_111">LocalServiceTestHelper</code> sets up and tears down the parts of the execution environment that are common to all local services, and <code class="code" id="wk0qkz_112">LocalDatastoreServiceTestConfig</code> sets up and tears down the parts of the execution environment that are specific to the local datastore service. If you read the <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/tools/localunittesting/javadoc" id="wk0qkz_113" data-external="true" rel="noopener noreferrer" target="_blank">javadoc</a> you'll learn that this involves configuring the local datastore service to keep all data in memory (as opposed to flushing to disk at regular intervals) and wiping out all in-memory data at the end of every test. This is just the default behavior for a datastore test, and if this behavior isn't what you want you can change it.</p><section class="chapter"><h3 id="changing-the-example-to-access-memcache-instead-of-datastore" data-toc="changing-the-example-to-access-memcache-instead-of-datastore">Changing the example to access memcache instead of datastore</h3><p id="wk0qkz_114">To create a test that accesses the local memcache service, you can use the code that is shown above, with a few small changes.</p><p id="wk0qkz_115">Instead of importing classes related to datastore, import those related to memcache. You still need to import <code class="code" id="wk0qkz_128">LocalServiceTestHelper</code>.</p><p id="wk0qkz_116"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalMemcacheTest.java" id="wk0qkz_129" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/LocalMemcacheTest.java</a></p><p id="wk0qkz_117"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalMemcacheTest.java" id="wk0qkz_130" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_118">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_119">Change the name of the class that you are creating, and change the instance of <code class="code" id="wk0qkz_131">LocalServiceTestHelper</code>, so that they are specific to memcache.</p><p id="wk0qkz_120"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalMemcacheTest.java" id="wk0qkz_132" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/LocalMemcacheTest.java</a></p><p id="wk0qkz_121"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalMemcacheTest.java" id="wk0qkz_133" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_122">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_123">And finally, change the way you actually run the test so that it is relevant to memcache.</p><p id="wk0qkz_124"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalMemcacheTest.java" id="wk0qkz_134" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/LocalMemcacheTest.java</a></p><p id="wk0qkz_125"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalMemcacheTest.java" id="wk0qkz_135" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_126">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_127">As in the datastore example, the <code class="code" id="wk0qkz_136">LocalServiceTestHelper</code> and the service-specific <code class="code" id="wk0qkz_137">LocalServiceTestConfig</code> (in this case <code class="code" id="wk0qkz_138">LocalMemcacheServiceTestConfig</code>) manage the execution environment.</p></section></section><section class="chapter"><h2 id="writing-high-replication-datastore-tests" data-toc="writing-high-replication-datastore-tests">Writing High Replication Datastore tests</h2><p id="wk0qkz_139">If your app uses the High Replication Datastore (HRD), you may want to write tests that verify your application's behavior in the face of eventual consistency. <code class="code" id="wk0qkz_149">LocalDatastoreServiceTestConfig</code> exposes options that make this easy:</p><p id="wk0qkz_140"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalHighRepDatastoreTest.java" id="wk0qkz_150" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/LocalHighRepDatastoreTest.java</a></p><p id="wk0qkz_141"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalHighRepDatastoreTest.java" id="wk0qkz_151" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_142">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_143">By setting the unapplied job percentage to 100, we are instructing the local datastore to operate with the maximum amount of eventual consistency. Maximum eventual consistency means writes will commit but always fail to apply, so global (non-ancestor) queries will consistently fail to see changes. This is of course not representative of the amount of eventual consistency your application will see when running in production, but for testing purposes, it's very useful to be able to configure the local datastore to behave this way every time.</p><p id="wk0qkz_144">If you want more fine-grained control over which transactions fail to apply, you can register your own <code class="code" id="wk0qkz_152">HighRepJobPolicy</code>:</p><p id="wk0qkz_145"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalCustomPolicyHighRepDatastoreTest.java" id="wk0qkz_153" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/LocalCustomPolicyHighRepDatastoreTest.java</a></p><p id="wk0qkz_146"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/LocalCustomPolicyHighRepDatastoreTest.java" id="wk0qkz_154" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_147">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_148">The testing APIs are useful for verifying that your application behaves properly in the face of eventual consistency, but please keep in mind that the local High Replication read consistency model is an approximation of the production High Replication read consistency model, not an exact replica. In the local environment, performing a <code class="code" id="wk0qkz_155">get()</code> of an <code class="code" id="wk0qkz_156">Entity</code> that belongs to an entity group with an unapplied write will always make the results of the unapplied write visible to subsequent global queries. In production this is not the case.</p></section><section class="chapter"><h2 id="writing-task-queue-tests" data-toc="writing-task-queue-tests">Writing task queue tests</h2><p id="wk0qkz_157">Tests that use the local task queue are a bit more involved because, unlike datastore and memcache, the task queue API does not expose a facility for examining the state of the service. We need to access the local task queue itself to verify that a task has been scheduled with the expected parameters. To do this, we need <code class="code" id="wk0qkz_163">com.google.appengine.api.taskqueue.dev.LocalTaskQueue</code>.</p><p id="wk0qkz_158"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/TaskQueueTest.java" id="wk0qkz_164" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/TaskQueueTest.java</a></p><p id="wk0qkz_159"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/TaskQueueTest.java" id="wk0qkz_165" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_160">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_161">Notice how we ask the <code class="code" id="wk0qkz_166">LocalTaskqueueTestConfig</code> for a handle to the local service instance, and then we investigate the local service itself to make sure the task was scheduled as expected. All <code class="code" id="wk0qkz_167">LocalServiceTestConfig</code> implementations expose a similar method. You may not always need it, but sooner or later you'll be glad it's there.</p><section class="chapter"><h3 id="setting-the-queue-xml-configuration-file" data-toc="setting-the-queue-xml-configuration-file">Setting the <code class="code" id="wk0qkz_179">queue.xml</code> configuration file</h3><p id="wk0qkz_169">The task queue test libraries allow any number of <code class="code" id="wk0qkz_180">queue.xml</code> configurations to be specified on a per-LocalServiceTestHelper basis via the <code class="code" id="wk0qkz_181">LocalTaskQueueTestConfig.setQueueXmlPath</code> method. Currently any queue's rate limit settings are ignored by the local development server. It is not possible to run simultaneous tasks at a time locally.</p><p id="wk0qkz_170">For example, a project may need to test against the <code class="code" id="wk0qkz_182">queue.xml</code> file that will be uploaded and used by the App Engine application. Assuming that the <code class="code" id="wk0qkz_183">queue.xml</code> file is in the standard location, the above sample code could be modified as follows to grant the test access to the queues specified in the <code class="code" id="wk0qkz_184">src/main/webapp/WEB-INF/queue.xml</code> file:</p><p id="wk0qkz_171"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/TaskQueueConfigTest.java" id="wk0qkz_185" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/TaskQueueConfigTest.java</a></p><p id="wk0qkz_172"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/TaskQueueConfigTest.java" id="wk0qkz_186" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_173">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_174">Modify the path to the <code class="code" id="wk0qkz_187">queue.xml</code> file to fit your project's file structure.</p><p id="wk0qkz_175">Use the <code class="code" id="wk0qkz_188">QueueFactory.getQueue</code> method to access queues by name:</p><p id="wk0qkz_176"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/TaskQueueConfigTest.java" id="wk0qkz_189" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/TaskQueueConfigTest.java</a></p><p id="wk0qkz_177"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/TaskQueueConfigTest.java" id="wk0qkz_190" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_178">\[This section requires a browser that supports JavaScript and iframes.\]</p></section></section><section class="chapter"><h2 id="writing-deferred-task-tests" data-toc="writing-deferred-task-tests">Writing deferred task tests</h2><p id="wk0qkz_191">If your application code uses <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/javadoc/com/google/appengine/api/taskqueue/DeferredTask" id="wk0qkz_196" data-external="true" rel="noopener noreferrer" target="_blank">Deferred Tasks</a>, the Java Testing Utilities make it easy to write an integration test that verifies the results of these tasks.</p><p id="wk0qkz_192"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/DeferredTaskTest.java" id="wk0qkz_197" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/DeferredTaskTest.java</a></p><p id="wk0qkz_193"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/DeferredTaskTest.java" id="wk0qkz_198" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_194">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_195">As with our first Local Task Queue example, we are using a <code class="code" id="wk0qkz_199">LocalTaskqueueTestConfig</code>, but this time we are initializing it with some additional arguments that give us an easy way to verify not just that the task was scheduled but that the task was executed: We call <code class="code" id="wk0qkz_200">setDisableAutoTaskExecution(false)</code> to tell the Local Task Queue to automatically execute tasks. We call <code class="code" id="wk0qkz_201">setCallbackClass(LocalTaskQueueTestConfig.DeferredTaskCallback.class)</code> to tell the Local Task Queue to use a callback that understands how to execute Deferred tasks. And finally we call <code class="code" id="wk0qkz_202">setTaskExecutionLatch(latch)</code> to tell the Local Task Queue to decrement the latch after each task execution. This configuration allows us to write a test in which we enqueue a Deferred task, wait until that task runs, and then verify that the task behaved as expected when it ran.</p></section><section class="chapter"><h2 id="writing-local-service-capabilities-tests" data-toc="writing-local-service-capabilities-tests">Writing local service capabilities tests</h2><p id="wk0qkz_203">Capabilities testing involves changing the status of some service, such as datastore, blobstore, memcache, and so forth, and running your application against that service to determine whether your application is responding as expected under different conditions. The capability status can be changed using the <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/tools/localunittesting/javadoc/com/google/appengine/tools/development/testing/LocalCapabilitiesServiceTestConfig" id="wk0qkz_211" data-external="true" rel="noopener noreferrer" target="_blank">LocalCapabilitiesServiceTestConfig</a> class.</p><p id="wk0qkz_204"><span class="control" id="wk0qkz_212">Note:</span> The capability status can also be changed in the dev app server console, or via command line options. For complete details, see <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/tools/capabilities" id="wk0qkz_213" data-external="true" rel="noopener noreferrer" target="_blank">Capabilities Service Test Configuration</a>.</p><p id="wk0qkz_205">The following code snippet changes the capability status of the datastore service to disabled and then runs a test on the datastore service. (You can substitute other services for datastore as needed.)</p><p id="wk0qkz_206"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/ShortTest.java" id="wk0qkz_214" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/ShortTest.java</a></p><p id="wk0qkz_207"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/ShortTest.java" id="wk0qkz_215" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_208">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_209">The sample test first creates a <code class="code" id="wk0qkz_216">Capability</code> object initialized to datastore, then creates a <code class="code" id="wk0qkz_217">CapabilityStatus</code> object set to DISABLED. The <code class="code" id="wk0qkz_218">LocalCapabilitiesServiceTestConfig</code> is created with the capability and status set using the <code class="code" id="wk0qkz_219">Capability</code> and <code class="code" id="wk0qkz_220">CapabilityStatus</code> objects just created.</p><p id="wk0qkz_210">The <code class="code" id="wk0qkz_221">LocalServiceHelper</code> is then created using the <code class="code" id="wk0qkz_222">LocalCapabilitiesServiceTestConfig</code> object. Now that the test has been set up, the <code class="code" id="wk0qkz_223">DatastoreService</code> is created and a Query is sent to it to determine whether the test generates the expected results, in this case, a <code class="code" id="wk0qkz_224">CapabilityDisabledException</code>.</p></section><section class="chapter"><h2 id="writing-tests-for-other-services" data-toc="writing-tests-for-other-services">Writing tests for other services</h2><p id="wk0qkz_225">Testing utilities are available for blobstore and other App Engine services. For a list of all the services that have local implementations for testing, see the <a href="https://web.archive.org/web/20160424225837/https://cloud.google.com/appengine/docs/java/tools/localunittesting/javadoc/com/google/appengine/tools/development/testing/LocalServiceTestConfig" id="wk0qkz_226" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="wk0qkz_227">LocalServiceTestConfig</code></a> documentation.</p></section><section class="chapter"><h2 id="writing-tests-with-authentication-expectations" data-toc="writing-tests-with-authentication-expectations">Writing tests with authentication expectations</h2><p id="wk0qkz_228">This example shows how to write tests that verify logic that uses UserService to determine if a user is logged on or has admin privileges.</p><p id="wk0qkz_229"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/AuthenticationTest.java" id="wk0qkz_238" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/AuthenticationTest.java</a></p><p id="wk0qkz_230"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/AuthenticationTest.java" id="wk0qkz_239" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_231">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_232">In this example, we're configuring the <code class="code" id="wk0qkz_240">LocalServiceTestHelper</code> with the <code class="code" id="wk0qkz_241">LocalUserServiceTestConfig</code> so we can use the <code class="code" id="wk0qkz_242">UserService</code> in our test, but we're also configuring some authentication-related environment data on the <code class="code" id="wk0qkz_243">LocalServiceTestHelper</code> itself.</p><p id="wk0qkz_233">This example shows how to write tests that verify logic using OAuthService:</p><p id="wk0qkz_234"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/OAuthTest.java" id="wk0qkz_244" data-external="true" rel="noopener noreferrer" target="_blank">unittests/src/test/java/com/google/appengine/samples/OAuthTest.java</a></p><p id="wk0qkz_235"><a href="https://web.archive.org/web/20160424225837/https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/unittests/src/test/java/com/google/appengine/samples/OAuthTest.java" id="wk0qkz_245" data-external="true" rel="noopener noreferrer" target="_blank">View on GitHub</a></p><p id="wk0qkz_236">\[This section requires a browser that supports JavaScript and iframes.\]</p><p id="wk0qkz_237">In this example, we're configuring the <code class="code" id="wk0qkz_246">LocalServiceTestHelper</code> with the <code class="code" id="wk0qkz_247">LocalUserServiceTestConfig</code> so we can use the <code class="code" id="wk0qkz_248">OAuthService</code>.</p></section><div class="last-modified">10 April 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="local-unit-testing.html" class="navigation-links__prev">Local Unit Testing</a><a href="local-unit-testing-javadoc.html" class="navigation-links__next">Local Unit Testing Javadoc</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>