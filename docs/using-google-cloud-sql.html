<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-13T01:56:44.524331172"><title>Using Google Cloud SQL | Google App Engine Java Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"creating-a-cloud-sql-instance","level":0,"title":"Creating a Cloud SQL Instance","anchor":"#creating-a-cloud-sql-instance"},{"id":"build-a-starter-application-and-database","level":0,"title":"Build a starter application and database","anchor":"#build-a-starter-application-and-database"},{"id":"connect-to-your-database","level":0,"title":"Connect to your database","anchor":"#connect-to-your-database"},{"id":"using-a-local-mysql-instance-during-development","level":0,"title":"Using a local MySQL instance during development","anchor":"#using-a-local-mysql-instance-during-development"},{"id":"size-and-access-limits","level":0,"title":"Size and access limits","anchor":"#size-and-access-limits"},{"id":"using-persistence-apis-with-cloud-sql","level":0,"title":"Using Persistence APIs with Cloud SQL","anchor":"#using-persistence-apis-with-cloud-sql"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Using Google Cloud SQL | Google App Engine Java Documentation"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Google App Engine Java Documentation Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/using-google-cloud-sql.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Using Google Cloud SQL | Google App Engine Java Documentation"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/using-google-cloud-sql.html#webpage",
    "url": "writerside-documentation/using-google-cloud-sql.html",
    "name": "Using Google Cloud SQL | Google App Engine Java Documentation",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Google App Engine Java Documentation Help"
}</script><!-- End Schema.org --></head><body data-id="Using-Google-Cloud-SQL" data-main-title="Using Google Cloud SQL" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Guides.md|Guides///Storing-Data.md|Storing Data"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Google App Engine Java Documentation  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Using-Google-Cloud-SQL" id="Using-Google-Cloud-SQL.md">Using Google Cloud SQL</h1><p id="z2r5jia_3"><a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/python/cloud-sql/" id="z2r5jia_19" data-tooltip="View this page in the Python runtime" data-external="true" rel="noopener noreferrer" target="_blank">Python</a> |Java |<a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/php/cloud-sql/" id="z2r5jia_20" data-tooltip="View this page in the PHP runtime" data-external="true" rel="noopener noreferrer" target="_blank">PHP</a> |<a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/go/cloud-sql/" id="z2r5jia_21" data-tooltip="View this page in the Go runtime" data-external="true" rel="noopener noreferrer" target="_blank">Go</a></p><p id="z2r5jia_4"><a href="https://web.archive.org/web/20160424230503/http://stackoverflow.com/questions/tagged/google-app-engine+google-cloud-sql" id="z2r5jia_22" data-external="true" rel="noopener noreferrer" target="_blank"><figure id="z2r5jia_23"><img alt="Stack overflow questions" src="https://web.archive.org/web/20160424230503im_/https://cloud.google.com/cloud/images/stack_overflow_questions.png" title="Stack Overflow Questions" width="240" height="53"></figure></a></p><p id="z2r5jia_5"><a href="https://web.archive.org/web/20160424230503/http://stackoverflow.com/feeds/tag?sort=votes&amp;tagnames=google-app-engine%2Bgoogle-cloud-sql" id="z2r5jia_24" data-external="true" rel="noopener noreferrer" target="_blank">https://web.archive.org/web/20160424230503/http://stackoverflow.com/feeds/tag?sort=votes&amp;tagnames=google-app-engine%2Bgoogle-cloud-sql</a></p><p id="z2r5jia_6"></p><p id="z2r5jia_7"><a href="https://web.archive.org/web/20160424230503/http://stackoverflow.com/questions/tagged/google-app-engine+google-cloud-sql?sort=votes" id="z2r5jia_25" data-external="true" rel="noopener noreferrer" target="_blank">See more...</a></p><p id="z2r5jia_8">This document describes how to use Google Cloud SQL instances with the App Engine Java SDK.</p><ol class="list _decimal" id="z2r5jia_9" type="1"><li class="list__item" id="z2r5jia_26"><p id="z2r5jia_32"><span id="z2r5jia_33">Creating a Cloud SQL instance</span></p></li><li class="list__item" id="z2r5jia_27"><p id="z2r5jia_34"><span id="z2r5jia_35">Build a starter application and database</span></p></li><li class="list__item" id="z2r5jia_28"><p id="z2r5jia_36"><span id="z2r5jia_37">Connect to your database</span></p></li><li class="list__item" id="z2r5jia_29"><p id="z2r5jia_38"><span id="z2r5jia_39">Using a local MySQL instance during development</span></p></li><li class="list__item" id="z2r5jia_30"><p id="z2r5jia_40"><span id="z2r5jia_41">Size and access limits</span></p></li><li class="list__item" id="z2r5jia_31"><p id="z2r5jia_42"><span id="z2r5jia_43">Using Persistence APIs with Cloud SQL</span></p></li></ol><p id="z2r5jia_10">To learn more about Google Cloud SQL, see the <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/cloud-sql/" id="z2r5jia_44" data-external="true" rel="noopener noreferrer" target="_blank">Google Cloud SQL</a> documentation.</p><p id="z2r5jia_11"><span class="control" id="z2r5jia_45">Note:</span> Access to Google Cloud SQL Second Generation instances can be granted only for apps running in the flexible environment. <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/sql/docs/dev-access" id="z2r5jia_46" data-external="true" rel="noopener noreferrer" target="_blank">Learn more.</a></p><p id="z2r5jia_12">If you haven't already created a Google Cloud SQL instance, the first thing you need to do is create one.</p><section class="chapter"><h2 id="creating-a-cloud-sql-instance" data-toc="creating-a-cloud-sql-instance">Creating a Cloud SQL Instance</h2><p id="z2r5jia_47">A Cloud SQL instance is equivalent to a server. A single Cloud SQL instance can contain multiple databases. Follow these steps to create a Google Cloud SQL instance:</p><ol class="list _decimal" id="z2r5jia_48" type="1"><li class="list__item" id="z2r5jia_51"><p id="z2r5jia_55">Sign into the <a href="https://web.archive.org/web/20160424230503/https://console.cloud.google.com/" id="z2r5jia_56" data-external="true" rel="noopener noreferrer" target="_blank">Google Cloud Platform Console</a>.</p></li><li class="list__item" id="z2r5jia_52"><p id="z2r5jia_57">Create a new project, or open an existing project.</p></li><li class="list__item" id="z2r5jia_53"><p id="z2r5jia_58">From within a project, select <span class="control" id="z2r5jia_59">Cloud SQL</span> to open the Cloud SQL control panel for that project.</p></li><li class="list__item" id="z2r5jia_54"><p id="z2r5jia_60">Click <span class="control" id="z2r5jia_63">New Instance</span> to create a new Cloud SQL instance in your project, and configure your size, billing and replication options.</p><ul class="list _bullet" id="z2r5jia_61"><li class="list__item" id="z2r5jia_64"><p id="z2r5jia_66"><a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/cloud-sql/docs/billing" id="z2r5jia_67" data-external="true" rel="noopener noreferrer" target="_blank">More information on Cloud SQL billing options and instance sizes</a></p></li><li class="list__item" id="z2r5jia_65"><p id="z2r5jia_68"><a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/cloud-sql/faq#data_location" id="z2r5jia_69" data-external="true" rel="noopener noreferrer" target="_blank">More information on Cloud SQL replication options</a></p></li></ul><p id="z2r5jia_62">You'll notice that the App Engine application associated with your current project is already authorized to access this new instance. For more information on app authorization see the <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/cloud-sql/docs/access_control#appaccess" id="z2r5jia_70" data-external="true" rel="noopener noreferrer" target="_blank">Access Control</a> topic in the Cloud SQL docs.</p></li></ol><p id="z2r5jia_49">That's it! You can now connect to your Google Cloud SQL instance from within your app, or any of <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/cloud-sql/docs/before_you_begin#connect" id="z2r5jia_71" data-external="true" rel="noopener noreferrer" target="_blank">these other methods</a>.</p><section class="chapter"><h3 id="mysql-case-sensitivity" data-toc="mysql-case-sensitivity">MySQL case sensitivity</h3><p id="z2r5jia_72">When you are creating or using databases and tables, keep in mind that all identifiers in Google Cloud SQL are case-sensitive. This means that all tables and databases are stored with the same name and case that was specified at creation time. When you try to access your databases and tables, make sure that you are using the exact database or table name.</p><p id="z2r5jia_73">For example, if you create a database named PersonsDatabase, you will not be able to reference the database using any other variation of that name, such as personsDatabase or personsdatabase. For more information about identifier case sensitivity, see the <a href="https://web.archive.org/web/20160424230503/http://dev.mysql.com/doc/refman/5.5/en/identifier-case-sensitivity.html" id="z2r5jia_74" data-external="true" rel="noopener noreferrer" target="_blank">MySQL documentation.</a></p></section></section><section class="chapter"><h2 id="build-a-starter-application-and-database" data-toc="build-a-starter-application-and-database">Build a starter application and database</h2><p id="z2r5jia_75">The easiest way to build an App Engine application that accesses Google Cloud SQL is to create a starter application then modify it. This section leads you through the steps of building an application that displays a web form that lets users read and write entries to a guestbook database. The sample application demonstrates how to read and write to a Google Cloud SQL instance.</p><section class="chapter"><h3 id="step-1-create-your-app-engine-sample-application" data-toc="step-1-create-your-app-engine-sample-application">Step 1: Create your App Engine sample application</h3><p id="z2r5jia_79">Follow the instructions in <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/java/gettingstarted/creating" id="z2r5jia_80" data-external="true" rel="noopener noreferrer" target="_blank">Creating a Project</a> to create a simple App Engine application.</p></section><section class="chapter"><h3 id="step-2-grant-your-app-engine-application-access-to-the-google-cloud-sql-instance" data-toc="step-2-grant-your-app-engine-application-access-to-the-google-cloud-sql-instance">Step 2: Grant your App Engine application access to the Google Cloud SQL instance</h3><p id="z2r5jia_81">You can grant individual Google App Engine applications access to a Google Cloud SQL instance. One application can be granted access to multiple instances, and multiple applications can be granted access to a particular instance. To grant access to a Google App Engine application, you need its application ID which can be found at the <a href="https://web.archive.org/web/20160424230503/https://appengine.google.com/" id="z2r5jia_86" data-external="true" rel="noopener noreferrer" target="_blank">Google App Engine administration console</a> under the <span class="control" id="z2r5jia_87">Applications</span> column.</p><p id="z2r5jia_82"><span class="control" id="z2r5jia_88">Note</span>: An&nbsp;App Engine application must be in the same region (either EU or US) as a Google Cloud SQL instance to be authorized to access that Google Cloud SQL instance.</p><p id="z2r5jia_83"><span class="control" id="z2r5jia_89">To grant an App Engine application access to a Google Cloud SQL instance:</span></p><ol class="list _decimal" id="z2r5jia_84" type="1"><li class="list__item" id="z2r5jia_90"><p id="z2r5jia_95">In the <a href="https://web.archive.org/web/20160424230503/https://console.cloud.google.com/project/_/sql/instances" id="z2r5jia_96" data-external="true" rel="noopener noreferrer" target="_blank">Google Cloud Platform Console</a>, select a project.</p></li><li class="list__item" id="z2r5jia_91"><p id="z2r5jia_97">Click the name of the instance to which you want to grant access.</p></li><li class="list__item" id="z2r5jia_92"><p id="z2r5jia_98">In the instance dashboard, click <span class="control" id="z2r5jia_99">Edit</span>.</p></li><li class="list__item" id="z2r5jia_93"><p id="z2r5jia_100">In the <span class="control" id="z2r5jia_102">Instance settings</span> window, enter your Google App Engine application ID in the <span class="control" id="z2r5jia_103">Authorized App Engine applications</span> section. You can grant access to multiple applications, by entering them one at a time.</p><p id="z2r5jia_101"><span class="control" id="z2r5jia_104">Note</span>: In order to improve performance, the Google Cloud SQL instance will be kept as close as possible to the first App Engine application on the list, so this should be the application whose performance is most important.</p></li><li class="list__item" id="z2r5jia_94"><p id="z2r5jia_105">Click <span class="control" id="z2r5jia_106">Confirm</span> to apply your changes.</p></li></ol><p id="z2r5jia_85">After you have added authorized applications to your Google Cloud SQL instance, you can view a list of these applications in the instance dashboard, in the section titled <span class="control" id="z2r5jia_107">Applications</span>.</p></section><section class="chapter"><h3 id="step-3-create-your-database-and-table" data-toc="step-3-create-your-database-and-table">Step 3: Create your database and table</h3><p id="z2r5jia_108">For example, you can use <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/cloud-sql/docs/mysql-client" id="z2r5jia_111" data-external="true" rel="noopener noreferrer" target="_blank">MySQL Client</a> to run the following commands:</p><ol class="list _decimal" id="z2r5jia_109" type="1"><li class="list__item" id="z2r5jia_112"><p id="z2r5jia_114">Create a new database called <code class="code" id="z2r5jia_116">guestbook</code> using the following SQL statement:</p><div class="code-block" data-lang="none">
CREATE DATABASE guestbook;
</div></li><li class="list__item" id="z2r5jia_113"><p id="z2r5jia_117">Inside the <code class="code" id="z2r5jia_119">guestbook</code> database create a table called <code class="code" id="z2r5jia_120">entries</code> with columns for the guest name, the message content, and a random ID, using the following statement:</p><div class="code-block" data-lang="none">
CREATE TABLE guestbook.entries (
  entryID INT NOT NULL AUTO_INCREMENT,
  guestName VARCHAR(255),
  content VARCHAR(255),
  PRIMARY KEY(entryID)
);
</div></li></ol><p id="z2r5jia_110">After you have set up a bare-bones application, you can modify it and deploy it.</p></section></section><section class="chapter"><h2 id="connect-to-your-database" data-toc="connect-to-your-database">Connect to your database</h2><p id="z2r5jia_121">One way to connect your Java App Engine application to a Cloud SQL databases is to use the <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/eclipse/" id="z2r5jia_128" data-external="true" rel="noopener noreferrer" target="_blank">Google Plugin for Eclipse</a>. The following steps assume that you created an application following the <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/eclipse/docs/creating_new_webapp" id="z2r5jia_129" data-external="true" rel="noopener noreferrer" target="_blank">Creating a New Web Application</a> instructions. For the sample we are buiding here, we don't need the Google Web Toolkit (GWT) so you can create your web application without that SDK.</p><p id="z2r5jia_122">Note that the code below assumes that you created a web application project with a <span class="control" id="z2r5jia_130">Project name</span> specified as &quot;Guestbook&quot; and a <span class="control" id="z2r5jia_131">Package</span> specified as &quot;guestbook&quot;. If you choose different values, you will have to make the appropriate changes in the servlet and web form.</p><ol class="list _decimal" id="z2r5jia_123" type="1"><li class="list__item" id="z2r5jia_132"><p id="z2r5jia_136"><span id="z2r5jia_137">Enable MySQL Connector/J</span></p></li><li class="list__item" id="z2r5jia_133"><p id="z2r5jia_138"><span id="z2r5jia_139">Connect and Post to Your Database</span></p></li><li class="list__item" id="z2r5jia_134"><p id="z2r5jia_140"><span id="z2r5jia_141">Create Your Webform</span></p></li><li class="list__item" id="z2r5jia_135"><p id="z2r5jia_142"><span id="z2r5jia_143">Map Your Servlet</span></p></li></ol><section class="chapter"><h3 id="enable-mysql-connector-j" data-toc="enable-mysql-connector-j">Enable MySQL Connector/J</h3><p id="z2r5jia_144">The MySQL Connector/J is available in Google App Engine, but it's not included in an app unless the app explicitly asks for it. To do that, add a <code class="code" id="z2r5jia_146">&lt;use-google-connector-j&gt;</code> element as a child of the <code class="code" id="z2r5jia_147">&lt;appengine-web-app&gt;</code> element in the app's <code class="code" id="z2r5jia_148">appengine-web.xml</code> file as shown in the following example:</p><div class="code-block" data-lang="none">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;appengine-web-app xmlns=&quot;http://appengine.google.com/ns/1.0&quot;&gt;
  ...
  &lt;use-google-connector-j&gt;true&lt;/use-google-connector-j&gt;
&lt;/appengine-web-app&gt;
</div></section><section class="chapter"><h3 id="connect-and-post-to-your-database" data-toc="connect-and-post-to-your-database">Connect and post to your database</h3><p id="z2r5jia_149">Replace <code class="code" id="z2r5jia_156">doGet()</code> in <code class="code" id="z2r5jia_157">GuestbookServlet</code> with the following code. Replacing <code class="code" id="z2r5jia_158">your-instance-name</code> with your Google Cloud SQL instance name and <code class="code" id="z2r5jia_159">your-project-id</code> with the literal project ID. This code performs the following actions:</p><ul class="list _bullet" id="z2r5jia_150"><li class="list__item" id="z2r5jia_160"><p id="z2r5jia_163">Initiates the connection by calling <code class="code" id="z2r5jia_164">getConnection()</code></p></li><li class="list__item" id="z2r5jia_161"><p id="z2r5jia_165">Collects the contents from a web form and posting them to the server</p></li><li class="list__item" id="z2r5jia_162"><p id="z2r5jia_166">Redirects the user to a file called <code class="code" id="z2r5jia_167">guestbook.jsp</code> (we will create it in a later step)</p></li></ul><div class="code-block" data-lang="none">
import java.io.*;
import java.sql.*;
import javax.servlet.http.*;
import com.google.appengine.api.utils.SystemProperty;

public class GuestbookServlet extends HttpServlet {
  @Override
  public void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String url = null;
    try {
      if (SystemProperty.environment.value() ==
          SystemProperty.Environment.Value.Production) {
        // Load the class that provides the new &quot;jdbc:google:mysql://&quot; prefix.
        Class.forName(&quot;com.mysql.jdbc.GoogleDriver&quot;);
        url = &quot;jdbc:google:mysql://your-project-id:your-instance-name/guestbook?user=root&quot;;
      } else {
        // Local MySQL instance to use during development.
        Class.forName(&quot;com.mysql.jdbc.Driver&quot;);
        url = &quot;jdbc:mysql://127.0.0.1:3306/guestbook?user=root&quot;;

        // Alternatively, connect to a Google Cloud SQL instance using:
        // jdbc:mysql://ip-address-of-google-cloud-sql-instance:3306/guestbook?user=root
      }
    } catch (Exception e) {
      e.printStackTrace();
      return;
    }

    PrintWriter out = resp.getWriter();
    try {
      Connection conn = DriverManager.getConnection(url);
      try {
        String fname = req.getParameter(&quot;fname&quot;);
        String content = req.getParameter(&quot;content&quot;);
        if (fname == &quot;&quot; || content == &quot;&quot;) {
          out.println(
              &quot;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;You are missing either a message or a name! Try again! &quot; +
              &quot;Redirecting in 3 seconds...&lt;/body&gt;&lt;/html&gt;&quot;);
        } else {
          String statement = &quot;INSERT INTO entries (guestName, content) VALUES( ? , ? )&quot;;
          PreparedStatement stmt = conn.prepareStatement(statement);
          stmt.setString(1, fname);
          stmt.setString(2, content);
          int success = 2;
          success = stmt.executeUpdate();
          if (success == 1) {
            out.println(
                &quot;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;Success! Redirecting in 3 seconds...&lt;/body&gt;&lt;/html&gt;&quot;);
          } else if (success == 0) {
            out.println(
                &quot;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;Failure! Please try again! &quot; +
                &quot;Redirecting in 3 seconds...&lt;/body&gt;&lt;/html&gt;&quot;);
          }
        }
      } finally {
        conn.close();
      }
    } catch (SQLException e) {
      e.printStackTrace();
    }
    resp.setHeader(&quot;Refresh&quot;, &quot;3; url=/guestbook.jsp&quot;);
  }
}
</div><p id="z2r5jia_152">Although the above example connects to the Google Cloud SQL instance as the <code class="code" id="z2r5jia_168">root</code> user without any password, you can also connect to the instance indicating one:</p><div class="code-block" data-lang="none">
Connection conn = DriverManager.getConnection(
    &quot;jdbc:google:mysql://your-project-id:your-instance-name/database&quot;,
    &quot;user&quot;, &quot;password&quot;);
</div><p id="z2r5jia_154">For information about creating MySQL users, see <a href="https://web.archive.org/web/20160424230503/http://dev.mysql.com/doc/refman/5.5/en/adding-users.html" id="z2r5jia_169" data-external="true" rel="noopener noreferrer" target="_blank">Adding Users</a> in the MySQL documentation.</p><section class="chapter"><h4 id="managing-connections" data-toc="managing-connections">Managing connections</h4><p id="z2r5jia_170">An App Engine application is made up of one or more <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/java/modules/#Java_Application_hierarchy" id="z2r5jia_173" data-external="true" rel="noopener noreferrer" target="_blank">modules</a>. Each module consists of source code and configuration files. An instance instantiates the code which is included in an App Engine module, and a particular version of module will have one or more instances running. The number of instances running depends on the number of incoming requests. You can configure App Engine to scale the number of instances automatically in response to processing volume (see <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/java/modules/#Java_Instance_scaling_and_class" id="z2r5jia_174" data-external="true" rel="noopener noreferrer" target="_blank">Instance scaling and class</a>).</p><p id="z2r5jia_171">When App Engine instances talk to Google Cloud SQL, each App Engine instance cannot have more than 12 concurrent connections to a Cloud SQL instance. Always close any established connections before finishing processing a request. Not closing a connection will cause it to leak and may eventually cause new connections to fail. You can exit this state by shutting down the affected App Engine instance.</p><p id="z2r5jia_172">You should also keep in mind that there is also a maximum number of concurrent connections and queries for each Cloud SQL instance, depending on the tier (see <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/cloud-sql/pricing" id="z2r5jia_175" data-external="true" rel="noopener noreferrer" target="_blank">Cloud SQL pricing</a>). For guidance on managing connections, see <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/cloud-sql/faq#connections" id="z2r5jia_176" data-external="true" rel="noopener noreferrer" target="_blank">How should I manage connections?</a> in the &quot;Google Cloud SQL FAQ&quot; document.</p></section></section><section class="chapter"><h3 id="create-your-webform" data-toc="create-your-webform">Create your webform</h3><p id="z2r5jia_177">Next, we'll create the front-facing part of the sample application, which list the entries of your entries table and provides a simple form to post new entries.</p><p id="z2r5jia_178">In your <code class="code" id="z2r5jia_180">war/</code> directory, create a new file called <code class="code" id="z2r5jia_181">guestbook.jsp</code> with the following code, replacing <code class="code" id="z2r5jia_182">instance_name</code> with your instance name:</p><div class="code-block" data-lang="none">
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%@ page import=&quot;java.util.List&quot; %&gt;
&lt;%@ page import=&quot;java.sql.*&quot; %&gt;
&lt;%@ page import=&quot;com.google.appengine.api.utils.SystemProperty&quot; %&gt;

&lt;html&gt;
  &lt;body&gt;

&lt;%
String url = null;
if (SystemProperty.environment.value() ==
    SystemProperty.Environment.Value.Production) {
  // Load the class that provides the new &quot;jdbc:google:mysql://&quot; prefix.
  Class.forName(&quot;com.mysql.jdbc.GoogleDriver&quot;);
  url = &quot;jdbc:google:mysql://your-project-id:your-instance-name/guestbook?user=root&quot;;
} else {
  // Local MySQL instance to use during development.
  Class.forName(&quot;com.mysql.jdbc.Driver&quot;);
  url = &quot;jdbc:mysql://127.0.0.1:3306/guestbook?user=root&quot;;
}

Connection conn = DriverManager.getConnection(url);
ResultSet rs = conn.createStatement().executeQuery(
    &quot;SELECT guestName, content, entryID FROM entries&quot;);
%&gt;

&lt;table style=&quot;border: 1px solid black&quot;&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;th width=&quot;35%&quot; style=&quot;background-color: #CCFFCC; margin: 5px&quot;&gt;Name&lt;/th&gt;
&lt;th style=&quot;background-color: #CCFFCC; margin: 5px&quot;&gt;Message&lt;/th&gt;
&lt;th style=&quot;background-color: #CCFFCC; margin: 5px&quot;&gt;ID&lt;/th&gt;
&lt;/tr&gt;

&lt;%
while (rs.next()) {
    String guestName = rs.getString(&quot;guestName&quot;);
    String content = rs.getString(&quot;content&quot;);
    int id = rs.getInt(&quot;entryID&quot;);
 %&gt;
&lt;tr&gt;
&lt;td&gt;&lt;%= guestName %&gt;&lt;/td&gt;
&lt;td&gt;&lt;%= content %&gt;&lt;/td&gt;
&lt;td&gt;&lt;%= id %&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;%
}
conn.close();
%&gt;

&lt;/tbody&gt;
&lt;/table&gt;
&lt;br /&gt;
No more messages!
&lt;p&gt;&lt;strong&gt;Sign the guestbook!&lt;/strong&gt;&lt;/p&gt;
&lt;form action=&quot;/sign&quot; method=&quot;post&quot;&gt;
    &lt;div&gt;First Name: &lt;input type=&quot;text&quot; name=&quot;fname&quot;&gt;&lt;/input&gt;&lt;/div&gt;
    &lt;div&gt;Message:
    &lt;br /&gt;&lt;textarea name=&quot;content&quot; rows=&quot;3&quot; cols=&quot;60&quot;&gt;&lt;/textarea&gt;
    &lt;/div&gt;
    &lt;div&gt;&lt;input type=&quot;submit&quot; value=&quot;Post Greeting&quot; /&gt;&lt;/div&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;guestbookName&quot; /&gt;
  &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;
</div></section><section class="chapter"><h3 id="map-your-servlet" data-toc="map-your-servlet">Map your servlet</h3><p id="z2r5jia_183">Finally, override your <code class="code" id="z2r5jia_186">web.xml</code> with the following code to map your servlet correctly:</p><div class="code-block" data-lang="none">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
xmlns:web=&quot;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;
xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee
http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; version=&quot;2.5&quot;&gt;
   &lt;servlet&gt;
        &lt;servlet-name&gt;sign&lt;/servlet-name&gt;
        &lt;servlet-class&gt;guestbook.GuestbookServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;sign&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/sign&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;guestbook.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
&lt;/web-app&gt;
</div><p id="z2r5jia_185">That's it! Now you can <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/java/tools/uploadinganapp" id="z2r5jia_187" data-external="true" rel="noopener noreferrer" target="_blank">deploy your application</a> and try it out!</p></section></section><section class="chapter"><h2 id="using-a-local-mysql-instance-during-development" data-toc="using-a-local-mysql-instance-during-development">Using a local MySQL instance during development</h2><p id="z2r5jia_188"><span id="z2r5jia_189">The Guestbook example above</span> shows how your application can connect to a Cloud SQL instance when the code runs in App Engine and connect to a local MySQL server when the code runs in the <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/java/tools/devserver" id="z2r5jia_190" data-external="true" rel="noopener noreferrer" target="_blank">Development Server</a>. We encourage this pattern to minimize confusion and maximize flexibility.</p></section><section class="chapter"><h2 id="size-and-access-limits" data-toc="size-and-access-limits">Size and access limits</h2><p id="z2r5jia_191">The following limits apply to Google Cloud SQL:</p><p id="z2r5jia_192"><span class="control" id="z2r5jia_200">Cloud SQL instances limits</span></p><div class="table-wrapper"><table class="wide" id="z2r5jia_193"><thead><tr class="ijRowHead" id="z2r5jia_202"><th id="z2r5jia_210"><p>Limit</p></th><th id="z2r5jia_211"><p>First Generation instances</p></th><th id="z2r5jia_212"><p>Second Generation instances</p></th><th id="z2r5jia_213"><p>Notes</p></th></tr></thead><tbody><tr id="z2r5jia_203"><td id="z2r5jia_214"><p>Concurrent connections</p></td><td id="z2r5jia_215"><p>Determined by <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/sql/pricing#packages" id="z2r5jia_218" data-external="true" rel="noopener noreferrer" target="_blank">tier</a></p></td><td id="z2r5jia_216"><p>4,000</p></td><td id="z2r5jia_217"></td></tr><tr id="z2r5jia_204"><td id="z2r5jia_219"><p>Pending connections</p></td><td id="z2r5jia_220"><p>100</p></td><td id="z2r5jia_221"><p>N/A</p></td><td id="z2r5jia_222"><p>If more than 100 clients try to connect simultaneously to a First Generation instance, some of them will fail to connect.</p></td></tr><tr id="z2r5jia_205"><td id="z2r5jia_223"><p>Storage size</p></td><td id="z2r5jia_224"><p>250 GB</p></td><td id="z2r5jia_225"><p>Determined by <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/sql/pricing#v2-instance-pricing" id="z2r5jia_227" data-external="true" rel="noopener noreferrer" target="_blank">machine type</a></p></td><td id="z2r5jia_226"><p>It is possible to increase individual First Generation instance limits up to 500 GB for customers with a Silver or higher <a href="https://web.archive.org/web/20160424230503/https://support.google.com/cloud/answer/3420040" id="z2r5jia_228" data-external="true" rel="noopener noreferrer" target="_blank">Google Cloud support package</a>.</p></td></tr></tbody></table></div><p id="z2r5jia_194">The connection limits are in place to protect against accidents and abuse. For questions about increasing these values, contact the <a href="https://web.archive.org/web/20160424230503/mailto:cloud-sql@google.com" id="z2r5jia_229" data-external="true" rel="noopener noreferrer" target="_blank">cloud-sql@google.com</a> team.</p><p id="z2r5jia_195"><span class="control" id="z2r5jia_230">Google App Engine Limits</span></p><p id="z2r5jia_196">Requests from Google App Engine applications to Google Cloud SQL are subject to the following time and connection limits:</p><ul class="list _bullet" id="z2r5jia_197"><li class="list__item" id="z2r5jia_231"><p id="z2r5jia_235">For apps running in the Google App Engine standard environment, all database requests must finish within the <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/java/requests#Java_The_request_timer" id="z2r5jia_236" data-external="true" rel="noopener noreferrer" target="_blank">HTTP request timer</a>, around <span class="control" id="z2r5jia_237">60 seconds</span>. For apps running in the flexible environment, all database requests must finish within <span class="control" id="z2r5jia_238">24 hours</span>.</p></li><li class="list__item" id="z2r5jia_232"><p id="z2r5jia_239">Offline requests like <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/java/config/cron" id="z2r5jia_240" data-external="true" rel="noopener noreferrer" target="_blank">cron tasks</a> have a time limit of <span class="control" id="z2r5jia_241">10 minutes.</span></p></li><li class="list__item" id="z2r5jia_233"><p id="z2r5jia_242">Requests from App Engine modules to Google Cloud SQL are subject to the type of <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/java/modules/#Java_Instance_scaling_and_class" id="z2r5jia_243" data-external="true" rel="noopener noreferrer" target="_blank">module scaling</a> and instance residence time in memory.</p></li><li class="list__item" id="z2r5jia_234"><p id="z2r5jia_244">Each App Engine instance running in a standard environment or using <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/flexible/python/migrating-an-existing-app" id="z2r5jia_245" data-external="true" rel="noopener noreferrer" target="_blank">Standard-compatible APIs</a> cannot have more than <span class="control" id="z2r5jia_246">12 concurrent connections</span> to a Google Cloud SQL instance.</p></li></ul><p id="z2r5jia_198">Google App Engine applications are also subject to additional App Engine quotas and limits as discussed on the <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/quotas" id="z2r5jia_247" data-external="true" rel="noopener noreferrer" target="_blank">Quotas</a> page.</p><p id="z2r5jia_199">Learn more about the <a href="https://web.archive.org/web/20160424230503/https://cloud.google.com/appengine/docs/flexible/" id="z2r5jia_248" data-external="true" rel="noopener noreferrer" target="_blank">App Engine flexible environment</a>.</p></section><section class="chapter"><h2 id="using-persistence-apis-with-cloud-sql" data-toc="using-persistence-apis-with-cloud-sql">Using Persistence APIs with Cloud SQL</h2><p id="z2r5jia_249">There are several ways to connect to MySQL using Java. The most basic one is via JDBC as shown above. You can also connect using <a href="https://web.archive.org/web/20160424230503/http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html" id="z2r5jia_257" data-external="true" rel="noopener noreferrer" target="_blank">Java Persistence API (JPA)</a> and <a href="https://web.archive.org/web/20160424230503/http://www.oracle.com/technetwork/java/index-jsp-135919.html" id="z2r5jia_258" data-external="true" rel="noopener noreferrer" target="_blank">Java Data Objects (JDO)</a>. Some JPAs, such as <a href="https://web.archive.org/web/20160424230503/http://www.hibernate.org/" id="z2r5jia_259" data-external="true" rel="noopener noreferrer" target="_blank">Hibernate</a>, <a href="https://web.archive.org/web/20160424230503/http://www.datanucleus.com/" id="z2r5jia_260" data-external="true" rel="noopener noreferrer" target="_blank">DataNucleus</a>, and <a href="https://web.archive.org/web/20160424230503/http://www.eclipse.org/eclipselink/" id="z2r5jia_261" data-external="true" rel="noopener noreferrer" target="_blank">EclipseLink</a>, have their own custom additions.</p><p id="z2r5jia_250"><span class="control" id="z2r5jia_262">Warning:</span> Always close any established connections before finishing processing a request (note the <code class="code" id="z2r5jia_263">try .. finally</code> from the example from above). Not closing a connection will cause it to leak and will eventually cause new connections to fail. You can exit this state by shutting down the affected App Engine instance. For more information about connections, see <span id="z2r5jia_264">Managing connections</span>.</p><p id="z2r5jia_251">To use persistence providers to connect to Cloud SQL, make sure you get the right JARs from the upstream distros, configure the <code class="code" id="z2r5jia_265">javax.persistence.jdbc.driver</code> to use the <code class="code" id="z2r5jia_266">com.mysql.jdbc.GoogleDriver</code>, and point the <code class="code" id="z2r5jia_267">javax.persistence.jdbc.url</code> to the desired Cloud SQL instance using a <code class="code" id="z2r5jia_268">jdbc:google:mysql://</code> prefix in the connection string. To allow the same JPA code to run in both production and locally with <code class="code" id="z2r5jia_269">dev_appserver</code>, use the following pattern:</p><div class="code-block" data-lang="none">
import java.util.Map;
import java.util.HashMap;
import com.google.appengine.api.utils.SystemProperty;

...
    // Set the persistence driver and url based on environment, production or local.
    Map&lt;String, String&gt; properties = new HashMap();
    if (SystemProperty.environment.value() ==
          SystemProperty.Environment.Value.Production) {
      properties.put(&quot;javax.persistence.jdbc.driver&quot;,
          &quot;com.mysql.jdbc.GoogleDriver&quot;);
      properties.put(&quot;javax.persistence.jdbc.url&quot;,
          &quot;jdbc:google:mysql://your-project-id:your-instance-name/demo&quot;);
    } else {
      properties.put(&quot;javax.persistence.jdbc.driver&quot;,
          &quot;com.mysql.jdbc.Driver&quot;);
      properties.put(&quot;javax.persistence.jdbc.url&quot;,
          &quot;jdbc:mysql://127.0.0.1:3306/demo&quot;);
    }

    // Create a EntityManager which will perform operations on the database.
    EntityManagerFactory emf = Persistence.createEntityManagerFactory(
        &quot;persistence-unit-name&quot;, propertiesMap);
...
</div><p id="z2r5jia_253">For JDO, create a <code class="code" id="z2r5jia_270">PersistenceManagerFactory</code> instead an <code class="code" id="z2r5jia_271">EntityManagerFactory</code>:</p><div class="code-block" data-lang="none">
PersistenceManagerFactory pmf = JDOHelper.getPersistenceManagerFactory(propertiesMap, &quot;persistence-unit-name&quot;);
</div><p id="z2r5jia_255">Complete examples are available at <a href="https://web.archive.org/web/20160424230503/https://github.com/GoogleCloudPlatform" id="z2r5jia_272" data-external="true" rel="noopener noreferrer" target="_blank">https://github.com/GoogleCloudPlatform</a> for:</p><ul class="list _bullet" id="z2r5jia_256"><li class="list__item" id="z2r5jia_273"><p id="z2r5jia_277"><a href="https://web.archive.org/web/20160424230503/https://github.com/GoogleCloudPlatform/appengine-cloudsql-native-mysql-hibernate-jpa-demo-java" id="z2r5jia_278" data-external="true" rel="noopener noreferrer" target="_blank">Hibernate JPA</a></p></li><li class="list__item" id="z2r5jia_274"><p id="z2r5jia_279"><a href="https://web.archive.org/web/20160424230503/https://github.com/GoogleCloudPlatform/appengine-cloudsql-native-mysql-datanucleus-jpa-demo-java" id="z2r5jia_280" data-external="true" rel="noopener noreferrer" target="_blank">DataNucleus JPA</a></p></li><li class="list__item" id="z2r5jia_275"><p id="z2r5jia_281"><a href="https://web.archive.org/web/20160424230503/https://github.com/GoogleCloudPlatform/appengine-cloudsql-native-mysql-datanucleus-jdo-demo-java" id="z2r5jia_282" data-external="true" rel="noopener noreferrer" target="_blank">DataNucleus JDO</a></p></li><li class="list__item" id="z2r5jia_276"><p id="z2r5jia_283"><a href="https://web.archive.org/web/20160424230503/https://github.com/GoogleCloudPlatform/appengine-cloudsql-native-mysql-eclipselink-jpa-demo-java" id="z2r5jia_284" data-external="true" rel="noopener noreferrer" target="_blank">EclipseLink JPA</a></p></li></ul></section><div class="last-modified">10 April 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="java-datastore-index-configuration.html" class="navigation-links__prev">Java Datastore Index Configuration</a><a href="google-cloud-storage.html" class="navigation-links__next">Google Cloud Storage</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>